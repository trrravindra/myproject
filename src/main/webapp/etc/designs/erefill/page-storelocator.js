/*!
 * accounting.js v0.3.2
 * Copyright 2011, Joss Crowcroft
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://josscrowcroft.github.com/accounting.js/
 */

/**
 * @license RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/i18n for details
 */

(function(e,t){function o(e){return!!(e===""||e&&e.charCodeAt&&e.substr)}function u(e){return i?i(e):s.call(e)==="[object Array]"}function a(e){return e&&s.call(e)==="[object Object]"}function f(e,t){var n;e=e||{},t=t||{};for(n in t)t.hasOwnProperty(n)&&e[n]==null&&(e[n]=t[n]);return e}function l(e,t,n){var i=[],s,o;if(!e)return i;if(r&&e.map===r)return e.map(t,n);for(s=0,o=e.length;s<o;s++)i[s]=t.call(n,e[s],s,e);return i}function c(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function h(e){var t=n.settings.currency.format;return typeof e=="function"&&(e=e()),o(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:!e||!e.pos||!e.pos.match("%v")?o(t)?n.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t:e}var n={};n.version="0.3.2",n.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var r=Array.prototype.map,i=Array.isArray,s=Object.prototype.toString,p=n.unformat=n.parse=function(e,t){if(u(e))return l(e,function(e){return p(e,t)});e=e||0;if(typeof e=="number")return e;t=t||n.settings.number.decimal;var r=new RegExp("[^0-9-"+t+"]",["g"]),i=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(r,"").replace(t,"."));return isNaN(i)?0:i},d=n.toFixed=function(e,t){t=c(t,n.settings.number.precision);var r=Math.pow(10,t);return(Math.round(n.unformat(e)*r)/r).toFixed(t)},v=n.formatNumber=function(e,t,r,i){if(u(e))return l(e,function(e){return v(e,t,r,i)});e=p(e);var s=f(a(t)?t:{precision:t,thousand:r,decimal:i},n.settings.number),o=c(s.precision),h=e<0?"-":"",m=parseInt(d(Math.abs(e||0),o),10)+"",g=m.length>3?m.length%3:0;return h+(g?m.substr(0,g)+s.thousand:"")+m.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+s.thousand)+(o?s.decimal+d(Math.abs(e),o).split(".")[1]:"")},m=n.formatMoney=function(e,t,r,i,s,o){if(u(e))return l(e,function(e){return m(e,t,r,i,s,o)});e=p(e);var d=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:o},n.settings.currency),g=h(d.format),y=e>0?g.pos:e<0?g.neg:g.zero;return y.replace("%s",d.symbol).replace("%v",v(Math.abs(e),c(d.precision),d.thousand,d.decimal))};n.formatColumn=function(e,t,r,i,s,d){if(!e)return[];var m=f(a(t)?t:{symbol:t,precision:r,thousand:i,decimal:s,format:d},n.settings.currency),g=h(m.format),y=g.pos.indexOf("%s")<g.pos.indexOf("%v")?!0:!1,b=0,w=l(e,function(e,t){if(u(e))return n.formatColumn(e,m);e=p(e);var r=e>0?g.pos:e<0?g.neg:g.zero,i=r.replace("%s",m.symbol).replace("%v",v(Math.abs(e),c(m.precision),m.thousand,m.decimal));return i.length>b&&(b=i.length),i});return l(w,function(e,t){return o(e)&&e.length<b?y?e.replace(m.symbol,m.symbol+(new Array(b-e.length+1)).join(" ")):(new Array(b-e.length+1)).join(" ")+e:e})},typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.accounting=n):typeof define=="function"&&define.amd?define("accounting",[],function(){return n}):(n.noConflict=function(r){return function(){return e.accounting=r,n.noConflict=t,n}}(e.accounting),e.accounting=n)})(this),define("modules/format",["accounting"],function(e){function i(e,t,n,r){return t<0&&(t=e.length+t),e.slice(0,t)+r+e.slice(t+Math.abs(n))}function s(e){return e.replace(n,"")}var t={},n=/[^0-9]/g,r="-";return t.phone=function(e){var t=s(e+""),n=t.length;return n<7?e:(t=i(t,-4,0,r),n===7?t:n>10?(t=i(t,-8,0,") "),t=i(t,-13,0," ("),t):(t=i(t,-8,0,r),t))},t.currency=function(t,n){return e.formatMoney(t,n)},{as:function(e,n){var r=Array.prototype.slice.call(arguments);return r.shift(),t[e].apply(t,r)}}}),define("modules/managers/browser-detect",[],function(){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!=-1)return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(t==-1)return;return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e}),define("modules/nav-universal",["jquery","stapes"],function(e,t){var n={el:null},r=t.subclass({constructor:function(t){var r=this;r.config=e.extend({},n,t),r.el=e(r.config.el);if(!r.el.length)return;r.initEvents(),r.accessibilityDropdown()},initEvents:function(){},accessibilityDropdown:function(){var t=this;e(t.el).on({focusin:function(t){var n=e(this);n.has("div.dropdown")&&e(this).addClass("accessibility-focus")},focusout:function(t){var n=e(this);setTimeout(function(){n.find(":focus").length||n.removeClass("accessibility-focus")},10)}},"nav > ul > li"),e(t.el).find(".stores-wide > .col:first-child ul li a, .stores-wide > .col.last ul li a").css("width","202px")}});return function(e){return new r(e)}}),define("mediators/aoda",["jquery","stapes"],function(e,t){function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}var n={TAB:9,ENTER:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40},r=function(t){var n=this;this.id=t,this.allTabs=e(".aoda-tabcontrol-"+t),this.allTabpanels=e(".aoda-tabpanel-"+t),this.curTab=this.allTabs.filter(".active"),this.curTabIndex=this.curTab.index(".aoda-tabcontrol-"+this.id);var r=function(t){var r;if(!t)return;r=e("#"+t.attr("aria-controls")),n.allTabs.attr({"aria-selected":"false"}),n.allTabpanels.attr({"aria-hidden":"true"}),t.attr({"aria-selected":"true"}),r.attr({"aria-hidden":"false"})};this.getActiveTab=function(){return this.curTab},this.getActiveTabpanel=function(){return e("#"+this.curTab.attr("aria-controls"))},this.getPreviousTab=function(){var t=this.curTabIndex;return t===0?this.allTabs.last():e(this.allTabs[t-1])},this.getNextTab=function(){var t=this.curTabIndex,n=this.allTabs;return t+1===n.length?n.first():e(n[t+1])},this.selectTab=function(t){r(e(t)),this.curTab=e(t),this.curTabIndex=this.curTab.index(".aoda-tabcontrol-"+this.id)}},s={collapse:{method:"setupCollapse",selector:".collapse [data-collapse-target]"},tabs:{method:"setupTabs",selector:".tabs"}},o=t.subclass({constructor:function(){var t=this;t.initEvents(),e(function(){t.emit("domready")})},initEvents:function(){var e=this;e.on("domready",e.onDomReady),e._initHandlersForCollapse(),e._initHandlersForTabs()},onDomReady:function(){},_initHandlersForCollapse:function(){var t=window.document,r=".aoda-collapse-button",i=function(t){var n=e(this),r=e("#"+n.attr("aria-controls"));n.attr("aria-expanded")==="true"?(n.attr("aria-expanded","false"),r.attr("aria-hidden","true")):n.attr("aria-expanded")==="false"&&(n.attr("aria-expanded","true"),r.attr("aria-hidden","false"))};e(t).on({click:i,keypress:function(t){t.which===n.SPACE?e(this).click():t.which===n.ENTER}},r)},doCollapse:function(e,t){e.hasClass("aoda-collapse-button")&&(e.attr("aria-expanded","false"),t.attr("aria-hidden","true"))},setupCollapse:function(t){t||(t=window.document);var n=this,r=s.collapse.selector,o=e(t).find(r);o.length&&o.each(function(t){if(e(this).data("aoda-collapse-button"))return;var n=e(this),r=n.parents(".collapse:first"),s=r.find(n.data("collapse-target")),o=i(),u=r.attr("id")||"collapse-"+o,a=n.attr("id")||"collapseCtrl-"+o,f=s.attr("id")||"collapseTarget-"+o,l=r.hasClass("open");n.attr({id:a,role:"button","aria-expanded":l?"true":"false","aria-controls":f}),n.attr("href")||n.attr("href","#"),n.addClass("aoda-collapse-button"),s.attr({id:f,"aria-hidden":l?"false":"true"}),n.data("aoda-collapse-button",!0)})},_initHandlersForTabs:function(){e(window.document).on({keyup:function(t){var r=e(this),i=r.parents(".tabs:first"),s=i.data("aoda-tablist");t.which===n.LEFT||t.which===n.UP?(r=s.getPreviousTab(),r.click(),r.focus()):t.which===n.RIGHT||t.which===n.DOWN?(r=s.getNextTab(),r.click(),r.focus()):t.which===n.SPACE?(r.click(),setTimeout(function(){s.getActiveTabpanel().focus()},5)):t.which===n.ENTER&&setTimeout(function(){s.getActiveTabpanel().focus()},5)},click:function(t){var n=e(this),r=n.parents(".tabs:first"),i=r.data("aoda-tablist");i.selectTab(this)}},".aoda-tabcontrol"),e(window.document).on({keyup:function(t){var r=e(this),i=e(".aoda-tablist-"+r.data("aoda-id")),s=i.data("aoda-tablist"),o;t.which===n.UP&&(t.ctrlKey||t.altKey)?o=s.getActiveTab().focus():t.which===n.PAGEDOWN&&t.altKey?(o=s.getNextTab(),o.click(),setTimeout(function(){o.focus()},5)):t.which===n.PAGEUP&&t.altKey&&(o=s.getPreviousTab(),o.click(),setTimeout(function(){o.focus()},5))}},".aoda-tabpanel")},setupTabs:function(t){t||(t=window.document);var n=this,o=s.tabs.selector,u=e(t).find(o).has("[data-tab-target]");u.length&&u.each(function(t){var n=e(this),s=n.find("[data-tab-target]"),o=n.attr("id")||i(),u=[];if(s.length<2)return;try{s.each(function(t){var n=e(e(this).attr("data-tab-target"));if(n.length!==1)throw new Error("Tab Data target not found or multiple elements matching target.");u.push(n[0])}),u=e(u)}catch(a){return}n.attr({role:"tablist",id:n.attr("id")||"aoda-tablist-"+o}),n.addClass("aoda-tablist-"+o),s.each(function(t){var n=e(this),r=e(u[t]),i=n.attr("id")||"aoda-tabcontrol-"+o+"-"+t,s=r.attr("id")||"aoda-tabpanel-"+o+"-"+t;n.attr({role:"tab","aria-controls":s,"aria-selected":n.hasClass("active")?"true":"false",tabindex:0,id:i}),n.parent().attr("role","presentation"),n.attr("href")||n.attr("href","#"),n.addClass("aoda-tabcontrol aoda-tabcontrol-"+o),n.data("aoda-id",o),r.attr({id:s,role:"tabpanel","aria-hidden":n.hasClass("active")?"false":"true","aria-labelledby":i,tabindex:"-1"}),r.addClass("aoda-tabpanel aoda-tabpanel-"+o),r.css("outline","none"),r.data("aoda-id",o)}),n.data("aoda-tablist",new r(o))})},scan:function(e,t){var n=this;e||(e=window.document);if(!t){var r;for(r in s)n[s[r].method](e)}else if(typeof t=="string"&&s[t])n[s[t].method](e);else if(t.length)for(var i=0,o=t.length;i<o;++i)s[t[i]]&&n[s[t[i]].method](e)}});return new o}),define("mediators/globals",["jquery","stapes","./conditionals","modules/api-tools","modules/link-scroller","modules/tooltip","modules/overlay","modules/nav","tpl!templates/global.overlay-find-store.html","tpl!templates/global.header-branded-store-anon.html","tpl!templates/global.header-branded-store-known.html","tpl!templates/dynamic-content.html","modules/format","json!config","jquery.validate","modules/managers/cookie-manager","modules/managers/browser-detect","modules/nav-universal","./aoda"],function(e,t,n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b){function w(e){try{console.log(e)}catch(t){alert(e)}}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var n=t||0,r=this.length;n<r;n++)if(this[n]===e)return n;return-1}),window.console||(window.console={}),window.console.log||(window.console.log=function(){});var E=t.subclass({conditionals:n,constants:{cookieNames:{WELCOME_OVERLAYS:"welcome_overlays",USER_COOKIE:"cqssoid",USER_OVERLAY_STATUS:"user_stat",PCPLUS_SIGN_IN_EMAIL:"pcplus_signin_email",PCPLUS_REDIRECT_URL:"redirect_url"}},constructor:function(){var t=this;t.initEvents(),t.cookieManager=new m,t.BrowserDetect=g,t.BrowserDetect.init(),e(".pcplus-dashboard").length>0&&t.getDashboard(),e(function(){t.emit("domready")})},initEvents:function(){function s(){document.cookie="craveOfferId=;path=/;domain="+d.cookieDomain,document.cookie="startDate=;path=/;domain="+d.cookieDomain,document.cookie="endDate=;path=/;domain="+d.cookieDomain,document.cookie="pcPoints=;path=/;domain="+d.cookieDomain,document.cookie="crave_off_stat=;path=/;domain="+d.cookieDomain,document.cookie="crave_off_earned=;path=/;domain="+d.cookieDomain}var t=this;t.on("domready",t.onDomReady),u.on("create",function(e){t.conditionals.scan(u.getElement(),["uniform","quick-rating","placeholder"]),b.scan(u.getElement())});var n=function(t){var n=9,r=27;if(t.keyCode!==n&&t.keyCode!==r)return;var i=e(this),s=i.find(":focusable,iframe"),o=s.first(),u=s.last();if(t.keyCode==n)u[0]===o[0]?t.preventDefault():t.shiftKey===!0&&t.target==o[0]?(t.preventDefault(),u.focus()):t.shiftKey===!1&&t.target==u[0]&&(t.preventDefault(),o.focus());else switch(e(t.target).prop("nodeName")){case"SELECT":case"IFRAME":break;default:t.data&&t.data.close&&t.data.close()}},r=function(){var e=u.getElement(),t=e.find(":focusable,iframe");t.first().is("iframe")&&t.first().attr("tabindex","0"),t.first().focus()};u.on("open",function(e){var t=u.getElement(),i;t.find(".overlay-product .details p").length&&(i=t.find(".overlay-product .details p").first(),(i.prop("scrollHeight")>i.innerHeight()||i.prop("scrollWidth")>i.innerWidth())&&i.attr("tabindex","0")),t.find(".pharmacy-information .pharmacy-about").length&&(i=t.find(".pharmacy-information .pharmacy-about").first(),(i.prop("scrollHeight")>i.innerHeight()||i.prop("scrollWidth")>i.innerWidth())&&i.attr("tabindex","0")),window.setTimeout(r,100),t.on("keydown",u,n)}),u.on("create",function(t){var n=u.getElement();e("html").hasClass("lt-ie9")&&n.find(".overlay-find-store-form")&&(interval=window.setInterval(function(){n.find(".overlay-find-store-form .input-search").hasClass("placeholder")&&(window.clearInterval(interval),r())},100))}),u.on("close",function(e){u.getElement().off("keydown",n)}),u.on("create",function(){var t=u.getElement().find(".overlay-find-store-form"),n=u.getElement().find(".err-msg"),r=u.getElement().find(".input-search");n.attr("tabindex",0),n.focus(),n.on({click:function(){r.focus()},keypress:function(t){(t.which===13||t.which===32)&&e(this).click()}}),t.on("submit",function(t){t.preventDefault();var n=e(this);e(".err-msg",n).css("visibility","hidden");var r=e(".input-search",n),s=u.getElement().find(".overlay h4").text();if(r.val()){var o="";for(i=0;i<d.api.pcApi.services.storeLocator.params.banner.length;i++)o===""?o="banner="+d.api.pcApi.services.storeLocator.params.banner[i]:o=o+"&banner="+d.api.pcApi.services.storeLocator.params.banner[i];var a=d.api.pcApi.base+d.api.pcApi.services.storeLocator.path+"?lang="+d.api.pcApi.services.storeLocator.params.lang+"&stores="+d.api.pcApi.services.storeLocator.params.stores+"&"+o+"&proximity="+d.api.pcApi.services.storeLocator.params.proximity+"&location="+encodeURIComponent(encodeURIComponent(r.val()))+"&departments=";e.ajax({type:"GET",dataType:"json",url:a,cache:!1,success:function(t){var r=e(this).attr("href");t&&t.length>0?(s=="Select a store :"||s=="Sélectionnez un magasin :"?dataLayer.push({category:"stores",action:"engagement:select a store:completion",label:"",value:"",event:"GA Event"}):s=="To find another store:"||s=="Pour trouver un autre magasin:"?dataLayer.push({category:"stores",action:"engagement:change store:completion",label:"",value:"",event:"GA Event"}):(s=="To view a flyer for a store near you:"||s=="Pour afficher la circulaire du magasin près de chez vous:")&&dataLayer.push({category:"stores",action:"engagement:view weekly flyer:completion",label:"",value:"",event:"GA Event"}),window.setTimeout(function(){n.get(0).submit()},500)):(s=="Select a store :"||s=="Sélectionnez un magasin :"?dataLayer.push({category:"stores",action:"engagement:select a store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):s=="To find another store:"||s=="Pour trouver un autre magasin:"?dataLayer.push({category:"stores",action:"engagement:change store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):dataLayer.push({category:"stores",action:"engagement:view weekly flyer:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}),e(".err-msg",n).css("visibility","visible").focus())}})}else s=="Select a store :"||s=="Sélectionnez un magasin :"?dataLayer.push({category:"stores",action:"engagement:select a store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):s=="To find another store:"||s=="Pour trouver un autre magasin:"?dataLayer.push({category:"stores",action:"engagement:change store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):dataLayer.push({category:"stores",action:"engagement:view weekly flyer:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}),e(".err-msg",n).css("visibility","visible").focus()})}),u.on("close",function(){var e=u.getElement().find(".overlay-find-store-form .err-msg"),t=u.getElement().find(".overlay-find-store-form .input-search");if(!e.length)return;t.val(""),e.css("visibility","hidden")}),u.on("create",function(n){var r=u.getElement().find(".form-write-review");if(r.length){var i={findProfanityIn:function(){return""}};require(["modules/profanity-filter"],function(t){var n=e("html").attr("lang");n&&n.length?n=n.split("_")[0]:n="en",i=t,i.init({lang:n})}),e.validator.addMethod("profanity",function(e,t){return this.optional(t)||!i.findProfanityIn(e).length}),r.validate({errorClass:"invalid",errorContainer:".err-msg",errorLabelContainer:".err-msg",errorElement:"p",onkeyup:!1,onclick:!1,onfocusout:!1,ignore:"",highlight:function(t,n){e(t).parents("label").length?e(t).parents("label").addClass(n):e(t).addClass(n)},unhighlight:function(t,n){e(t).parents("label").length?e(t).parents("label").removeClass(n):e(t).removeClass(n)},showErrors:function(t,n){var r=e(".err-msg").data("default-msg");this.defaultShowErrors(),this.errorContext.empty();var i=e(this),s=e(location).attr("href"),o=1,u,a=e("html").attr("lang");u=s.slice(s.indexOf(a)).split("/");if(u.length<2)return"other";var f=u[o];if(n.length){var l=this.errorContext;r&&l.append(e("<p />").text(r));var c=[];e.each(n,function(t,n){e.inArray(n.message,c)===-1&&(c.push(n.message),l.append(e("<p />").text(n.message)))}),dataLayer.push({category:f,action:"engagement:write a review:error",label:c,value:"",event:"GA Event"})}},invalidHandler:function(){var e=".err-msg p";setTimeout(function(){t._aodaerror(e)},1e3)},submitHandler:function(t){var n=e(".submit-response"),r=e(t),i=e("#recaptcha_challenge_field").val(),s=e("#recaptcha_response_field").val(),o=e("body").data("page-analytics");n.html("");var a=e(this),f=e(location).attr("href"),l=1,c,h=e("html").attr("lang"),p=r.serialize();c=f.slice(f.indexOf(h)).split("/");if(c.length<2)return"other";var d=c[l];e.ajax({type:"GET",url:"/apps/lcl/recaptcha",data:{recaptchaResponseField:s,recaptchaChallengeField:i},success:function(i){if(i!=="true")return n.html(n.data("captcha")).show(),!1;e.ajax({type:"POST",url:r.attr("action"),data:r.serialize(),dataType:"html",success:function(i){u.getElement().find(".hide-on-submit").fadeOut(500),r.fadeOut(500,function(){n.html(n.data("success")).show(),e(t)[0].reset(),dataLayer.push({category:d,action:"engagement:submitted review",label:o.pageName,value:"",event:"GA Event"})});if(typeof dataLayer!="undefined")try{dataLayer.push({pageview:o.pageCategory+":review modal:write review:thank you:"+o.pageName,event:"vir_pageview"})}catch(s){throw"There was an error submitting Analytics data. Check that GTM was loaded, or that your call is properly setup."}},failure:function(e){n.html(n.data("fail")).show()}})},failure:function(e){n.html(n.data("fail")).show()}})}})}}),u.on("open",function(n){var r=u.getElement().find(".form-write-review");if(r.length){var i=function(){var t=r.find(".writereview-recaptcha-div"),n=t.attr("data-recaptcha-code"),i=t.attr("data-recaptcha-theme"),s=t.data("recaptcha-loaded");if(s){window.Recaptcha.reload();return}t.prop("id","writereview-recaptcha"),window.Recaptcha.create(n,"writereview-recaptcha",{theme:i,callback:function(){r.find("#recaptcha_reload_btn").attr({tabindex:0,href:""}).on("click",function(e){e.preventDefault()}),r.find("#recaptcha_switch_audio_btn").attr({tabindex:0,href:""}).on("click",function(e){e.preventDefault()}),e("#recaptcha_switch_img_btn").attr({tabindex:0,href:"#"}).click(function(e){e.preventDefault()}),r.find("#recaptcha_whatsthis_btn").attr({tabindex:0,href:""}).on("click",function(e){e.preventDefault()})}})};if(r.find(".recaptcha").length&&!t.Recaptcha){var s=location.protocol==="https:"?!0:!1,o=s?"https:":"http:";require([o+"//www.google.com/recaptcha/api/js/recaptcha_ajax.js"],function(){t.Recaptcha=window.Recaptcha,i()})}else i()}}),u.on("close",function(){setTimeout(function(){u.getElement().find(".submit-response").empty()},200),u.getElement().find("form, .hide-on-submit").show()}),u.on("close",function(){function t(e,t){e.one("click",function(){e.addClass("on"),s.addClass("rated"),o.val(t)})}var n=u.getElement().find(".form-write-review");if(!n.length)return;var r=u.getElement().find(".form-write-review .err-msg li"),i=u.getElement().find(".review-rating"),s=u.getElement().find(".rating-input"),o=u.getElement().find(".rating-form-input"),a=u.getElement().find(".checker span"),f,l,c,h;if(s.hasClass("rated")){s.removeClass("rated"),f=u.getElement().find(".rating-input span"),c=u.getElement().find(".rating-form-input").val(),o.val("");for(var p=0;p<f.length;p++)l=e(f[p]),l.hasClass("on")&&(l.removeClass("on"),t(l,c))}r.length&&(h=u.getElement().find(".invalid"),r.remove(),h.removeClass("invalid")),n[0].reset(),a.removeClass("checked")}),u.on("create",function(){var t=u.getElement().find(".see-more-button");if(!t.length)return;t.click(function(t){t.preventDefault();var n=e(this);if(n.attr("href")==="#")return;e.ajax({type:"POST",url:n.attr("href"),success:function(e){typeof console!="undefined"&&console.log("Successful request")},error:function(e){typeof console!="undefined"&&console.log("Error with request")}})})}),e(window.document).on("click",".find-store-overlay-trigger",function(t){var n=e(this),r=n.data("overlay-find-store")||"Select a Loblaws store:",i=n.data("overlay-find-store-url")||"WF-store-search-results-page-default.php";t.preventDefault(),u.open({content:{helpText:r,link:i},dataType:"json",template:f,wrapClassName:"overlay-find-store"});if(n.is(":focusable")){var s=function(){n.focus(),u.off("close",s)};u.on("close",s)}}),e(window.document).on("click",".ctrl-print",function(e){e.preventDefault(),window.print()}),e(window.document).on("click",".update-cookie",function(n){n.preventDefault();var r=e(this),i=r.attr("href"),s=r.data("cookies");s&&s!==undefined&&e.each(s.cookies,function(e,n){t.cookieManager.setCookie(n.name,n.value,n.expires,"/",d.cookieDomain,!1)}),window.location.href=i}),e(window.document).on("click",".header-branded .pcplus-show-offers-notloaded a",function(t){t.preventDefault(),s(),window.location.href=e(this).attr("href")}),e(window.document).on("click",".header-branded .pc-dropdown a",function(e){document.cookie="pc_user_context=dashboard;path=/;domain="+d.cookieDomain}),e(window.document).on("click",".sign-out",function(n){n.preventDefault(),s(),document.cookie="pc_user_context=;path=/;domain="+d.cookieDomain,document.cookie="user_offers=;path=/;domain="+d.cookieDomain;if(e(".my-offers").length<1){var r=new Date;r.setDate(r.getDate()-1),document.cookie=t.constants.cookieNames.USER_COOKIE+"=;path=/;domain="+d.cookieDomain+";expires= "+r.toGMTString(),document.cookie=t.constants.cookieNames.USER_OVERLAY_STATUS+"=;path=/;domain="+d.cookieDomain+";expires= "+r.toGMTString(),document.location.reload()}}),e(window.document).on("click",".pcplus-sign-in",function(n){n.preventDefault(),s(),document.cookie=t.constants.cookieNames.PCPLUS_REDIRECT_URL+"="+location.pathname+";path=/;domain="+d.cookieDomain,window.location.href=e(".pcplus-sign-in a").attr("href")}),e(window.document).on("change","select.submit-on-change",function(t){t.preventDefault(),e(this).parents("form:first").submit()}),b.scan(window.document,"collapse"),e(window.document).on("click",".collapse [data-collapse-target]",function(t){t.preventDefault();var n=e(this),r=n.parents(".collapse:first"),i=r.hasClass("open"),s=r.find(n.attr("data-collapse-target"));i&&s.css("display","block"),s.slideToggle(!i,function(e){}),r.toggleClass("open",!i).toggleClass("closed",i)}),e(window.document).on({keydown:function(t){var n=e(this);t.which===32?n.click():t.which===13},click:function(t){t.preventDefault();var n=e(this),r=e(".collapse.open");r.each(function(t,n){var r=e(n),i=r.find("[data-collapse-target]"),s=r.find(i.attr("data-collapse-target"));s.slideToggle(!1,function(e){r.addClass("closed").removeClass("open")}),b.doCollapse(i,s)})}},".collapse-all"),e(window.document).on("click",".dropdown [data-dropdown-target]",function(t){t.preventDefault();var n=e(this),r=n.parents(".dropdown:first"),i=r.hasClass("open"),s=r.find(n.attr("data-dropdown-target"));i||e(window.document).one("click",function(e){n.is(e.target)||n.click()}),r.toggleClass("open",!i).toggleClass("closed",i)}),b.scan(window.document,"tabs"),e(window.document).on("click",".tabs [data-tab-target]",function(t){t.preventDefault();var n=e(this),r=n.parents(".tabs:first"),i=e(n.attr("data-tab-target")),s=r.find("[data-tab-target]");s.each(function(){var t=e(this);t.removeClass("active"),e(t.attr("data-tab-target")).hide()}),n.addClass("active"),i.show()}),e(window.document).on("click",".share:not([data-active])",function(n){n.preventDefault(),e(this).attr("data-active","1"),t.conditionals.scan(e(this).parent(),"share")}),e(window.document).on("click",".modal",function(t){t.preventDefault();var n=e(this),r=n.attr("data-modal")||n.attr("href"),i=n.hasClass("modal-video")?"overlay-video":"",s=n.attr("data-default-tab"),o=!1;if(e("body").find(".receipe-to-riches").length>0||e("body").find(".page-article-details").length>0)o=!0;u.open({content:r,refresh:o,wrapClassName:i,detachOnClose:!0},function(t){var r=u.getElement();typeof captchaStartTime=="number"&&captchaTimer();var i="",o="";typeof n.parents(".no-reviews")[0]!="undefined"&&(r.find(".write-review").css("display","block"),r.find(".read-reviews").css("display","none"),r.find(".tabs li a").removeClass("active"),r.find(".tabs li:eq(1) a").addClass("active"));if(s){var a=parseInt(s,10)-1;r.find(".tab-content").css("display","none"),r.find(".tab-content").eq(a).css("display","block"),r.find(".tabs li a").removeClass("active"),r.find(".tabs li:eq("+a+") a").addClass("active")}n.hasClass("reviews-seeall")?(i=e(".overlay-wrap").find(".read-reviews").attr("class").split(" "),o=i[0]=="read-reviews"?i[1]:i[0],e(".overlay-wrap").find(".write-review").hide(),e(".overlay-wrap").find(".read-reviews").show(),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find("li a").removeClass("active"),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find('li a[data-tab-target*="'+o+'"]').addClass("active")):n.hasClass("reviews-writeyourown")&&(i=e(".overlay-wrap").find(".write-review").attr("class").split(" "),o=i[0]=="write-review"?i[1]:i[0],e(".overlay-wrap").find(".read-reviews").hide(),e(".overlay-wrap").find(".write-review").show(),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find("li a").removeClass("active"),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find('li a[data-tab-target*="'+o+'"]').addClass("active"));if(n.data("modal-open-callback")){var f=n.data("modal-open-callback");window[f]&&typeof (window[f]==="function")&&window[f].call(this,r)}b.scan(r,"tabs")});if(n.is(":focusable")){var a=function(){n.focus(),u.off("close",a)};u.on("close",a)}});var o=function(t){var n=e(this),r,i,s,o,u=n.data("more-fn");if(u===!1)return;if(!u){r=n.find(".header, .details");if(!r.length||!r.find(".more").length)return n.data("more-fn",!1);s=r.height(),n.addClass("no-transition"),r.css("height","auto"),i=r.height(),r.css("height",s),u=function(){o=!o,r.css("height",o?i:"")},n.data("more-fn",u),setTimeout(function(){n.removeClass("no-transition"),u()},10);return}u()},a=function(t){var n=e(this),r=n.data("more-fn");if(!r)return;r()};e(window.document).on({mouseenter:function(t){var n=e(this);n.data("mouseIn",!0);if(n.data("focussedIn"))return;n.data("focussedIn",!0),o.call(this,t)},mouseleave:function(t){var n=e(this);n.removeData("mouseIn");if(n.find("a:focus").length)return;n.removeData("focussedIn"),a.call(this,t)},focusin:function(t){var n=e(this);n.hasClass("accessibility-focus")||n.addClass("accessibility-focus");if(n.data("focussedIn"))return;n.data("focussedIn",!0),o.call(this,t)},focusout:function(t){var n=this,r=e(this)}},".card")},fireClickAnalytics:function(e){if(typeof dataLayer!="undefined")try{dataLayer.push(e)}catch(t){consoleLog(t)}},onDomReady:function(){var t=this,n=d.cssToShow,r=d.cssToHide,i=e("body").data("page-analytics"),o=e(".main.three-ways-to-join .card .footer").attr("data-btn-msg");e(".main.three-ways-to-join .card .footer").each(function(){e(this).find("accessibility-hidden").text(o)}),e(".header-branded .logo a .first-logo")&&e(".header-branded .logo a .first-logo img").attr("tabindex",0),e(".header-branded .logo a .second-logo")&&e(".header-branded .logo a .second-logo img").attr("tabindex",0),i&&i.pageName&&i.pageName=="error-page"&&(e(".page-404 .content .content-404 .title").attr("tabindex",0),e(".page-404 .content .content-404 .title").focus()),e("input[type=select]").on("click",function(){e(this).simulate("mousedown")}),e("input[type=checkbox]").on("focus",function(){e(this).parent("span").css("outline","1px dotted #ccc")}),e("input[type=checkbox]").on("focusout",function(){e(this).parent("span").css("outline","0px dotted #ccc")}),setTimeout(function(){e(".share .buttons .button.pinterest a").attr("href","#"),e(".share .buttons .button.pinterest a").attr("title","pinterest link"),e(".share a.email").attr("title","Email link")},4e3),(i="monthlyflyer")&&e("iframe").css("z-index","-100"),e(".main.create-account .card.card-pcplus-overview .registration-card a").mouseover(function(){e(this).css("text-decoration","underline")}).mouseout(function(){e(this).css("text-decoration","none")}),e(".card-pcplus-overview .registration-card p span a").mouseover(function(){e(this).css("text-decoration","underline")}).mouseout(function(){e(this).css("text-decoration","none")}),t.playerArray="",t.videoArray={},t.videotime=0,t.timeupdater="",t.orgVideoId="",t.videoPlayCount=0,t.videoPositionCount=0;if(e("body").find(".modal-video").length>0){var f=document.createElement("script");f.src="//www.youtube.com/iframe_api";var l=document.getElementsByTagName("script")[0];l.parentNode.insertBefore(f,l)}u.on("create",function(e){e.wrapClassName=="overlay-video"&&t._trackYouTube(t)}),u.on("close",function(){t.videoPlayCount=0,t.videoPositionCount=0});var c="";if(e("body").find(".secondary-logo").length>0&&document.cookie.indexOf("storeNumCookie")>=0){var v=t.cookieManager.getCookieByName("storeNumCookie"),m=d.secondarylogostores;m.indexOf(e.trim(v))>-1?(e(".header-branded .logo .second-logo img").attr("style","padding-left:0px"),e(".first-logo").addClass("hidden"),e(".second-logo").removeClass("hidden")):(e(".first-logo").removeClass("hidden"),e(".second-logo").addClass("hidden"))}else e(".first-logo").removeClass("hidden"),e(".second-logo").removeClass("hidden");e("body").find("form.dynamic-content").length>0&&(e("form.dynamic-content").each(function(){c===""?c=e(this).serialize():c=c+"&"+e(this).serialize()}),h.format=p,e.ajax({type:"POST",url:e(".dynamic-content").attr("action"),data:c,cache:!1,success:function(t){var n=this,r="",i="",s=0;if(typeof t.perfectpairing!="undefined"&&t.perfectpairing.length>0)for(s=0;s<t.perfectpairing.length;s++){var o=t.perfectpairing[s].title.replace(/"/g,'\\"'),u=t.perfectpairing[s].description.replace(/"/g,'\\"');r='{"content_type":"'+t.perfectpairing[s].contentType+'","imgUrl":"'+t.perfectpairing[s].img+'","pathUrl":"'+t.perfectpairing[s].path+'","title":"'+o+'","desc":"'+u+'","imgTitle":"'+t.perfectpairing[s].imgTitle+'","buttonLabel":"'+t.perfectpairing[s].buttonLabel+'","whyNotTryLabel":"'+t.perfectpairing[s].whyNotTryLabel+'"}',r=e.parseJSON(r),i=e(h.render(r)),i.appendTo("."+t.perfectpairing[s].contentType)}if(typeof t.whynottry!="undefined"&&t.whynottry.length>0)for(s=0;s<t.whynottry.length;s++){var a=t.whynottry[s].title.replace(/"/g,'\\"'),f=t.whynottry[s].description.replace(/"/g,'\\"');r='{"content_type":"'+t.whynottry[s].contentType+'","imgUrl":"'+t.whynottry[s].img+'","pathUrl":"'+t.whynottry[s].path+'","title":"'+a+'","desc":"'+f+'","imgTitle":"'+t.whynottry[s].imgTitle+'","buttonLabel":"'+t.whynottry[s].buttonLabel+'","whyNotTryLabel":"'+t.whynottry[s].whyNotTryLabel+'"}',r=e.parseJSON(r),i=e(h.render(r)),i.appendTo("."+t.whynottry[s].contentType)}if(typeof t.tiles!="undefined"&&t.tiles.length>0)for(s=0;s<t.tiles.length;s++){var l=t.tiles[s].title.replace(/"/g,'\\"'),c=t.tiles[s].description.replace(/"/g,'\\"');r='{"content_type":"'+t.tiles[s].contentType+'","img":"'+t.tiles[s].img+'","pathUrl":"'+t.tiles[s].path+'","title":"'+l+'","desc":"'+c+'","imgTitle":"'+t.tiles[s].imgTitle+'","buttonLabel":"'+t.tiles[s].buttonLabel+'","whyNotTryLabel":"'+t.tiles[s].whyNotTryLabel+'"}',r=e.parseJSON(r),i=e(h.render(r)),t.tiles[s].staticContent?t.tiles[s].staticContent&&(e(".card.promo."+t.tiles[s].contentType+"_static").attr("style","display: block"),e(".card.promo."+t.tiles[s].contentType).attr("style","display: none")):(e(".card.promo."+t.tiles[s].contentType+"_static").attr("style","display: none"),e(".card.promo."+t.tiles[s].contentType).attr("style","display: block"),e(".card.promo."+t.tiles[s].contentType).html(""),i.appendTo("."+t.tiles[s].contentType))}},error:function(t,n,r){var i=decodeURIComponent(t.responseText);i=e.parseJSON(i);var s=i.exception,o="<li>"+s+"</li>";e(".err-msg ul").html(o),e(".err-msg").show(),e(".err-msg ul").show()}})),e(".pcplus-dashboard").length>0&&t.welcomeOverlay(),t.initTabEnable();for(var g=0;g<n.length;g++)e("."+n[g]+"").removeClass("hide-section");for(var b=0;b<r.length;b++)e("."+r[b]+"").addClass("hide-section");d.analytics.enabled&&require(["modules/site-analytics"],function(e){e()}),d.provincePrompt&&(console.log("province prompt: "+d.provincePrompt),require(["modules/province-selection"],function(e){e()})),d.headerInfo&&d.headerInfo.showStoreHeader&&t.initStoreDataPopulate(),t.initTooltip(),s({el:".scroll-link"}),y({el:".nav-universal"}),a({el:".nav-contextual"}),t.populateUserFields()},_trackYouTube:function(t){var n=this,r,i=e(".overlay iframe"),s=i.attr("src"),o=!1,u;r=24,o=!0,o&&(u=s.substr(r),u.indexOf("?")>-1&&(u=u.substr(0,u.indexOf("?"))),t.videoArray={},t.videoArray.id=u,e.ajax({dataType:"JSON",url:"https://gdata.youtube.com/feeds/api/videos/"+u+"?v=2&alt=json"}).done(function(n){t.videoArray.title=n.entry.title.$t,e("body section").hasClass("page-pccc-landing")?t.fireAnalytics({category:"pccc landing",action:"engagement:video player modal",label:t.videoArray.title,value:"",event:"GA Event"}):t.fireAnalytics({category:"videos",action:"engagement:video player modal",label:t.videoArray.title,value:"",event:"GA Event"})}),i.attr("id",u)),n._onYouTubeIframeAPIReady(t)},_onYouTubeIframeAPIReady:function(e){var t=this;e.playerArray={},e.playerArray=new YT.Player(e.videoArray.id,{events:{onReady:function(e){}}}),e.playerArray.addEventListener("onStateChange",function(n){t.onPlayerStateChange(n,t,e)})},onPlayerReady:function(e){var t=this;e.emit(t.events.YT_PLAYER_READY)},loadVideo:function(e){var t=this;t.currentID!=e?(t.currentID=e,t.videoPositionCount=0,t.videoPlayCount=0,t.player&&t.player.loadVideoById(e)):t.player.playVideo()},cueVideo:function(e){var t=this;t.currentID=e,t.videoPositionCount=0,t.videoPlayCount=0,t.player&&t.player.cueVideoById(e)},onPlayerStateChange:function(e,t,n){var r=e.target.id-1;e.data==YT.PlayerState.PLAYING?(n.videoPlayCount===0&&(n.emit("initialPlay"),n.videoPlayCount++,t.fireAnalytics({category:"videos",action:n.videoArray.title,label:"video: 0-25",value:"",event:"GA Event"})),n.timeupdater=setInterval(function(){t._updateTime(t,n)},500)):clearInterval(n.timeupdater)},_updateTime:function(e,t){var n=t.videotime;t.playerArray&&t.playerArray.getCurrentTime&&(t.videotime=t.playerArray.getCurrentTime()),t.videotime!==n&&e._onProgress(t.videotime,t)},_onProgress:function(e,t){var n="",r=this,i=t.playerArray.getDuration();if(isNaN(i))return;var s=e/i;switch(!0){case s>=.99&&t.videoPositionCount<5:t.videoPositionCount=5,r.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:complete",value:"",event:"GA Event"}),t.videoPositionCount=0,t.videoPlayCount=0,clearInterval(t.timeupdater);break;case s>=.75&&t.videoPositionCount<4:t.videoPositionCount=4,r.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:76-100",value:"",event:"GA Event"});break;case s>=.5&&t.videoPositionCount<3:t.videoPositionCount=3,r.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:51-75",value:"",event:"GA Event"});break;case s>=.25&&t.videoPositionCount<2:t.videoPositionCount=2,r.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:26-50",value:"",event:"GA Event"});break;case e>=.5&&t.videoPositionCount<1:t.videoPositionCount=1}},initTabEnable:function(){if(location.hash){var t=e(this),n=e(".tabs li a"),r=location.hash.split("!"),i=e(".tabs li").find("."+r[1]);i.length>0&&(n.each(function(){var t=e(this);t.removeClass("active"),e(t.attr("data-tab-target")).hide()}),e("."+r[1]).addClass("active"),e(e("."+r[1]).attr("data-tab-target")).show(),b.scan(window.document,"tabs"))}},initTooltip:function(){var t=this,n=e(".header-branded .tooltip");n.each(function(){o({el:this,offsetX:-3})})},initStoreDataPopulate:function(){var t=this;if(d.headerInfo&&d.headerInfo.state==="IDENTIFIED"&&d.headerInfo.flyerUrl&&d.headerInfo.storeDetailsUrl)t.storeDataPopulate();else{var n={storeResultsUrl:d.headerInfo.storeResultsUrl,flyerLinkText:d.headerInfo.flyerLinkText},r=l.render(n);e(".header-branded .store-info-holder").append(r)}},storeDataPopulate:function(){var t=this,n=e(".linkStoreDetails"),r=e(".linkStoreFlyer"),i=e(".linkStoreFlyerNextWeek"),s=e(".linkCatering"),o=e(".linkCoupon"),u=e(".textStoreName"),a=d.headerInfo.storeResultsUrl,f=d.headerInfo.storeDetailsUrl,l=d.headerInfo.flyerUrl,h=d.headerInfo.flyerLinkText,p=d.headerInfo.flyerNextWeekUrl,v=d.headerInfo.cateringUrl,m=d.headerInfo.couponUrl,g=d.headerInfo.storeHours,y="";n.attr("href",f),n.removeClass("find-store-overlay-trigger"),r.attr("href",l),r.removeClass("find-store-overlay-trigger"),i.attr("href",p),i.removeClass("find-store-overlay-trigger"),s.attr("href",v),s.removeClass("find-store-overlay-trigger"),o.attr("href",m),o.removeClass("find-store-overlay-trigger"),u.text(d.headerInfo.storeName),d.headerInfo.flyerLinkExternal&&(r.attr("target","_blank"),y="_blank");var b={name:d.headerInfo.storeName,storeResultsUrl:a,storeDetailsUrl:f,flyerUrl:l,flyerLinkText:h,storeHours:g,flyerLinkTarget:y},w=c.render(b);e(".header-branded .store-info-holder").append(w),setTimeout(function(){e(".linkStoreDetails").attr("href",f),e(".linkStoreDetails").removeClass("find-store-overlay-trigger"),e(".linkStoreFlyer").attr("href",l),e(".linkStoreFlyer").removeClass("find-store-overlay-trigger")},4e3)},getCookies:function(e){var t=e+"=",n=document.cookie.split(";"),r=0,i=n.length;for(r;r<i;r+=1){var s=n[r];while(s.charAt(0)===" ")s=s.substring(1,s.length);if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null},getDashboard:function(){var e=this;e.userData=e.cookieManager.getCookieByName(e.constants.cookieNames.USER_COOKIE),require(["modules/pcplus-dashboard"],function(t){e.userDashboard=new t({userData:e.userData})})},populateUserFields:function(){var t=this;typeof t.userData!="undefined"&&e(".user-name").each(function(n){var r=e(this);r.hasClass("greeting")?r.text(r.text()+t.userData.name):r.html(t.userData.name)})},welcomeOverlay:function(){var t=this,n="overlay-pcplus";if(d.pcplus&&d.pcplus.welcomeOverlayPath&&d.pcplus.welcomeOverlayPath!==""){var r=d.pcplus.welcomeOverlayPath,i=t.cookieManager.getCookieByName(t.constants.cookieNames.USER_COOKIE);u.open({content:r,wrapClassName:n}),u.on("create",function(r){var s=u.getElement(),o=s.find(".pcplus-welcome-overlay").length>0;if(o){var a=s.find(".pcplus-welcome-overlay").data("overlay-template-name"),f={category:"pc plus",action:"welcome modals:"+a,label:"view",value:"",event:"GA Event"};t.fireAnalytics(f);if(!s.hasClass(n))return;var l=s.find(".btn-positive"),c=s.find(".btn-negative"),h=s.find("a");if(typeof i!="undefined"&&i.hasOwnProperty("mid")){var p=i,d=p.name?p.name:"";s.find(".user-name").text(d)}l.length>0&&l.on("click",function(e){location.href=l.attr("href")}),h.length>0&&h.on("click",function(n){var r=e(this).text(),i={category:"pc plus",action:"welcome modals:"+a,label:"click:"+r,value:"",event:"GA Event"};t.fireAnalytics(i),u.close()})}}),u.on("close",function(n){var r=u.getElement(),i=r.find(".pcplus-welcome-overlay").length>0;if(i){var s=t.cookieManager.getCookieByName(t.constants.cookieNames.USER_OVERLAY_STATUS);e.isArray(s)&&s.shift(),t.cookieManager.setCookie(t.constants.cookieNames.USER_OVERLAY_STATUS,s,"","/",d.cookieDomain,!0)}})}},_aodaerror:function(t){e(t).each(function(){e(this).attr("tabindex",0)}),e("form :focus").blur();var n=e(t).filter(function(){return e(this).css("display")!="none"});t==".form-errors p"||t==".err-msg p"?n.first().focus():t==".form-errors"&&e(t).focus()},fireAnalytics:function(e){window.dataLayer=window.dataLayer||[];if(typeof window.dataLayer=="undefined")return!1;try{return window.dataLayer.push(e),!0}catch(t){return!1}}});return new E}),define("modules/store-markers",["jquery","stapes","modules/api-tools","json!config","tpl!templates/global.store-info-window.html","modules/format"],function(e,t,n,r,i,s){i.format=s;var o={map:null},u=t.subclass({constructor:function(t){var n=this;n.config=e.extend({},o,t),n.map=n.config.map;if(!n.map)return;n.initEvents()},initEvents:function(){var e=this;e.on({click:function(t){e.openInfoWindow(t)}})},closeInfoWindow:function(){var e=this;e.currentInfoWindow&&e.currentInfoWindow.close(),e.currentInfoWindow=!1},openInfoWindow:function(e){var t=this,n=t.get(e);typeof console!="undefined"&&(console.log(t.currentInfoWindow),console.log(typeof t.currentInfoWindow));if(!n)return t;t.currentInfoWindow!==n.infoWindow&&(typeof t.currentInfoWindow!="undefined"&&google.maps.event.clearListeners(t.currentInfoWindow,"closeclick"),t.closeInfoWindow(),t.currentInfoWindow=n.infoWindow,google.maps.event.addListener(t.currentInfoWindow,"closeclick",function(){t.closeInfoWindow()}),t.currentInfoWindow.open(t.map,n.marker))},createMarker:function(e,t){if(!window.google){typeof console!="undefined"&&console.log("Google not loaded");return}var n=this,s=google.maps,o=new s.MarkerImage(t.identifierPin,new s.Size(21,34),new s.Point(0,0),new s.Point(10,34)),u=new s.MarkerImage(r.storeLocator.pinShadowUrlTpl,new s.Size(40,37),new s.Point(0,0),new s.Point(12,35)),a=new s.Marker({position:e,map:n.map,icon:o,shadow:u,title:t.banner.bannerName}),f=new s.InfoWindow({content:i.render(t)}),l="marker-"+t.identifier,c={marker:a,infoWindow:f};s.event.addListener(a,"click",function(){n.emit("click",l),n.emit("click:"+l,c)}),n.set(l,c)},clear:function(){var e=this;e.closeInfoWindow(),e.remove(function(e){return e.marker.setMap(null),!0})}});return function(e){return new u(e)}}),function(){function t(e,t,n,r,i,s){t[e]&&(n.push(e),(t[e]===!0||t[e]===1)&&r.push(i+e+"/"+s))}function n(e,t,n,r,i){var s=r+t+"/"+i;require._fileExists(e.toUrl(s+".js"))&&n.push(s)}function r(e,t,n){var i;for(i in t)t.hasOwnProperty(i)&&(!e.hasOwnProperty(i)||n)?e[i]=t[i]:typeof t[i]=="object"&&(!e[i]&&t[i]&&(e[i]={}),r(e[i],t[i],n))}var e=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.4",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f,l=e.exec(i),c=l[1],h=l[4],p=l[5],d=h.split("-"),v=[],m={},g,y,b="";l[5]?(c=l[1],f=c+p):(f=i,p=l[4],h=s.locale,h||(h=s.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),d=h.split("-"));if(a.isBuild){v.push(f),n(o,"root",v,c,p);for(g=0;g<d.length;g++)y=d[g],b+=(b?"-":"")+y,n(o,b,v,c,p);o(v,function(){u()})}else o([f],function(e){var n=[],i;t("root",e,n,v,c,p);for(g=0;g<d.length;g++)i=d[g],b+=(b?"-":"")+i,t(b,e,n,v,c,p);o(v,function(){var t,i,s;for(t=n.length-1;t>-1&&n[t];t--){s=n[t],i=e[s];if(i===!0||i===1)i=o(c+s+"/"+p);r(m,i)}u(m)})})}}})}(),define("nls/speak",{root:{header:"Find Your Local Pharmacy",searchlbl:"Search results for:",frmplaceholder:"Enter your address, postal code or city",btnfind:"Find",btnback:"Back to Home",storehr:"Store Hours",storesrv:"Store Services",btnselstore:"Select This Store",errmsg:"No Results Found"},fr_CA:!0}),define("mediators/storelocator",["jquery","stapes","modules/api-tools","./globals","modules/store-markers","tpl!templates/global.store-result.html","modules/format","i18n!nls/speak"],function(e,t,n,r,i,s,o,u){var a="storeIdCookie",f="storeNumCookie",l="storeNameCookie",c="storeProvienceCookie",h=e.parseJSON(e("input[name='storelocator']").val()),p=t.subclass({constructor:function(){var t=this;t.bindEvents(),t.storeIdCookie="storeIdCookie",t.storeNameCookie="storeNameCookie",t.storeNumCookie="storeNumCookie",t.el=this&&this.document&&this.document.documentElement,h.departments&&h.departments==="4300002"&&t.setupSearchForPCPlus(),e(function(){t.emit("domready")})},setupSearchForPCPlus:function(){var t=e("#form-store-locator"),n=t.find('.departments input[type="checkbox"]'),r=n.filter("[value=4300002]");r.length>0&&r.prop("checked",!0).closest("span").addClass("checked")},bindEvents:function(){var e=this;e.on("domready",e.onDomReady)},localizetxt:function(){e(".page-details.locator .content h1").html(u.header),e(".page-details.locator .store-locator h4").html(u.searchlbl),e(".page-details.locator .store-listing .store-info .store-hours a").text(u.storehr),e(".page-details.locator .store-listing .store-services a").html(u.storesrv),e(".store-locator form input[type='text']").attr("placeholder",u.frmplaceholder),e(".store-locator form button.button-erefill").html(u.btnfind),e(".store-locator form a.button-erefill").html(u.btnback),e(".store-locator .store-listing .store-info .button.select-store-button").text(u.btnselstore),e(".store-locator form .error p").html(u.errmsg)},onDomReady:function(){function u(e){var t=window.location.search.substring(1),n=t.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");if(i[0]==e)return i[1]}}var t=this,n,r,i,s,o;n=e(location).attr("href"),r=n.indexOf("c/"),i=n.indexOf("storelocator.html"),s=n.slice(r+2,i-1),e("#form-store-locator .button-erefill.red").on("click",function(t){t.preventDefault(),localStorage.removeItem("erefill-storeloc"),e("#form-store-locator").submit()});var a=t.getUrlParameter("departments"),f=t.getUrlParameter("location"),l=localStorage.getItem("erefill-storeloc"),c,h=t.el&&t.attr(t.el,"data-context")||"lcl-erefill-services";c="/"+h+"/en_CA/store/location/"+f+"/department/300064/proximity/50/fetch/10",e("#form-store-locator").find("input[type=text]").val(f.replace("+"," ")),e(".enlang").on("click",function(t){t.preventDefault(),o=window.location,o=o.replace(s,"en_CA"),window.location.href=e(this).attr("href")+"?location="+f}),e(".frlang").on("click",function(t){t.preventDefault(),o=window.location,o=o.replace(s,"fr_CA"),window.location.href=e(this).attr("href")+"?location="+f}),e("#form-store-locator").attr("data-storeloc",c),window.google?(t.G=window.google.maps,t.initLocator()):(window.google_callback=function(){t.G=window.google.maps,t.initLocator()},require(["//maps.google.com/maps/api/js?sensor=false&callback=google_callback"]))},getUrlParameter:function(e){var t=window.location.search.substring(1),n=t.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");if(i[0]==e)return i[1]}},initLocator:function(){var t=this,n=e("#form-store-locator"),r='.departments input[type="checkbox"]',u=n.find(r),a=e(".map_canvas"),f=h.mapDefaults,l={mapTypeId:t.G.MapTypeId[f.mapType],center:new t.G.LatLng(f.center.lat,f.center.lng),zoom:f.zoom};t.$formStoreSearch=n,t.$departments=u,u.filter('[value=""], :not([value])').attr("disabled","disabled").closest("li").addClass("disabled"),s.format=o,t.prevSearch="",t.infoWindows=[],t.btnFind=e(".btn-find",n),t.inputSearch=e(".input-search",n),t.storeListing=e(".main .store-listing"),t.map=new t.G.Map(a[0],l),t.markers=i({map:t.map}),t.currentLocation=null,!t.inputSearch.val()||t.inputSearch.val()===""?t.searchStores(h.defaultSearch):t.searchStores(t.getUrlParameter("location")),n.on("change",r,function(e){t.searchStores()}),e(".main-store-locator").on("click",".store-info .title a, .store-info .map-marker",function(n){n.preventDefault();var r=e(this).attr("data-identifier");t.markers.openInfoWindow("marker-"+r)})},searchStores:function(e){var t=this;e=e?e:t.inputSearch.val();if(e){var n=new t.G.Geocoder;n.geocode({address:e},function(n,r){if(r===t.G.GeocoderStatus.OK)try{t.currentLocation=n[0].geometry.location}catch(i){}else t.currentLocation=null;t.buildStoreList(e)})}},buildStoreList:function(t){console.log("buildStoreList");var n=this,r,i=n.$formStoreSearch,s=n.$departments,o=i.find(".error"),u=i.find(".input-search"),a;n.mapBounds=new n.G.LatLngBounds,r=e.makeArray(s.filter(":checked").map(function(){return e(this).val()}));var f=i.attr("data-storeloc"),l=localStorage.getItem("erefill-storeloc");if(!l)n.xhr&&n.xhr.abort&&n.xhr.abort(),n.xhr=e.ajax({type:"GET",contentType:"application/x-www-form-urlencoded",url:f,success:function(r){r="["+decodeURIComponent(r)+"]",r=e.parseJSON(r);var i=r[0].stores;n.markers.clear(),n.storeListing.empty(),i&&i.length>0?(o.hide(),u.removeClass("input-error"),e.each(i,function(e,r){var i=String.fromCharCode(65+e);n.showResult(i,t,r)}),n.map.fitBounds(n.mapBounds)):(o.show(),u.addClass("input-error"))},error:function(e,t){}});else{var c="["+decodeURIComponent(l)+"]";c=e.parseJSON(c);var h=c[0].stores;o.hide(),u.removeClass("input-error"),e.each(h,function(e,r){var i=String.fromCharCode(65+e);n.showResult(i,t,r)}),n.map.fitBounds(n.mapBounds)}},showResult:function(t,r,i){var o=this,u=new o.G.LatLng(i.address.latitude,i.address.longitude),a=e.extend({identifier:t,identifierPin:n.uriTemplate(h.pinUrlTpl,{identifier:t}),fromAddress:r,distance:i.distance},i),f=e(s.render(a));o.localizetxt(),o.markers.createMarker(u,a),f.appendTo(o.storeListing).on("click","a.button",{id:i.id,storeNumber:i.storeNumber,storeProvince:i.address.province,storeName:i.storeName},o.onSelectStore),o.mapBounds.extend(u)},calculateDistanceTo:function(e){var t=this;if(!t.currentLocation)return"";var n=t.G.geometry.spherical.computeDistanceBetween(e,t.currentLocation)/1e3;return n.toFixed(1).replace(".0","")+"km"},onSelectStore:function(t){t.preventDefault();var n=e(this),i=n.attr("href");r.cookieManager.setCookie(a,t.data.id,h.cookieExpiry,"/",h.cookieDomain,!1),r.cookieManager.setCookie(f,t.data.storeNumber,h.cookieExpiry,"/",h.cookieDomain,!1),r.cookieManager.setCookie(c,t.data.storeProvince,h.cookieExpiry,"/",h.cookieDomain,!1),window.location.href=i}});return new p}),require(["require-config"],function(){require(["mediators/storelocator"])}),define("page-storelocator",function(){}),define("page-storelocator",function(){});