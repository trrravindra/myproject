/*! box2d-jquery - v0.8 - last build: 2013-02-21 21:36:54 */

define(["jquery","rAF"],function(e,t){var n={};(function(e,t){function n(){}!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(e,t,n){n.get instanceof Function&&e.__defineGetter__(t,n.get),n.set instanceof Function&&e.__defineSetter__(t,n.set)}),e.inherit=function(e,t){n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},e.generateCallback=function(e,t){return function(){t.apply(e,arguments)}},e.NVector=function(e){e===t&&(e=0);for(var n=Array(e||0),r=0;r<e;++r)n[r]=0;return n},e.is=function(e,n){return e===null?!1:n instanceof Function&&e instanceof n?!0:e.constructor.__implements!=t&&e.constructor.__implements[n]?!0:!1},e.parseUInt=function(e){return Math.abs(parseInt(e))}})(n);var r=Array,i=n.NVector;typeof n=="undefined"&&(n={}),typeof n.Collision=="undefined"&&(n.Collision={}),typeof n.Collision.Shapes=="undefined"&&(n.Collision.Shapes={}),typeof n.Common=="undefined"&&(n.Common={}),typeof n.Common.Math=="undefined"&&(n.Common.Math={}),typeof n.Dynamics=="undefined"&&(n.Dynamics={}),typeof n.Dynamics.Contacts=="undefined"&&(n.Dynamics.Contacts={}),typeof n.Dynamics.Controllers=="undefined"&&(n.Dynamics.Controllers={}),typeof n.Dynamics.Joints=="undefined"&&(n.Dynamics.Joints={}),function(){function e(){e.b2AABB.apply(this,arguments)}function t(){t.b2Bound.apply(this,arguments)}function r(){r.b2BoundValues.apply(this,arguments),this.constructor===r&&this.b2BoundValues.apply(this,arguments)}function i(){i.b2Collision.apply(this,arguments)}function s(){s.b2ContactID.apply(this,arguments),this.constructor===s&&this.b2ContactID.apply(this,arguments)}function o(){o.b2ContactPoint.apply(this,arguments)}function u(){u.b2Distance.apply(this,arguments)}function a(){a.b2DistanceInput.apply(this,arguments)}function f(){f.b2DistanceOutput.apply(this,arguments)}function l(){l.b2DistanceProxy.apply(this,arguments)}function c(){c.b2DynamicTree.apply(this,arguments),this.constructor===c&&this.b2DynamicTree.apply(this,arguments)}function h(){h.b2DynamicTreeBroadPhase.apply(this,arguments)}function p(){p.b2DynamicTreeNode.apply(this,arguments)}function d(){d.b2DynamicTreePair.apply(this,arguments)}function v(){v.b2Manifold.apply(this,arguments),this.constructor===v&&this.b2Manifold.apply(this,arguments)}function m(){m.b2ManifoldPoint.apply(this,arguments),this.constructor===m&&this.b2ManifoldPoint.apply(this,arguments)}function g(){g.b2Point.apply(this,arguments)}function y(){y.b2RayCastInput.apply(this,arguments),this.constructor===y&&this.b2RayCastInput.apply(this,arguments)}function b(){b.b2RayCastOutput.apply(this,arguments)}function w(){w.b2Segment.apply(this,arguments)}function E(){E.b2SeparationFunction.apply(this,arguments)}function S(){S.b2Simplex.apply(this,arguments),this.constructor===S&&this.b2Simplex.apply(this,arguments)}function x(){x.b2SimplexCache.apply(this,arguments)}function T(){T.b2SimplexVertex.apply(this,arguments)}function N(){N.b2TimeOfImpact.apply(this,arguments)}function C(){C.b2TOIInput.apply(this,arguments)}function k(){k.b2WorldManifold.apply(this,arguments),this.constructor===k&&this.b2WorldManifold.apply(this,arguments)}function L(){L.ClipVertex.apply(this,arguments)}function A(){A.Features.apply(this,arguments)}function O(){O.b2CircleShape.apply(this,arguments),this.constructor===O&&this.b2CircleShape.apply(this,arguments)}function M(){M.b2EdgeChainDef.apply(this,arguments),this.constructor===M&&this.b2EdgeChainDef.apply(this,arguments)}function _(){_.b2EdgeShape.apply(this,arguments),this.constructor===_&&this.b2EdgeShape.apply(this,arguments)}function D(){D.b2MassData.apply(this,arguments)}function P(){P.b2PolygonShape.apply(this,arguments),this.constructor===P&&this.b2PolygonShape.apply(this,arguments)}function H(){H.b2Shape.apply(this,arguments),this.constructor===H&&this.b2Shape.apply(this,arguments)}function B(){B.b2Color.apply(this,arguments),this.constructor===B&&this.b2Color.apply(this,arguments)}function j(){j.b2Settings.apply(this,arguments)}function F(){F.b2Mat22.apply(this,arguments),this.constructor===F&&this.b2Mat22.apply(this,arguments)}function I(){I.b2Mat33.apply(this,arguments),this.constructor===I&&this.b2Mat33.apply(this,arguments)}function q(){q.b2Math.apply(this,arguments)}function R(){R.b2Sweep.apply(this,arguments)}function U(){U.b2Transform.apply(this,arguments),this.constructor===U&&this.b2Transform.apply(this,arguments)}function z(){z.b2Vec2.apply(this,arguments),this.constructor===z&&this.b2Vec2.apply(this,arguments)}function W(){W.b2Vec3.apply(this,arguments),this.constructor===W&&this.b2Vec3.apply(this,arguments)}function X(){X.b2Body.apply(this,arguments),this.constructor===X&&this.b2Body.apply(this,arguments)}function V(){V.b2BodyDef.apply(this,arguments),this.constructor===V&&this.b2BodyDef.apply(this,arguments)}function $(){$.b2ContactFilter.apply(this,arguments)}function J(){J.b2ContactImpulse.apply(this,arguments)}function K(){K.b2ContactListener.apply(this,arguments)}function Q(){Q.b2ContactManager.apply(this,arguments),this.constructor===Q&&this.b2ContactManager.apply(this,arguments)}function G(){G.b2DebugDraw.apply(this,arguments),this.constructor===G&&this.b2DebugDraw.apply(this,arguments)}function Y(){Y.b2DestructionListener.apply(this,arguments)}function Z(){Z.b2FilterData.apply(this,arguments)}function et(){et.b2Fixture.apply(this,arguments),this.constructor===et&&this.b2Fixture.apply(this,arguments)}function tt(){tt.b2FixtureDef.apply(this,arguments),this.constructor===tt&&this.b2FixtureDef.apply(this,arguments)}function nt(){nt.b2Island.apply(this,arguments),this.constructor===nt&&this.b2Island.apply(this,arguments)}function rt(){rt.b2TimeStep.apply(this,arguments)}function it(){it.b2World.apply(this,arguments),this.constructor===it&&this.b2World.apply(this,arguments)}function st(){st.b2CircleContact.apply(this,arguments)}function ot(){ot.b2Contact.apply(this,arguments),this.constructor===ot&&this.b2Contact.apply(this,arguments)}function ut(){ut.b2ContactConstraint.apply(this,arguments),this.constructor===ut&&this.b2ContactConstraint.apply(this,arguments)}function at(){at.b2ContactConstraintPoint.apply(this,arguments)}function ft(){ft.b2ContactEdge.apply(this,arguments)}function lt(){lt.b2ContactFactory.apply(this,arguments),this.constructor===lt&&this.b2ContactFactory.apply(this,arguments)}function ct(){ct.b2ContactRegister.apply(this,arguments)}function ht(){ht.b2ContactResult.apply(this,arguments)}function pt(){pt.b2ContactSolver.apply(this,arguments),this.constructor===pt&&this.b2ContactSolver.apply(this,arguments)}function dt(){dt.b2EdgeAndCircleContact.apply(this,arguments)}function vt(){vt.b2NullContact.apply(this,arguments),this.constructor===vt&&this.b2NullContact.apply(this,arguments)}function mt(){mt.b2PolyAndCircleContact.apply(this,arguments)}function gt(){gt.b2PolyAndEdgeContact.apply(this,arguments)}function yt(){yt.b2PolygonContact.apply(this,arguments)}function bt(){bt.b2PositionSolverManifold.apply(this,arguments),this.constructor===bt&&this.b2PositionSolverManifold.apply(this,arguments)}function wt(){wt.b2BuoyancyController.apply(this,arguments)}function Et(){Et.b2ConstantAccelController.apply(this,arguments)}function St(){St.b2ConstantForceController.apply(this,arguments)}function xt(){xt.b2Controller.apply(this,arguments)}function Tt(){Tt.b2ControllerEdge.apply(this,arguments)}function Nt(){Nt.b2GravityController.apply(this,arguments)}function Ct(){Ct.b2TensorDampingController.apply(this,arguments)}function kt(){kt.b2DistanceJoint.apply(this,arguments),this.constructor===kt&&this.b2DistanceJoint.apply(this,arguments)}function Lt(){Lt.b2DistanceJointDef.apply(this,arguments),this.constructor===Lt&&this.b2DistanceJointDef.apply(this,arguments)}function At(){At.b2FrictionJoint.apply(this,arguments),this.constructor===At&&this.b2FrictionJoint.apply(this,arguments)}function Ot(){Ot.b2FrictionJointDef.apply(this,arguments),this.constructor===Ot&&this.b2FrictionJointDef.apply(this,arguments)}function Mt(){Mt.b2GearJoint.apply(this,arguments),this.constructor===Mt&&this.b2GearJoint.apply(this,arguments)}function _t(){_t.b2GearJointDef.apply(this,arguments),this.constructor===_t&&this.b2GearJointDef.apply(this,arguments)}function Dt(){Dt.b2Jacobian.apply(this,arguments)}function Pt(){Pt.b2Joint.apply(this,arguments),this.constructor===Pt&&this.b2Joint.apply(this,arguments)}function Ht(){Ht.b2JointDef.apply(this,arguments),this.constructor===Ht&&this.b2JointDef.apply(this,arguments)}function Bt(){Bt.b2JointEdge.apply(this,arguments)}function jt(){jt.b2LineJoint.apply(this,arguments),this.constructor===jt&&this.b2LineJoint.apply(this,arguments)}function Ft(){Ft.b2LineJointDef.apply(this,arguments),this.constructor===Ft&&this.b2LineJointDef.apply(this,arguments)}function It(){It.b2MouseJoint.apply(this,arguments),this.constructor===It&&this.b2MouseJoint.apply(this,arguments)}function qt(){qt.b2MouseJointDef.apply(this,arguments),this.constructor===qt&&this.b2MouseJointDef.apply(this,arguments)}function Rt(){Rt.b2PrismaticJoint.apply(this,arguments),this.constructor===Rt&&this.b2PrismaticJoint.apply(this,arguments)}function Ut(){Ut.b2PrismaticJointDef.apply(this,arguments),this.constructor===Ut&&this.b2PrismaticJointDef.apply(this,arguments)}function zt(){zt.b2PulleyJoint.apply(this,arguments),this.constructor===zt&&this.b2PulleyJoint.apply(this,arguments)}function Wt(){Wt.b2PulleyJointDef.apply(this,arguments),this.constructor===Wt&&this.b2PulleyJointDef.apply(this,arguments)}function Xt(){Xt.b2RevoluteJoint.apply(this,arguments),this.constructor===Xt&&this.b2RevoluteJoint.apply(this,arguments)}function Vt(){Vt.b2RevoluteJointDef.apply(this,arguments),this.constructor===Vt&&this.b2RevoluteJointDef.apply(this,arguments)}function $t(){$t.b2WeldJoint.apply(this,arguments),this.constructor===$t&&this.b2WeldJoint.apply(this,arguments)}function Jt(){Jt.b2WeldJointDef.apply(this,arguments),this.constructor===Jt&&this.b2WeldJointDef.apply(this,arguments)}n.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",n.Collision.b2AABB=e,n.Collision.b2Bound=t,n.Collision.b2BoundValues=r,n.Collision.b2Collision=i,n.Collision.b2ContactID=s,n.Collision.b2ContactPoint=o,n.Collision.b2Distance=u,n.Collision.b2DistanceInput=a,n.Collision.b2DistanceOutput=f,n.Collision.b2DistanceProxy=l,n.Collision.b2DynamicTree=c,n.Collision.b2DynamicTreeBroadPhase=h,n.Collision.b2DynamicTreeNode=p,n.Collision.b2DynamicTreePair=d,n.Collision.b2Manifold=v,n.Collision.b2ManifoldPoint=m,n.Collision.b2Point=g,n.Collision.b2RayCastInput=y,n.Collision.b2RayCastOutput=b,n.Collision.b2Segment=w,n.Collision.b2SeparationFunction=E,n.Collision.b2Simplex=S,n.Collision.b2SimplexCache=x,n.Collision.b2SimplexVertex=T,n.Collision.b2TimeOfImpact=N,n.Collision.b2TOIInput=C,n.Collision.b2WorldManifold=k,n.Collision.ClipVertex=L,n.Collision.Features=A,n.Collision.Shapes.b2CircleShape=O,n.Collision.Shapes.b2EdgeChainDef=M,n.Collision.Shapes.b2EdgeShape=_,n.Collision.Shapes.b2MassData=D,n.Collision.Shapes.b2PolygonShape=P,n.Collision.Shapes.b2Shape=H,n.Common.b2internal="Box2D.Common.b2internal",n.Common.b2Color=B,n.Common.b2Settings=j,n.Common.Math.b2Mat22=F,n.Common.Math.b2Mat33=I,n.Common.Math.b2Math=q,n.Common.Math.b2Sweep=R,n.Common.Math.b2Transform=U,n.Common.Math.b2Vec2=z,n.Common.Math.b2Vec3=W,n.Dynamics.b2Body=X,n.Dynamics.b2BodyDef=V,n.Dynamics.b2ContactFilter=$,n.Dynamics.b2ContactImpulse=J,n.Dynamics.b2ContactListener=K,n.Dynamics.b2ContactManager=Q,n.Dynamics.b2DebugDraw=G,n.Dynamics.b2DestructionListener=Y,n.Dynamics.b2FilterData=Z,n.Dynamics.b2Fixture=et,n.Dynamics.b2FixtureDef=tt,n.Dynamics.b2Island=nt,n.Dynamics.b2TimeStep=rt,n.Dynamics.b2World=it,n.Dynamics.Contacts.b2CircleContact=st,n.Dynamics.Contacts.b2Contact=ot,n.Dynamics.Contacts.b2ContactConstraint=ut,n.Dynamics.Contacts.b2ContactConstraintPoint=at,n.Dynamics.Contacts.b2ContactEdge=ft,n.Dynamics.Contacts.b2ContactFactory=lt,n.Dynamics.Contacts.b2ContactRegister=ct,n.Dynamics.Contacts.b2ContactResult=ht,n.Dynamics.Contacts.b2ContactSolver=pt,n.Dynamics.Contacts.b2EdgeAndCircleContact=dt,n.Dynamics.Contacts.b2NullContact=vt,n.Dynamics.Contacts.b2PolyAndCircleContact=mt,n.Dynamics.Contacts.b2PolyAndEdgeContact=gt,n.Dynamics.Contacts.b2PolygonContact=yt,n.Dynamics.Contacts.b2PositionSolverManifold=bt,n.Dynamics.Controllers.b2BuoyancyController=wt,n.Dynamics.Controllers.b2ConstantAccelController=Et,n.Dynamics.Controllers.b2ConstantForceController=St,n.Dynamics.Controllers.b2Controller=xt,n.Dynamics.Controllers.b2ControllerEdge=Tt,n.Dynamics.Controllers.b2GravityController=Nt,n.Dynamics.Controllers.b2TensorDampingController=Ct,n.Dynamics.Joints.b2DistanceJoint=kt,n.Dynamics.Joints.b2DistanceJointDef=Lt,n.Dynamics.Joints.b2FrictionJoint=At,n.Dynamics.Joints.b2FrictionJointDef=Ot,n.Dynamics.Joints.b2GearJoint=Mt,n.Dynamics.Joints.b2GearJointDef=_t,n.Dynamics.Joints.b2Jacobian=Dt,n.Dynamics.Joints.b2Joint=Pt,n.Dynamics.Joints.b2JointDef=Ht,n.Dynamics.Joints.b2JointEdge=Bt,n.Dynamics.Joints.b2LineJoint=jt,n.Dynamics.Joints.b2LineJointDef=Ft,n.Dynamics.Joints.b2MouseJoint=It,n.Dynamics.Joints.b2MouseJointDef=qt,n.Dynamics.Joints.b2PrismaticJoint=Rt,n.Dynamics.Joints.b2PrismaticJointDef=Ut,n.Dynamics.Joints.b2PulleyJoint=zt,n.Dynamics.Joints.b2PulleyJointDef=Wt,n.Dynamics.Joints.b2RevoluteJoint=Xt,n.Dynamics.Joints.b2RevoluteJointDef=Vt,n.Dynamics.Joints.b2WeldJoint=$t,n.Dynamics.Joints.b2WeldJointDef=Jt}(),n.postDefs=[],function(){var e=n.Collision.Shapes.b2CircleShape,t=n.Collision.Shapes.b2PolygonShape,s=n.Collision.Shapes.b2Shape,o=n.Common.b2Settings,u=n.Common.Math.b2Math,a=n.Common.Math.b2Sweep,f=n.Common.Math.b2Transform,l=n.Common.Math.b2Vec2,c=n.Collision.b2AABB,h=n.Collision.b2Bound,p=n.Collision.b2BoundValues,d=n.Collision.b2Collision,v=n.Collision.b2ContactID,m=n.Collision.b2ContactPoint,g=n.Collision.b2Distance,y=n.Collision.b2DistanceInput,b=n.Collision.b2DistanceOutput,w=n.Collision.b2DistanceProxy,E=n.Collision.b2DynamicTree,S=n.Collision.b2DynamicTreeBroadPhase,x=n.Collision.b2DynamicTreeNode,T=n.Collision.b2DynamicTreePair,N=n.Collision.b2Manifold,C=n.Collision.b2ManifoldPoint,k=n.Collision.b2Point,L=n.Collision.b2RayCastInput,A=n.Collision.b2RayCastOutput,O=n.Collision.b2Segment,M=n.Collision.b2SeparationFunction,_=n.Collision.b2Simplex,D=n.Collision.b2SimplexCache,P=n.Collision.b2SimplexVertex,H=n.Collision.b2TimeOfImpact,B=n.Collision.b2TOIInput,j=n.Collision.b2WorldManifold,F=n.Collision.ClipVertex,I=n.Collision.Features,q=n.Collision.IBroadPhase;c.b2AABB=function(){this.lowerBound=new l,this.upperBound=new l},c.prototype.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return e=(e=this.upperBound.x-this.lowerBound.x>=0&&e>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},c.prototype.GetCenter=function(){return new l((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},c.prototype.GetExtents=function(){return new l((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},c.prototype.Contains=function(e){var t=!0;return t=(t=(t=(t=t&&this.lowerBound.x<=e.lowerBound.x)&&this.lowerBound.y<=e.lowerBound.y)&&e.upperBound.x<=this.upperBound.x)&&e.upperBound.y<=this.upperBound.y},c.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(u),f=e.normal,l=0,c=0,h=l=0;h=0;if(Math.abs(o)<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{l=1/o,c=(this.lowerBound.x-i)*l,l=(this.upperBound.x-i)*l,h=-1,c>l&&(h=c,c=l,l=h,h=1),c>n&&(f.x=h,f.y=0,n=c),r=Math.min(r,l);if(n>r)return!1}if(a<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{l=1/u,c=(this.lowerBound.y-s)*l,l=(this.upperBound.y-s)*l,h=-1,c>l&&(h=c,c=l,l=h,h=1),c>n&&(f.y=h,f.x=0,n=c),r=Math.min(r,l);if(n>r)return!1}return e.fraction=n,!0},c.prototype.TestOverlap=function(e){var t=e.lowerBound.y-this.upperBound.y,n=this.lowerBound.y-e.upperBound.y;return e.lowerBound.x-this.upperBound.x>0||t>0?!1:this.lowerBound.x-e.upperBound.x>0||n>0?!1:!0},c.Combine=function(e,t){var n=new c;return n.Combine(e,t),n},c.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},h.b2Bound=function(){},h.prototype.IsLower=function(){return(this.value&1)==0},h.prototype.IsUpper=function(){return(this.value&1)==1},h.prototype.Swap=function(e){var t=this.value,n=this.proxy,r=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=n,e.stabbingCount=r},p.b2BoundValues=function(){},p.prototype.b2BoundValues=function(){this.lowerValues=new i,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new i,this.upperValues[0]=0,this.upperValues[1]=0},d.b2Collision=function(){},d.ClipSegmentToLine=function(e,t,n,r){r===undefined&&(r=0);var i,s=0;i=t[0];var o=i.v;i=t[1];var u=i.v,a=n.x*o.x+n.y*o.y-r;return i=n.x*u.x+n.y*u.y-r,a<=0&&e[s++].Set(t[0]),i<=0&&e[s++].Set(t[1]),a*i<0&&(n=a/(a-i),i=e[s],i=i.v,i.x=o.x+n*(u.x-o.x),i.y=o.y+n*(u.y-o.y),i=e[s],i.id=(a>0?t[0]:t[1]).id,++s),s},d.EdgeSeparation=function(e,t,n,r,i){n===undefined&&(n=0),parseInt(e.m_vertexCount);var s=e.m_vertices;e=e.m_normals;var o=parseInt(r.m_vertexCount),u=r.m_vertices,a,f;a=t.R,f=e[n],e=a.col1.x*f.x+a.col2.x*f.y,r=a.col1.y*f.x+a.col2.y*f.y,a=i.R;var l=a.col1.x*e+a.col1.y*r;a=a.col2.x*e+a.col2.y*r;for(var c=0,h=Number.MAX_VALUE,p=0;p<o;++p)f=u[p],f=f.x*l+f.y*a,f<h&&(h=f,c=p);return f=s[n],a=t.R,n=t.position.x+(a.col1.x*f.x+a.col2.x*f.y),t=t.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=u[c],a=i.R,s=i.position.x+(a.col1.x*f.x+a.col2.x*f.y),i=i.position.y+(a.col1.y*f.x+a.col2.y*f.y),s-=n,i-=t,s*e+i*r},d.FindMaxSeparation=function(e,t,n,r,i){var s=parseInt(t.m_vertexCount),o=t.m_normals,u,a;a=i.R,u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y),l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R,u=t.m_centroid,f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y),l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y),a=f*n.R.col1.x+l*n.R.col1.y,l=f*n.R.col2.x+l*n.R.col2.y,f=0;for(var c=-Number.MAX_VALUE,h=0;h<s;++h)u=o[h],u=u.x*a+u.y*l,u>c&&(c=u,f=h);o=d.EdgeSeparation(t,n,f,r,i),u=parseInt(f-1>=0?f-1:s-1),a=d.EdgeSeparation(t,n,u,r,i),l=parseInt(f+1<s?f+1:0),c=d.EdgeSeparation(t,n,l,r,i);var p=h=0,v=0;if(a>o&&a>c)v=-1,h=u,p=a;else{if(!(c>o))return e[0]=f,o;v=1,h=l,p=c}for(;;){f=v==-1?h-1>=0?h-1:s-1:h+1<s?h+1:0,o=d.EdgeSeparation(t,n,f,r,i);if(!(o>p))break;h=f,p=o}return e[0]=h,p},d.FindIncidentEdge=function(e,t,n,r,i,s){r===undefined&&(r=0),parseInt(t.m_vertexCount);var o=t.m_normals,u=parseInt(i.m_vertexCount);t=i.m_vertices,i=i.m_normals;var a;a=n.R,n=o[r],o=a.col1.x*n.x+a.col2.x*n.y;var f=a.col1.y*n.x+a.col2.y*n.y;a=s.R,n=a.col1.x*o+a.col1.y*f,f=a.col2.x*o+a.col2.y*f,o=n,a=0;for(var l=Number.MAX_VALUE,c=0;c<u;++c)n=i[c],n=o*n.x+f*n.y,n<l&&(l=n,a=c);i=parseInt(a),o=parseInt(i+1<u?i+1:0),u=e[0],n=t[i],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=i,u.id.features.incidentVertex=0,u=e[1],n=t[o],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=o,u.id.features.incidentVertex=1},d.MakeClipPointVector=function(){var e=new r(2);return e[0]=new F,e[1]=new F,e},d.CollidePolygons=function(e,t,n,r,i){var s;e.m_pointCount=0;var u=t.m_radius+r.m_radius;s=0,d.s_edgeAO[0]=s;var a=d.FindMaxSeparation(d.s_edgeAO,t,n,r,i);s=d.s_edgeAO[0];if(!(a>u)){var f=0;d.s_edgeBO[0]=f;var l=d.FindMaxSeparation(d.s_edgeBO,r,i,t,n);f=d.s_edgeBO[0];if(!(l>u)){var c=0,h=0;l>.98*a+.001?(a=r,r=t,t=i,n=n,c=f,e.m_type=N.e_faceB,h=1):(a=t,r=r,t=n,n=i,c=s,e.m_type=N.e_faceA,h=0),s=d.s_incidentEdge,d.FindIncidentEdge(s,a,t,c,r,n),f=parseInt(a.m_vertexCount),i=a.m_vertices,a=i[c];var p;p=c+1<f?i[parseInt(c+1)]:i[0],c=d.s_localTangent,c.Set(p.x-a.x,p.y-a.y),c.Normalize(),i=d.s_localNormal,i.x=c.y,i.y=-c.x,r=d.s_planePoint,r.Set(.5*(a.x+p.x),.5*(a.y+p.y)),l=d.s_tangent,f=t.R,l.x=f.col1.x*c.x+f.col2.x*c.y,l.y=f.col1.y*c.x+f.col2.y*c.y;var v=d.s_tangent2;v.x=-l.x,v.y=-l.y,c=d.s_normal,c.x=l.y,c.y=-l.x;var m=d.s_v11,g=d.s_v12;m.x=t.position.x+(f.col1.x*a.x+f.col2.x*a.y),m.y=t.position.y+(f.col1.y*a.x+f.col2.y*a.y),g.x=t.position.x+(f.col1.x*p.x+f.col2.x*p.y),g.y=t.position.y+(f.col1.y*p.x+f.col2.y*p.y),t=c.x*m.x+c.y*m.y,f=l.x*g.x+l.y*g.y+u,p=d.s_clipPoints1,a=d.s_clipPoints2,g=0,g=d.ClipSegmentToLine(p,s,v,-l.x*m.x-l.y*m.y+u);if(!(g<2)){g=d.ClipSegmentToLine(a,p,l,f);if(!(g<2)){e.m_localPlaneNormal.SetV(i),e.m_localPoint.SetV(r);for(r=i=0;r<o.b2_maxManifoldPoints;++r)s=a[r],c.x*s.v.x+c.y*s.v.y-t<=u&&(l=e.m_points[i],f=n.R,v=s.v.x-n.position.x,m=s.v.y-n.position.y,l.m_localPoint.x=v*f.col1.x+m*f.col1.y,l.m_localPoint.y=v*f.col2.x+m*f.col2.y,l.m_id.Set(s.id),l.m_id.features.flip=h,++i);e.m_pointCount=i}}}}},d.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s,o;s=n.R,o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y);n=n.position.y+(s.col1.y*o.x+s.col2.y*o.y),s=i.R,o=r.m_p,u=i.position.x+(s.col1.x*o.x+s.col2.x*o.y)-u,i=i.position.y+(s.col1.y*o.x+s.col2.y*o.y)-n,s=t.m_radius+r.m_radius,u*u+i*i>s*s||(e.m_type=N.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0)},d.CollidePolygonAndCircle=function(e,t,n,r,i){var s=e.m_pointCount=0,o=0,u,a;a=i.R,u=r.m_p;var f=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);s=i.position.x+(a.col1.x*u.x+a.col2.x*u.y)-n.position.x,o=f-n.position.y,a=n.R,n=s*a.col1.x+o*a.col1.y,a=s*a.col2.x+o*a.col2.y;var l=0;f=-Number.MAX_VALUE,i=t.m_radius+r.m_radius;var c=parseInt(t.m_vertexCount),h=t.m_vertices;t=t.m_normals;for(var p=0;p<c;++p){u=h[p],s=n-u.x,o=a-u.y,u=t[p],s=u.x*s+u.y*o;if(s>i)return;s>f&&(f=s,l=p)}s=parseInt(l),o=parseInt(s+1<c?s+1:0),u=h[s],h=h[o];if(f<Number.MIN_VALUE)e.m_pointCount=1,e.m_type=N.e_faceA,e.m_localPlaneNormal.SetV(t[l]),e.m_localPoint.x=.5*(u.x+h.x),e.m_localPoint.y=.5*(u.y+h.y);else{f=(n-h.x)*(u.x-h.x)+(a-h.y)*(u.y-h.y);if((n-u.x)*(h.x-u.x)+(a-u.y)*(h.y-u.y)<=0){if((n-u.x)*(n-u.x)+(a-u.y)*(a-u.y)>i*i)return;e.m_pointCount=1,e.m_type=N.e_faceA,e.m_localPlaneNormal.x=n-u.x,e.m_localPlaneNormal.y=a-u.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(u)}else if(f<=0){if((n-h.x)*(n-h.x)+(a-h.y)*(a-h.y)>i*i)return;e.m_pointCount=1,e.m_type=N.e_faceA,e.m_localPlaneNormal.x=n-h.x,e.m_localPlaneNormal.y=a-h.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(h)}else{l=.5*(u.x+h.x),u=.5*(u.y+h.y),f=(n-l)*t[s].x+(a-u)*t[s].y;if(f>i)return;e.m_pointCount=1,e.m_type=N.e_faceA,e.m_localPlaneNormal.x=t[s].x,e.m_localPlaneNormal.y=t[s].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(l,u)}}e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0},d.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.y-r.y;return i>0||s>0?!1:n.x-r.x>0||o>0?!1:!0},n.postDefs.push(function(){n.Collision.b2Collision.s_incidentEdge=d.MakeClipPointVector(),n.Collision.b2Collision.s_clipPoints1=d.MakeClipPointVector(),n.Collision.b2Collision.s_clipPoints2=d.MakeClipPointVector(),n.Collision.b2Collision.s_edgeAO=new i(1),n.Collision.b2Collision.s_edgeBO=new i(1),n.Collision.b2Collision.s_localTangent=new l,n.Collision.b2Collision.s_localNormal=new l,n.Collision.b2Collision.s_planePoint=new l,n.Collision.b2Collision.s_normal=new l,n.Collision.b2Collision.s_tangent=new l,n.Collision.b2Collision.s_tangent2=new l,n.Collision.b2Collision.s_v11=new l,n.Collision.b2Collision.s_v12=new l,n.Collision.b2Collision.b2CollidePolyTempVec=new l,n.Collision.b2Collision.b2_nullFeature=255}),v.b2ContactID=function(){this.features=new I},v.prototype.b2ContactID=function(){this.features._m_id=this},v.prototype.Set=function(e){this.key=e._key},v.prototype.Copy=function(){var e=new v;return e.key=this.key,e},Object.defineProperty(v.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(v.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),m.b2ContactPoint=function(){this.position=new l,this.velocity=new l,this.normal=new l,this.id=new v},g.b2Distance=function(){},g.Distance=function(e,t,n){++g.b2_gjkCalls;var r=n.proxyA,i=n.proxyB,s=n.transformA,a=n.transformB,f=g.s_simplex;f.ReadCache(t,r,s,i,a);var c=f.m_vertices,h=g.s_saveA,p=g.s_saveB,d=0;f.GetClosestPoint().LengthSquared();for(var v=0,m,y=0;y<20;){d=f.m_count;for(v=0;v<d;v++)h[v]=c[v].indexA,p[v]=c[v].indexB;switch(f.m_count){case 1:break;case 2:f.Solve2();break;case 3:f.Solve3();break;default:o.b2Assert(!1)}if(f.m_count==3)break;m=f.GetClosestPoint(),m.LengthSquared(),v=f.GetSearchDirection();if(v.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;m=c[f.m_count],m.indexA=r.GetSupport(u.MulTMV(s.R,v.GetNegative())),m.wA=u.MulX(s,r.GetVertex(m.indexA)),m.indexB=i.GetSupport(u.MulTMV(a.R,v)),m.wB=u.MulX(a,i.GetVertex(m.indexB)),m.w=u.SubtractVV(m.wB,m.wA),++y,++g.b2_gjkIters;var b=!1;for(v=0;v<d;v++)if(m.indexA==h[v]&&m.indexB==p[v]){b=!0;break}if(b)break;++f.m_count}g.b2_gjkMaxIters=u.Max(g.b2_gjkMaxIters,y),f.GetWitnessPoints(e.pointA,e.pointB),e.distance=u.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=y,f.WriteCache(t),n.useRadii&&(t=r.m_radius,i=i.m_radius,e.distance>t+i&&e.distance>Number.MIN_VALUE?(e.distance-=t+i,n=u.SubtractVV(e.pointB,e.pointA),n.Normalize(),e.pointA.x+=t*n.x,e.pointA.y+=t*n.y,e.pointB.x-=i*n.x,e.pointB.y-=i*n.y):(m=new l,m.x=.5*(e.pointA.x+e.pointB.x),m.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=m.x,e.pointA.y=e.pointB.y=m.y,e.distance=0))},n.postDefs.push(function(){n.Collision.b2Distance.s_simplex=new _,n.Collision.b2Distance.s_saveA=new i(3),n.Collision.b2Distance.s_saveB=new i(3)}),y.b2DistanceInput=function(){},b.b2DistanceOutput=function(){this.pointA=new l,this.pointB=new l},w.b2DistanceProxy=function(){},w.prototype.Set=function(n){switch(n.GetType()){case s.e_circleShape:n=n instanceof e?n:null,this.m_vertices=new r(1,!0),this.m_vertices[0]=n.m_p,this.m_count=1,this.m_radius=n.m_radius;break;case s.e_polygonShape:n=n instanceof t?n:null,this.m_vertices=n.m_vertices,this.m_count=n.m_vertexCount,this.m_radius=n.m_radius;break;default:o.b2Assert(!1)}},w.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},w.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},w.prototype.GetVertexCount=function(){return this.m_count},w.prototype.GetVertex=function(e){return e===undefined&&(e=0),o.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},E.b2DynamicTree=function(){},E.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},E.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),r=o.b2_aabbExtension,i=o.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-r,n.aabb.lowerBound.y=e.lowerBound.y-i,n.aabb.upperBound.x=e.upperBound.x+r,n.aabb.upperBound.y=e.upperBound.y+i,n.userData=t,this.InsertLeaf(n),n},E.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},E.prototype.MoveProxy=function(e,t,n){o.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var r=o.b2_aabbExtension+o.b2_aabbMultiplier*(n.x>0?n.x:-n.x);return n=o.b2_aabbExtension+o.b2_aabbMultiplier*(n.y>0?n.y:-n.y),e.aabb.lowerBound.x=t.lowerBound.x-r,e.aabb.lowerBound.y=t.lowerBound.y-n,e.aabb.upperBound.x=t.upperBound.x+r,e.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(e),!0},E.prototype.Rebalance=function(e){e===undefined&&(e=0);if(this.m_root!=null)for(var t=0;t<e;t++){for(var n=this.m_root,r=0;n.IsLeaf()==0;)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},E.prototype.GetFatAABB=function(e){return e.aabb},E.prototype.GetUserData=function(e){return e.userData},E.prototype.Query=function(e,t){if(this.m_root!=null){var n=new r,i=0;for(n[i++]=this.m_root;i>0;){var s=n[--i];if(s.aabb.TestOverlap(t))if(s.IsLeaf()){if(!e(s))break}else n[i++]=s.child1,n[i++]=s.child2}}},E.prototype.RayCast=function(e,t){if(this.m_root!=null){var n=t.p1,i=t.p2,s=u.SubtractVV(n,i);s.Normalize(),s=u.CrossFV(1,s);var o=u.AbsV(s),a=t.maxFraction,f=new c,l=0,h=0;l=n.x+a*(i.x-n.x),h=n.y+a*(i.y-n.y),f.lowerBound.x=Math.min(n.x,l),f.lowerBound.y=Math.min(n.y,h),f.upperBound.x=Math.max(n.x,l),f.upperBound.y=Math.max(n.y,h);var p=new r,d=0;for(p[d++]=this.m_root;d>0;){a=p[--d];if(a.aabb.TestOverlap(f)!=0){l=a.aabb.GetCenter(),h=a.aabb.GetExtents();if(!(Math.abs(s.x*(n.x-l.x)+s.y*(n.y-l.y))-o.x*h.x-o.y*h.y>0))if(a.IsLeaf()){l=new L,l.p1=t.p1,l.p2=t.p2,l.maxFraction=t.maxFraction,a=e(l,a);if(a==0)break;a>0&&(l=n.x+a*(i.x-n.x),h=n.y+a*(i.y-n.y),f.lowerBound.x=Math.min(n.x,l),f.lowerBound.y=Math.min(n.y,h),f.upperBound.x=Math.max(n.x,l),f.upperBound.y=Math.max(n.y,h))}else p[d++]=a.child1,p[d++]=a.child2}}}},E.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new x},E.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},E.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null)this.m_root=e,this.m_root.parent=null;else{var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1;n=n.child2,n=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-t.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-t.y)?r:n}while(n.IsLeaf()==0);t=n.parent,r=this.AllocateNode(),r.parent=t,r.userData=null,r.aabb.Combine(e.aabb,n.aabb);if(t){n.parent.child1==n?t.child1=r:t.child2=r,r.child1=n,r.child2=e,n.parent=r,e.parent=r;do{if(t.aabb.Contains(r.aabb))break;t.aabb.Combine(t.child1.aabb,t.child2.aabb),r=t,t=t.parent}while(t)}else r.child1=n,r.child2=e,n.parent=r,this.m_root=e.parent=r}},E.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var t=e.parent,n=t.parent;e=t.child1==e?t.child2:t.child1;if(n){n.child1==t?n.child1=e:n.child2=e,e.parent=n;for(this.FreeNode(t);n;){t=n.aabb,n.aabb=c.Combine(n.child1.aabb,n.child2.aabb);if(t.Contains(n.aabb))break;n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(t)}},S.b2DynamicTreeBroadPhase=function(){this.m_tree=new E,this.m_moveBuffer=new r,this.m_pairBuffer=new r,this.m_pairCount=0},S.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},S.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},S.prototype.MoveProxy=function(e,t,n){this.m_tree.MoveProxy(e,t,n)&&this.BufferMove(e)},S.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},S.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},S.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},S.prototype.GetProxyCount=function(){return this.m_proxyCount},S.prototype.UpdatePairs=function(e){var t=this,n=t.m_pairCount=0,r;for(n=0;n<t.m_moveBuffer.length;++n){r=t.m_moveBuffer[n];var i=t.m_tree.GetFatAABB(r);t.m_tree.Query(function(e){if(e==r)return!0;t.m_pairCount==t.m_pairBuffer.length&&(t.m_pairBuffer[t.m_pairCount]=new T);var n=t.m_pairBuffer[t.m_pairCount];return n.proxyA=e<r?e:r,n.proxyB=e>=r?e:r,++t.m_pairCount,!0},i)}for(n=t.m_moveBuffer.length=0;n<t.m_pairCount;){i=t.m_pairBuffer[n];var s=t.m_tree.GetUserData(i.proxyA),o=t.m_tree.GetUserData(i.proxyB);e(s,o);for(++n;n<t.m_pairCount;){s=t.m_pairBuffer[n];if(s.proxyA!=i.proxyA||s.proxyB!=i.proxyB)break;++n}}},S.prototype.Query=function(e,t){this.m_tree.Query(e,t)},S.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},S.prototype.Validate=function(){},S.prototype.Rebalance=function(e){e===undefined&&(e=0),this.m_tree.Rebalance(e)},S.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},S.prototype.UnBufferMove=function(e){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(e)),1)},S.prototype.ComparePairs=function(){return 0},S.__implements={},S.__implements[q]=!0,x.b2DynamicTreeNode=function(){this.aabb=new c},x.prototype.IsLeaf=function(){return this.child1==null},T.b2DynamicTreePair=function(){},N.b2Manifold=function(){this.m_pointCount=0},N.prototype.b2Manifold=function(){this.m_points=new r(o.b2_maxManifoldPoints);for(var e=0;e<o.b2_maxManifoldPoints;e++)this.m_points[e]=new C;this.m_localPlaneNormal=new l,this.m_localPoint=new l},N.prototype.Reset=function(){for(var e=0;e<o.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof C?this.m_points[e]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},N.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<o.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof C?this.m_points[t]:null).Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},N.prototype.Copy=function(){var e=new N;return e.Set(this),e},n.postDefs.push(function(){n.Collision.b2Manifold.e_circles=1,n.Collision.b2Manifold.e_faceA=2,n.Collision.b2Manifold.e_faceB=4}),C.b2ManifoldPoint=function(){this.m_localPoint=new l,this.m_id=new v},C.prototype.b2ManifoldPoint=function(){this.Reset()},C.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},C.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},k.b2Point=function(){this.p=new l},k.prototype.Support=function(){return this.p},k.prototype.GetFirstVertex=function(){return this.p},L.b2RayCastInput=function(){this.p1=new l,this.p2=new l},L.prototype.b2RayCastInput=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=1),e&&this.p1.SetV(e),t&&this.p2.SetV(t),this.maxFraction=n},A.b2RayCastOutput=function(){this.normal=new l},O.b2Segment=function(){this.p1=new l,this.p2=new l},O.prototype.TestSegment=function(e,t,n,r){r===undefined&&(r=0);var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y;n=this.p2.y-this.p1.y;var u=-(this.p2.x-this.p1.x),a=100*Number.MIN_VALUE,f=-(s*n+o*u);if(f>a){var l=i.x-this.p1.x,c=i.y-this.p1.y;i=l*n+c*u;if(0<=i&&i<=r*f){r=-s*c+o*l;if(-a*f<=r&&r<=f*(1+a))return i/=f,r=Math.sqrt(n*n+u*u),n/=r,u/=r,e[0]=i,t.Set(n,u),!0}}return!1},O.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},O.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+t*e,this.p2.y=this.p1.y+n*e},O.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+t*e,this.p1.y=this.p2.y+n*e},M.b2SeparationFunction=function(){this.m_localPoint=new l,this.m_axis=new l},M.prototype.Initialize=function(e,t,n,r,i){this.m_proxyA=t,this.m_proxyB=r;var s=parseInt(e.count);o.b2Assert(0<s&&s<3);var a,f,c,h,p=h=c=r=t=0,d=0;p=0,s==1?(this.m_type=M.e_points,a=this.m_proxyA.GetVertex(e.indexA[0]),f=this.m_proxyB.GetVertex(e.indexB[0]),s=a,e=n.R,t=n.position.x+(e.col1.x*s.x+e.col2.x*s.y),r=n.position.y+(e.col1.y*s.x+e.col2.y*s.y),s=f,e=i.R,c=i.position.x+(e.col1.x*s.x+e.col2.x*s.y),h=i.position.y+(e.col1.y*s.x+e.col2.y*s.y),this.m_axis.x=c-t,this.m_axis.y=h-r,this.m_axis.Normalize()):(e.indexB[0]==e.indexB[1]?(this.m_type=M.e_faceA,t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),f=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(t.x+r.x),this.m_localPoint.y=.5*(t.y+r.y),this.m_axis=u.CrossVF(u.SubtractVV(r,t),1),this.m_axis.Normalize(),s=this.m_axis,e=n.R,p=e.col1.x*s.x+e.col2.x*s.y,d=e.col1.y*s.x+e.col2.y*s.y,s=this.m_localPoint,e=n.R,t=n.position.x+(e.col1.x*s.x+e.col2.x*s.y),r=n.position.y+(e.col1.y*s.x+e.col2.y*s.y),s=f,e=i.R,c=i.position.x+(e.col1.x*s.x+e.col2.x*s.y),h=i.position.y+(e.col1.y*s.x+e.col2.y*s.y),p=(c-t)*p+(h-r)*d):e.indexA[0]==e.indexA[0]?(this.m_type=M.e_faceB,c=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]),a=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(c.x+h.x),this.m_localPoint.y=.5*(c.y+h.y),this.m_axis=u.CrossVF(u.SubtractVV(h,c),1),this.m_axis.Normalize(),s=this.m_axis,e=i.R,p=e.col1.x*s.x+e.col2.x*s.y,d=e.col1.y*s.x+e.col2.y*s.y,s=this.m_localPoint,e=i.R,c=i.position.x+(e.col1.x*s.x+e.col2.x*s.y),h=i.position.y+(e.col1.y*s.x+e.col2.y*s.y),s=a,e=n.R,t=n.position.x+(e.col1.x*s.x+e.col2.x*s.y),r=n.position.y+(e.col1.y*s.x+e.col2.y*s.y),p=(t-c)*p+(r-h)*d):(t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),c=this.m_proxyB.GetVertex(e.indexB[0]),h=this.m_proxyB.GetVertex(e.indexB[1]),u.MulX(n,a),a=u.MulMV(n.R,u.SubtractVV(r,t)),u.MulX(i,f),p=u.MulMV(i.R,u.SubtractVV(h,c)),i=a.x*a.x+a.y*a.y,f=p.x*p.x+p.y*p.y,e=u.SubtractVV(p,a),n=a.x*e.x+a.y*e.y,e=p.x*e.x+p.y*e.y,a=a.x*p.x+a.y*p.y,d=i*f-a*a,p=0,d!=0&&(p=u.Clamp((a*e-n*f)/d,0,1)),(a*p+e)/f<0&&(p=u.Clamp((a-n)/i,0,1)),a=new l,a.x=t.x+p*(r.x-t.x),a.y=t.y+p*(r.y-t.y),f=new l,f.x=c.x+p*(h.x-c.x),f.y=c.y+p*(h.y-c.y),p==0||p==1?(this.m_type=M.e_faceB,this.m_axis=u.CrossVF(u.SubtractVV(h,c),1),this.m_axis.Normalize(),this.m_localPoint=f):(this.m_type=M.e_faceA,this.m_axis=u.CrossVF(u.SubtractVV(r,t),1),this.m_localPoint=a)),p<0&&this.m_axis.NegativeSelf())},M.prototype.Evaluate=function(e,t){var n,r,i=0;switch(this.m_type){case M.e_points:return n=u.MulTMV(e.R,this.m_axis),r=u.MulTMV(t.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),r=this.m_proxyB.GetSupportVertex(r),n=u.MulX(e,n),r=u.MulX(t,r),i=(r.x-n.x)*this.m_axis.x+(r.y-n.y)*this.m_axis.y;case M.e_faceA:return i=u.MulMV(e.R,this.m_axis),n=u.MulX(e,this.m_localPoint),r=u.MulTMV(t.R,i.GetNegative()),r=this.m_proxyB.GetSupportVertex(r),r=u.MulX(t,r),i=(r.x-n.x)*i.x+(r.y-n.y)*i.y;case M.e_faceB:return i=u.MulMV(t.R,this.m_axis),r=u.MulX(t,this.m_localPoint),n=u.MulTMV(e.R,i.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),n=u.MulX(e,n),i=(n.x-r.x)*i.x+(n.y-r.y)*i.y;default:return o.b2Assert(!1),0}},n.postDefs.push(function(){n.Collision.b2SeparationFunction.e_points=1,n.Collision.b2SeparationFunction.e_faceA=2,n.Collision.b2SeparationFunction.e_faceB=4}),_.b2Simplex=function(){this.m_v1=new P,this.m_v2=new P,this.m_v3=new P,this.m_vertices=new r(3)},_.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},_.prototype.ReadCache=function(e,t,n,r,i){o.b2Assert(0<=e.count&&e.count<=3);var s,a;this.m_count=e.count;for(var f=this.m_vertices,l=0;l<this.m_count;l++){var c=f[l];c.indexA=e.indexA[l],c.indexB=e.indexB[l],s=t.GetVertex(c.indexA),a=r.GetVertex(c.indexB),c.wA=u.MulX(n,s),c.wB=u.MulX(i,a),c.w=u.SubtractVV(c.wB,c.wA),c.a=0}if(this.m_count>1){e=e.metric,s=this.GetMetric();if(s<.5*e||2*e<s||s<Number.MIN_VALUE)this.m_count=0}this.m_count==0&&(c=f[0],c.indexA=0,c.indexB=0,s=t.GetVertex(0),a=r.GetVertex(0),c.wA=u.MulX(n,s),c.wB=u.MulX(i,a),c.w=u.SubtractVV(c.wB,c.wA),this.m_count=1)},_.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=n.parseUInt(this.m_count);for(var t=this.m_vertices,r=0;r<this.m_count;r++)e.indexA[r]=n.parseUInt(t[r].indexA),e.indexB[r]=n.parseUInt(t[r].indexB)},_.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=u.SubtractVV(this.m_v2.w,this.m_v1.w);return u.CrossVV(e,this.m_v1.w.GetNegative())>0?u.CrossFV(1,e):u.CrossVF(e,1);default:return o.b2Assert(!1),new l}},_.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return o.b2Assert(!1),new l;case 1:return this.m_v1.w;case 2:return new l(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return o.b2Assert(!1),new l}},_.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:o.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:o.b2Assert(!1)}},_.prototype.GetMetric=function(){switch(this.m_count){case 0:return o.b2Assert(!1),0;case 1:return 0;case 2:return u.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return u.CrossVV(u.SubtractVV(this.m_v2.w,this.m_v1.w),u.SubtractVV(this.m_v3.w,this.m_v1.w));default:return o.b2Assert(!1),0}},_.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=u.SubtractVV(t,e);e=-(e.x*n.x+e.y*n.y),e<=0?this.m_count=this.m_v1.a=1:(t=t.x*n.x+t.y*n.y,t<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(n=1/(t+e),this.m_v1.a=t*n,this.m_v2.a=e*n,this.m_count=2))},_.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=u.SubtractVV(t,e),i=u.Dot(e,r),s=u.Dot(t,r);i=-i;var o=u.SubtractVV(n,e),a=u.Dot(e,o),f=u.Dot(n,o);a=-a;var l=u.SubtractVV(n,t),c=u.Dot(t,l);l=u.Dot(n,l),c=-c,o=u.CrossVV(r,o),r=o*u.CrossVV(t,n),n=o*u.CrossVV(n,e),e=o*u.CrossVV(e,t),i<=0&&a<=0?this.m_count=this.m_v1.a=1:s>0&&i>0&&e<=0?(f=1/(s+i),this.m_v1.a=s*f,this.m_v2.a=i*f,this.m_count=2):f>0&&a>0&&n<=0?(s=1/(f+a),this.m_v1.a=f*s,this.m_v3.a=a*s,this.m_count=2,this.m_v2.Set(this.m_v3)):s<=0&&c<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):f<=0&&l<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):l>0&&c>0&&r<=0?(s=1/(l+c),this.m_v2.a=l*s,this.m_v3.a=c*s,this.m_count=2,this.m_v1.Set(this.m_v3)):(s=1/(r+n+e),this.m_v1.a=r*s,this.m_v2.a=n*s,this.m_v3.a=e*s,this.m_count=3)},D.b2SimplexCache=function(){this.indexA=new i(3),this.indexB=new i(3)},P.b2SimplexVertex=function(){},P.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},H.b2TimeOfImpact=function(){},H.TimeOfImpact=function(e){++H.b2_toiCalls;var t=e.proxyA,n=e.proxyB,r=e.sweepA,i=e.sweepB;o.b2Assert(r.t0==i.t0),o.b2Assert(1-r.t0>Number.MIN_VALUE);var s=t.m_radius+n.m_radius;e=e.tolerance;var a=0,f=0,l=0;H.s_cache.count=0;for(H.s_distanceInput.useRadii=!1;;){r.GetTransform(H.s_xfA,a),i.GetTransform(H.s_xfB,a),H.s_distanceInput.proxyA=t,H.s_distanceInput.proxyB=n,H.s_distanceInput.transformA=H.s_xfA,H.s_distanceInput.transformB=H.s_xfB,g.Distance(H.s_distanceOutput,H.s_cache,H.s_distanceInput);if(H.s_distanceOutput.distance<=0){a=1;break}H.s_fcn.Initialize(H.s_cache,t,H.s_xfA,n,H.s_xfB);var c=H.s_fcn.Evaluate(H.s_xfA,H.s_xfB);if(c<=0){a=1;break}f==0&&(l=c>s?u.Max(s-e,.75*s):u.Max(c-e,.02*s));if(c-l<.5*e){if(f==0){a=1;break}break}var h=a,p=a,d=1;c=c,r.GetTransform(H.s_xfA,d),i.GetTransform(H.s_xfB,d);var v=H.s_fcn.Evaluate(H.s_xfA,H.s_xfB);if(v>=l){a=1;break}for(var m=0;;){var y=0;y=m&1?p+(l-c)*(d-p)/(v-c):.5*(p+d),r.GetTransform(H.s_xfA,y),i.GetTransform(H.s_xfB,y);var b=H.s_fcn.Evaluate(H.s_xfA,H.s_xfB);if(u.Abs(b-l)<.025*e){h=y;break}b>l?(p=y,c=b):(d=y,v=b),++m,++H.b2_toiRootIters;if(m==50)break}H.b2_toiMaxRootIters=u.Max(H.b2_toiMaxRootIters,m);if(h<(1+100*Number.MIN_VALUE)*a)break;a=h,f++,++H.b2_toiIters;if(f==1e3)break}return H.b2_toiMaxIters=u.Max(H.b2_toiMaxIters,f),a},n.postDefs.push(function(){n.Collision.b2TimeOfImpact.b2_toiCalls=0,n.Collision.b2TimeOfImpact.b2_toiIters=0,n.Collision.b2TimeOfImpact.b2_toiMaxIters=0,n.Collision.b2TimeOfImpact.b2_toiRootIters=0,n.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,n.Collision.b2TimeOfImpact.s_cache=new D,n.Collision.b2TimeOfImpact.s_distanceInput=new y,n.Collision.b2TimeOfImpact.s_xfA=new f,n.Collision.b2TimeOfImpact.s_xfB=new f,n.Collision.b2TimeOfImpact.s_fcn=new M,n.Collision.b2TimeOfImpact.s_distanceOutput=new b}),B.b2TOIInput=function(){this.proxyA=new w,this.proxyB=new w,this.sweepA=new a,this.sweepB=new a},j.b2WorldManifold=function(){this.m_normal=new l},j.prototype.b2WorldManifold=function(){this.m_points=new r(o.b2_maxManifoldPoints);for(var e=0;e<o.b2_maxManifoldPoints;e++)this.m_points[e]=new l},j.prototype.Initialize=function(e,t,n,r,i){n===undefined&&(n=0),i===undefined&&(i=0);if(e.m_pointCount!=0){var s=0,o,u,a=0,f=0,l=0,c=0,h=0;o=0;switch(e.m_type){case N.e_circles:u=t.R,o=e.m_localPoint,s=t.position.x+u.col1.x*o.x+u.col2.x*o.y,t=t.position.y+u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_points[0].m_localPoint,e=r.position.x+u.col1.x*o.x+u.col2.x*o.y,r=r.position.y+u.col1.y*o.x+u.col2.y*o.y,o=e-s,u=r-t,a=o*o+u*u,a>Number.MIN_VALUE*Number.MIN_VALUE?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=u/a):(this.m_normal.x=1,this.m_normal.y=0),o=t+n*this.m_normal.y,r-=i*this.m_normal.y,this.m_points[0].x=.5*(s+n*this.m_normal.x+(e-i*this.m_normal.x)),this.m_points[0].y=.5*(o+r);break;case N.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,o=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(o-c)*f-i)*a,this.m_points[s].y=o+.5*(n-(h-l)*a-(o-c)*f-i)*f;break;case N.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,o=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(o-c)*f-n)*a,this.m_points[s].y=o+.5*(i-(h-l)*a-(o-c)*f-n)*f}}},F.ClipVertex=function(){this.v=new l,this.id=new v},F.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},I.Features=function(){},Object.defineProperty(I.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(I.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(I.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(I.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(I.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(I.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(I.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(I.prototype,"flip",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var e=n.Common.b2Settings,t=n.Collision.Shapes.b2CircleShape,s=n.Collision.Shapes.b2EdgeChainDef,o=n.Collision.Shapes.b2EdgeShape,u=n.Collision.Shapes.b2MassData,a=n.Collision.Shapes.b2PolygonShape,f=n.Collision.Shapes.b2Shape,l=n.Common.Math.b2Mat22,c=n.Common.Math.b2Math,h=n.Common.Math.b2Transform,p=n.Common.Math.b2Vec2,d=n.Collision.b2Distance,v=n.Collision.b2DistanceInput,m=n.Collision.b2DistanceOutput,g=n.Collision.b2DistanceProxy,y=n.Collision.b2SimplexCache;n.inherit(t,n.Collision.Shapes.b2Shape),t.prototype.__super=n.Collision.Shapes.b2Shape.prototype,t.b2CircleShape=function(){n.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new p},t.prototype.Copy=function(){var e=new t;return e.Set(this),e},t.prototype.Set=function(e){this.__super.Set.call(this,e),n.is(e,t)&&this.m_p.SetV((e instanceof t?e:null).m_p)},t.prototype.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);return n=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),r=t.x-r,n=t.y-n,r*r+n*n<=this.m_radius*this.m_radius},t.prototype.RayCast=function(e,t,n){var r=n.R,i=t.p1.x-(n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y));n=t.p1.y-(n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y)),r=t.p2.x-t.p1.x;var s=t.p2.y-t.p1.y,o=i*r+n*s,u=r*r+s*s,a=o*o-u*(i*i+n*n-this.m_radius*this.m_radius);return a<0||u<Number.MIN_VALUE?!1:(o=-(o+Math.sqrt(a)),0<=o&&o<=t.maxFraction*u?(o/=u,e.fraction=o,e.normal.x=i+o*r,e.normal.y=n+o*s,e.normal.Normalize(),!0):!1)},t.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);n=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),e.lowerBound.Set(r-this.m_radius,n-this.m_radius),e.upperBound.Set(r+this.m_radius,n+this.m_radius)},t.prototype.ComputeMass=function(t,n){n===undefined&&(n=0),t.mass=n*e.b2_pi*this.m_radius*this.m_radius,t.center.SetV(this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},t.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0),n=c.MulX(n,this.m_p);var i=-(c.Dot(e,n)-t);if(i<-this.m_radius+Number.MIN_VALUE)return 0;if(i>this.m_radius)return r.SetV(n),Math.PI*this.m_radius*this.m_radius;t=this.m_radius*this.m_radius;var s=i*i;return i=t*(Math.asin(i/this.m_radius)+Math.PI/2)+i*Math.sqrt(t-s),t=-2/3*Math.pow(t-s,1.5)/i,r.x=n.x+e.x*t,r.y=n.y+e.y*t,i},t.prototype.GetLocalPosition=function(){return this.m_p},t.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},t.prototype.GetRadius=function(){return this.m_radius},t.prototype.SetRadius=function(e){e===undefined&&(e=0),this.m_radius=e},t.prototype.b2CircleShape=function(e){e===undefined&&(e=0),this.__super.b2Shape.call(this),this.m_type=f.e_circleShape,this.m_radius=e},s.b2EdgeChainDef=function(){},s.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},n.inherit(o,n.Collision.Shapes.b2Shape),o.prototype.__super=n.Collision.Shapes.b2Shape.prototype,o.b2EdgeShape=function(){n.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new p,this.m_v1=new p,this.m_v2=new p,this.m_coreV1=new p,this.m_coreV2=new p,this.m_normal=new p,this.m_direction=new p,this.m_cornerDir1=new p,this.m_cornerDir2=new p},o.prototype.TestPoint=function(){return!1},o.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u;n=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o),r=100*Number.MIN_VALUE;var f=-(i*a+s*n);if(f>r){o=t.p1.x-o;var l=t.p1.y-u;u=o*a+l*n;if(0<=u&&u<=t.maxFraction*f){t=-i*l+s*o;if(-r*f<=t&&t<=f*(1+r))return u/=f,e.fraction=u,t=Math.sqrt(a*a+n*n),e.normal.x=a/t,e.normal.y=n/t,!0}}return!1},o.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y);n=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y),r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<n?(e.lowerBound.y=i,e.upperBound.y=n):(e.lowerBound.y=n,e.upperBound.y=i)},o.prototype.ComputeMass=function(e){e.mass=0,e.center.SetV(this.m_v1),e.I=0},o.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=new p(e.x*t,e.y*t),s=c.MulX(n,this.m_v1);n=c.MulX(n,this.m_v2);var o=c.Dot(e,s)-t;e=c.Dot(e,n)-t;if(o>0){if(e>0)return 0;s.x=-e/(o-e)*s.x+o/(o-e)*n.x,s.y=-e/(o-e)*s.y+o/(o-e)*n.y}else e>0&&(n.x=-e/(o-e)*s.x+o/(o-e)*n.x,n.y=-e/(o-e)*s.y+o/(o-e)*n.y);return r.x=(i.x+s.x+n.x)/3,r.y=(i.y+s.y+n.y)/3,.5*((s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x))},o.prototype.GetLength=function(){return this.m_length},o.prototype.GetVertex1=function(){return this.m_v1},o.prototype.GetVertex2=function(){return this.m_v2},o.prototype.GetCoreVertex1=function(){return this.m_coreV1},o.prototype.GetCoreVertex2=function(){return this.m_coreV2},o.prototype.GetNormalVector=function(){return this.m_normal},o.prototype.GetDirectionVector=function(){return this.m_direction},o.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},o.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},o.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},o.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},o.prototype.GetFirstVertex=function(e){var t=e.R;return new p(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},o.prototype.GetNextEdge=function(){return this.m_nextEdge},o.prototype.GetPrevEdge=function(){return this.m_prevEdge},o.prototype.Support=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y);return e=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y),i*t+s*n>o*t+e*n?(this.s_supportVec.x=i,this.s_supportVec.y=s):(this.s_supportVec.x=o,this.s_supportVec.y=e),this.s_supportVec},o.prototype.b2EdgeShape=function(t,n){this.__super.b2Shape.call(this),this.m_type=f.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=t,this.m_v2=n,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-e.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-e.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-e.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-e.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},o.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},o.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},u.b2MassData=function(){this.mass=0,this.center=new p(0,0),this.I=0},n.inherit(a,n.Collision.Shapes.b2Shape),a.prototype.__super=n.Collision.Shapes.b2Shape.prototype,a.b2PolygonShape=function(){n.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},a.prototype.Copy=function(){var e=new a;return e.Set(this),e},a.prototype.Set=function(e){this.__super.Set.call(this,e);if(n.is(e,a)){e=e instanceof a?e:null,this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e.m_vertices[t]),this.m_normals[t].SetV(e.m_normals[t])}},a.prototype.SetAsArray=function(e,t){t===undefined&&(t=0);var n=new r,i=0,s;for(i=0;i<e.length;++i)s=e[i],n.push(s);this.SetAsVector(n,t)},a.AsArray=function(e,t){t===undefined&&(t=0);var n=new a;return n.SetAsArray(e,t),n},a.prototype.SetAsVector=function(t,n){n===undefined&&(n=0),n==0&&(n=t.length),e.b2Assert(2<=n),this.m_vertexCount=n,this.Reserve(n);var r=0;for(r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(t[r]);for(r=0;r<this.m_vertexCount;++r){var i=parseInt(r),s=parseInt(r+1<this.m_vertexCount?r+1:0);i=c.SubtractVV(this.m_vertices[s],this.m_vertices[i]),e.b2Assert(i.LengthSquared()>Number.MIN_VALUE),this.m_normals[r].SetV(c.CrossVF(i,1)),this.m_normals[r].Normalize()}this.m_centroid=a.ComputeCentroid(this.m_vertices,this.m_vertexCount)},a.AsVector=function(e,t){t===undefined&&(t=0);var n=new a;return n.SetAsVector(e,t),n},a.prototype.SetAsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},a.AsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=new a;return n.SetAsBox(e,t),n},a.prototype.SetAsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n,e=new h,e.position=n,e.R.Set(r);for(n=0;n<this.m_vertexCount;++n)this.m_vertices[n]=c.MulX(e,this.m_vertices[n]),this.m_normals[n]=c.MulMV(e.R,this.m_normals[n])},a.AsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0);var i=new a;return i.SetAsOrientedBox(e,t,n,r),i},a.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=c.CrossVF(c.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},a.AsEdge=function(e,t){var n=new a;return n.SetAsEdge(e,t),n},a.prototype.TestPoint=function(e,t){var n;n=e.R;for(var r=t.x-e.position.x,i=t.y-e.position.y,s=r*n.col1.x+i*n.col1.y,o=r*n.col2.x+i*n.col2.y,u=0;u<this.m_vertexCount;++u){n=this.m_vertices[u],r=s-n.x,i=o-n.y,n=this.m_normals[u];if(n.x*r+n.y*i>0)return!1}return!0},a.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s=0,o=0,u,a;s=t.p1.x-n.position.x,o=t.p1.y-n.position.y,u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x,o=t.p2.y-n.position.y,u=n.R,t=s*u.col1.x+o*u.col1.y-f,u=s*u.col2.x+o*u.col2.y-l;for(var c=parseInt(-1),h=0;h<this.m_vertexCount;++h){a=this.m_vertices[h],s=a.x-f,o=a.y-l,a=this.m_normals[h],s=a.x*s+a.y*o,o=a.x*t+a.y*u;if(o==0){if(s<0)return!1}else o<0&&s<r*o?(r=s/o,c=h):o>0&&s<i*o&&(i=s/o);if(i<r-Number.MIN_VALUE)return!1}return c>=0?(e.fraction=r,u=n.R,a=this.m_normals[c],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},a.prototype.ComputeAABB=function(e,t){for(var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s,a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y);r=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),i=i<f?i:f,s=s<r?s:r,o=o>f?o:f,u=u>r?u:r}e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},a.prototype.ComputeMass=function(e,t){t===undefined&&(t=0);if(this.m_vertexCount==2)e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;else{for(var n=0,r=0,i=0,s=0,o=1/3,u=0;u<this.m_vertexCount;++u){var a=this.m_vertices[u],f=u+1<this.m_vertexCount?this.m_vertices[parseInt(u+1)]:this.m_vertices[0],l=a.x-0,c=a.y-0,h=f.x-0,p=f.y-0,d=l*p-c*h,v=.5*d;i+=v,n+=v*o*(0+a.x+f.x),r+=v*o*(0+a.y+f.y),a=l,c=c,h=h,p=p,s+=d*(o*(.25*(a*a+h*a+h*h)+(0*a+0*h))+0+(o*(.25*(c*c+p*c+p*p)+(0*c+0*p))+0))}e.mass=t*i,n*=1/i,r*=1/i,e.center.Set(n,r),e.I=t*s}},a.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var s=c.MulTMV(n.R,e),o=t-c.Dot(e,n.position),a=new i,f=0,l=parseInt(-1);t=parseInt(-1);var h=!1;for(e=e=0;e<this.m_vertexCount;++e){a[e]=c.Dot(s,this.m_vertices[e])-o;var d=a[e]<-Number.MIN_VALUE;e>0&&(d?h||(l=e-1,f++):h&&(t=e-1,f++)),h=d}switch(f){case 0:return h?(e=new u,this.ComputeMass(e,1),r.SetV(c.MulX(n,e.center)),e.mass):0;case 1:l==-1?l=this.m_vertexCount-1:t=this.m_vertexCount-1}e=parseInt((l+1)%this.m_vertexCount),s=parseInt((t+1)%this.m_vertexCount),o=(0-a[l])/(a[e]-a[l]),a=(0-a[t])/(a[s]-a[t]),l=new p(this.m_vertices[l].x*(1-o)+this.m_vertices[e].x*o,this.m_vertices[l].y*(1-o)+this.m_vertices[e].y*o),t=new p(this.m_vertices[t].x*(1-a)+this.m_vertices[s].x*a,this.m_vertices[t].y*(1-a)+this.m_vertices[s].y*a),a=0,o=new p,f=this.m_vertices[e];for(e=e;e!=s;)e=(e+1)%this.m_vertexCount,h=e==s?t:this.m_vertices[e],d=.5*((f.x-l.x)*(h.y-l.y)-(f.y-l.y)*(h.x-l.x)),a+=d,o.x+=d*(l.x+f.x+h.x)/3,o.y+=d*(l.y+f.y+h.y)/3,f=h;return o.Multiply(1/a),r.SetV(c.MulX(n,o)),a},a.prototype.GetVertexCount=function(){return this.m_vertexCount},a.prototype.GetVertices=function(){return this.m_vertices},a.prototype.GetNormals=function(){return this.m_normals},a.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},a.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},a.prototype.Validate=function(){return!1},a.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=f.e_polygonShape,this.m_centroid=new p,this.m_vertices=new r,this.m_normals=new r},a.prototype.Reserve=function(e){e===undefined&&(e=0);for(var t=parseInt(this.m_vertices.length);t<e;t++)this.m_vertices[t]=new p,this.m_normals[t]=new p},a.ComputeCentroid=function(e,t){t===undefined&&(t=0);for(var n=new p,r=0,i=1/3,s=0;s<t;++s){var o=e[s],u=s+1<t?e[parseInt(s+1)]:e[0],a=.5*((o.x-0)*(u.y-0)-(o.y-0)*(u.x-0));r+=a,n.x+=a*i*(0+o.x+u.x),n.y+=a*i*(0+o.y+u.y)}return n.x*=1/r,n.y*=1/r,n},a.ComputeOBB=function(e,t,n){n===undefined&&(n=0);var i=0,s=new r(n+1);for(i=0;i<n;++i)s[i]=t[i];s[n]=s[0],t=Number.MAX_VALUE;for(i=1;i<=n;++i){var o=s[parseInt(i-1)],u=s[i].x-o.x,a=s[i].y-o.y,f=Math.sqrt(u*u+a*a);u/=f,a/=f;for(var l=-a,c=u,h=f=Number.MAX_VALUE,p=-Number.MAX_VALUE,d=-Number.MAX_VALUE,v=0;v<n;++v){var m=s[v].x-o.x,g=s[v].y-o.y,y=u*m+a*g;m=l*m+c*g,y<f&&(f=y),m<h&&(h=m),y>p&&(p=y),m>d&&(d=m)}v=(p-f)*(d-h),v<.95*t&&(t=v,e.R.col1.x=u,e.R.col1.y=a,e.R.col2.x=l,e.R.col2.y=c,u=.5*(f+p),a=.5*(h+d),l=e.R,e.center.x=o.x+(l.col1.x*u+l.col2.x*a),e.center.y=o.y+(l.col1.y*u+l.col2.y*a),e.extents.x=.5*(p-f),e.extents.y=.5*(d-h))}},n.postDefs.push(function(){n.Collision.Shapes.b2PolygonShape.s_mat=new l}),f.b2Shape=function(){},f.prototype.Copy=function(){return null},f.prototype.Set=function(e){this.m_radius=e.m_radius},f.prototype.GetType=function(){return this.m_type},f.prototype.TestPoint=function(){return!1},f.prototype.RayCast=function(){return!1},f.prototype.ComputeAABB=function(){},f.prototype.ComputeMass=function(){},f.prototype.ComputeSubmergedArea=function(){return 0},f.TestOverlap=function(e,t,n,r){var i=new v;return i.proxyA=new g,i.proxyA.Set(e),i.proxyB=new g,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0,e=new y,e.count=0,t=new m,d.Distance(t,e,i),t.distance<10*Number.MIN_VALUE},f.prototype.b2Shape=function(){this.m_type=f.e_unknownShape,this.m_radius=e.b2_linearSlop},n.postDefs.push(function(){n.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),n.Collision.Shapes.b2Shape.e_circleShape=0,n.Collision.Shapes.b2Shape.e_polygonShape=1,n.Collision.Shapes.b2Shape.e_edgeShape=2,n.Collision.Shapes.b2Shape.e_shapeTypeCount=3,n.Collision.Shapes.b2Shape.e_hitCollide=1,n.Collision.Shapes.b2Shape.e_missCollide=0,n.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var e=n.Common.b2Color,t=n.Common.b2Settings,r=n.Common.Math.b2Math;e.b2Color=function(){this._b=this._g=this._r=0},e.prototype.b2Color=function(e,t,i){e===undefined&&(e=0),t===undefined&&(t=0),i===undefined&&(i=0),this._r=n.parseUInt(255*r.Clamp(e,0,1)),this._g=n.parseUInt(255*r.Clamp(t,0,1)),this._b=n.parseUInt(255*r.Clamp(i,0,1))},e.prototype.Set=function(e,t,i){e===undefined&&(e=0),t===undefined&&(t=0),i===undefined&&(i=0),this._r=n.parseUInt(255*r.Clamp(e,0,1)),this._g=n.parseUInt(255*r.Clamp(t,0,1)),this._b=n.parseUInt(255*r.Clamp(i,0,1))},Object.defineProperty(e.prototype,"r",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._r=n.parseUInt(255*r.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"g",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._g=n.parseUInt(255*r.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"b",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._b=n.parseUInt(255*r.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),t.b2Settings=function(){},t.b2MixFriction=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),Math.sqrt(e*t)},t.b2MixRestitution=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},t.b2Assert=function(e){if(!e)throw"Assertion Failed"},n.postDefs.push(function(){n.Common.b2Settings.VERSION="2.1alpha",n.Common.b2Settings.USHRT_MAX=65535,n.Common.b2Settings.b2_pi=Math.PI,n.Common.b2Settings.b2_maxManifoldPoints=2,n.Common.b2Settings.b2_aabbExtension=.1,n.Common.b2Settings.b2_aabbMultiplier=2,n.Common.b2Settings.b2_polygonRadius=2*t.b2_linearSlop,n.Common.b2Settings.b2_linearSlop=.005,n.Common.b2Settings.b2_angularSlop=2/180*t.b2_pi,n.Common.b2Settings.b2_toiSlop=8*t.b2_linearSlop,n.Common.b2Settings.b2_maxTOIContactsPerIsland=32,n.Common.b2Settings.b2_maxTOIJointsPerIsland=32,n.Common.b2Settings.b2_velocityThreshold=1,n.Common.b2Settings.b2_maxLinearCorrection=.2,n.Common.b2Settings.b2_maxAngularCorrection=8/180*t.b2_pi,n.Common.b2Settings.b2_maxTranslation=2,n.Common.b2Settings.b2_maxTranslationSquared=t.b2_maxTranslation*t.b2_maxTranslation,n.Common.b2Settings.b2_maxRotation=.5*t.b2_pi,n.Common.b2Settings.b2_maxRotationSquared=t.b2_maxRotation*t.b2_maxRotation,n.Common.b2Settings.b2_contactBaumgarte=.2,n.Common.b2Settings.b2_timeToSleep=.5,n.Common.b2Settings.b2_linearSleepTolerance=.01,n.Common.b2Settings.b2_angularSleepTolerance=2/180*t.b2_pi})}(),function(){var e=n.Common.Math.b2Mat22,t=n.Common.Math.b2Mat33,r=n.Common.Math.b2Math,i=n.Common.Math.b2Sweep,s=n.Common.Math.b2Transform,o=n.Common.Math.b2Vec2,u=n.Common.Math.b2Vec3;e.b2Mat22=function(){this.col1=new o,this.col2=new o},e.prototype.b2Mat22=function(){this.SetIdentity()},e.FromAngle=function(t){t===undefined&&(t=0);var n=new e;return n.Set(t),n},e.FromVV=function(t,n){var r=new e;return r.SetVV(t,n),r},e.prototype.Set=function(e){e===undefined&&(e=0);var t=Math.cos(e);e=Math.sin(e),this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t},e.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},e.prototype.Copy=function(){var t=new e;return t.SetM(this),t},e.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},e.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},e.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},e.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},e.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},e.prototype.GetInverse=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s!=0&&(s=1/s),e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},e.prototype.Solve=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},e.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},t.b2Mat33=function(){this.col1=new u,this.col2=new u,this.col3=new u},t.prototype.b2Mat33=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=null),!e&&!t&&!n?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n))},t.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},t.prototype.Copy=function(){return new t(this.col1,this.col2,this.col3)},t.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},t.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},t.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},t.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},t.prototype.Solve22=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},t.prototype.Solve33=function(e,t,n,r){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0);var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return p!=0&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},r.b2Math=function(){},r.IsValid=function(e){return e===undefined&&(e=0),isFinite(e)},r.Dot=function(e,t){return e.x*t.x+e.y*t.y},r.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},r.CrossVF=function(e,t){return t===undefined&&(t=0),new o(t*e.y,-t*e.x)},r.CrossFV=function(e,t){return e===undefined&&(e=0),new o(-e*t.y,e*t.x)},r.MulMV=function(e,t){return new o(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)},r.MulTMV=function(e,t){return new o(r.Dot(t,e.col1),r.Dot(t,e.col2))},r.MulX=function(e,t){var n=r.MulMV(e.R,t);return n.x+=e.position.x,n.y+=e.position.y,n},r.MulXT=function(e,t){var n=r.SubtractVV(t,e.position),i=n.x*e.R.col1.x+n.y*e.R.col1.y;return n.y=n.x*e.R.col2.x+n.y*e.R.col2.y,n.x=i,n},r.AddVV=function(e,t){return new o(e.x+t.x,e.y+t.y)},r.SubtractVV=function(e,t){return new o(e.x-t.x,e.y-t.y)},r.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},r.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},r.MulFV=function(e,t){return e===undefined&&(e=0),new o(e*t.x,e*t.y)},r.AddMM=function(t,n){return e.FromVV(r.AddVV(t.col1,n.col1),r.AddVV(t.col2,n.col2))},r.MulMM=function(t,n){return e.FromVV(r.MulMV(t,n.col1),r.MulMV(t,n.col2))},r.MulTMM=function(t,n){var i=new o(r.Dot(t.col1,n.col1),r.Dot(t.col2,n.col1)),s=new o(r.Dot(t.col1,n.col2),r.Dot(t.col2,n.col2));return e.FromVV(i,s)},r.Abs=function(e){return e===undefined&&(e=0),e>0?e:-e},r.AbsV=function(e){return new o(r.Abs(e.x),r.Abs(e.y))},r.AbsM=function(t){return e.FromVV(r.AbsV(t.col1),r.AbsV(t.col2))},r.Min=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e<t?e:t},r.MinV=function(e,t){return new o(r.Min(e.x,t.x),r.Min(e.y,t.y))},r.Max=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},r.MaxV=function(e,t){return new o(r.Max(e.x,t.x),r.Max(e.y,t.y))},r.Clamp=function(e,t,n){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),e<t?t:e>n?n:e},r.ClampV=function(e,t,n){return r.MaxV(t,r.MinV(e,n))},r.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},r.Random=function(){return Math.random()*2-1},r.RandomRange=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=Math.random();return n=(t-e)*n+e},r.NextPowerOfTwo=function(e){return e===undefined&&(e=0),e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},r.IsPowerOfTwo=function(e){return e===undefined&&(e=0),e>0&&(e&e-1)==0},n.postDefs.push(function(){n.Common.Math.b2Math.b2Vec2_zero=new o(0,0),n.Common.Math.b2Math.b2Mat22_identity=e.FromVV(new o(1,0),new o(0,1)),n.Common.Math.b2Math.b2Transform_identity=new s(r.b2Vec2_zero,r.b2Mat22_identity)}),i.b2Sweep=function(){this.localCenter=new o,this.c0=new o,this.c=new o},i.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},i.prototype.Copy=function(){var e=new i;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},i.prototype.GetTransform=function(e,t){t===undefined&&(t=0),e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y,e.R.Set((1-t)*this.a0+t*this.a);var n=e.R;e.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y,e.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y},i.prototype.Advance=function(e){e===undefined&&(e=0);if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},s.b2Transform=function(){this.position=new o,this.R=new e},s.prototype.b2Transform=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),e&&(this.position.SetV(e),this.R.SetM(t))},s.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},s.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},s.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},s.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},o.b2Vec2=function(){},o.prototype.b2Vec2=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},o.prototype.SetZero=function(){this.y=this.x=0},o.prototype.Set=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},o.prototype.SetV=function(e){this.x=e.x,this.y=e.y},o.prototype.GetNegative=function(){return new o(-this.x,-this.y)},o.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},o.Make=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),new o(e,t)},o.prototype.Copy=function(){return new o(this.x,this.y)},o.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},o.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},o.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e},o.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},o.prototype.MulTM=function(e){var t=r.Dot(this,e.col1);this.y=r.Dot(this,e.col2),this.x=t},o.prototype.CrossVF=function(e){e===undefined&&(e=0);var t=this.x;this.x=e*this.y,this.y=-e*t},o.prototype.CrossFV=function(e){e===undefined&&(e=0);var t=this.x;this.x=-e*this.y,this.y=e*t},o.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},o.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},o.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},o.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},o.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},o.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},o.prototype.IsValid=function(){return r.IsValid(this.x)&&r.IsValid(this.y)},u.b2Vec3=function(){},u.prototype.b2Vec3=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},u.prototype.SetZero=function(){this.x=this.y=this.z=0},u.prototype.Set=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},u.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},u.prototype.GetNegative=function(){return new u(-this.x,-this.y,-this.z)},u.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},u.prototype.Copy=function(){return new u(this.x,this.y,this.z)},u.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},u.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},u.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e,this.z*=e}}(),function(){var e=n.Common.Math.b2Math,t=n.Common.Math.b2Sweep,s=n.Common.Math.b2Transform,o=n.Common.Math.b2Vec2,u=n.Common.b2Color,a=n.Common.b2Settings,f=n.Collision.b2AABB,l=n.Collision.b2ContactPoint,c=n.Collision.b2DynamicTreeBroadPhase,h=n.Collision.b2RayCastInput,p=n.Collision.b2RayCastOutput,d=n.Collision.Shapes.b2CircleShape,v=n.Collision.Shapes.b2EdgeShape,m=n.Collision.Shapes.b2MassData,g=n.Collision.Shapes.b2PolygonShape,y=n.Collision.Shapes.b2Shape,b=n.Dynamics.b2Body,w=n.Dynamics.b2BodyDef,E=n.Dynamics.b2ContactFilter,S=n.Dynamics.b2ContactImpulse,x=n.Dynamics.b2ContactListener,T=n.Dynamics.b2ContactManager,N=n.Dynamics.b2DebugDraw,C=n.Dynamics.b2DestructionListener,k=n.Dynamics.b2FilterData,L=n.Dynamics.b2Fixture,A=n.Dynamics.b2FixtureDef,O=n.Dynamics.b2Island,M=n.Dynamics.b2TimeStep,_=n.Dynamics.b2World,D=n.Dynamics.Contacts.b2Contact,P=n.Dynamics.Contacts.b2ContactFactory,H=n.Dynamics.Contacts.b2ContactSolver,B=n.Dynamics.Joints.b2Joint,j=n.Dynamics.Joints.b2PulleyJoint;b.b2Body=function(){this.m_xf=new s,this.m_sweep=new t,this.m_linearVelocity=new o,this.m_force=new o},b.prototype.connectEdges=function(t,n,r){r===undefined&&(r=0);var i=Math.atan2(n.GetDirectionVector().y,n.GetDirectionVector().x);r=e.MulFV(Math.tan((i-r)*.5),n.GetDirectionVector()),r=e.SubtractVV(r,n.GetNormalVector()),r=e.MulFV(a.b2_toiSlop,r),r=e.AddVV(r,n.GetVertex1());var s=e.AddVV(t.GetDirectionVector(),n.GetDirectionVector());s.Normalize();var o=e.Dot(t.GetDirectionVector(),n.GetNormalVector())>0;return t.SetNextEdge(n,r,s,o),n.SetPrevEdge(t,r,s,o),i},b.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==1)return null;var t=new L;return t.Create(this,this.m_xf,e),this.m_flags&b.e_activeFlag&&t.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,t.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=_.e_newFixture,t},b.prototype.CreateFixture2=function(e,t){t===undefined&&(t=0);var n=new A;return n.shape=e,n.density=t,this.CreateFixture(n)},b.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()!=1){for(var t=this.m_fixtureList,n=null;t!=null;){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next;break}n=t,t=t.m_next}for(t=this.m_contactList;t;){n=t.contact,t=t.next;var r=n.GetFixtureA(),i=n.GetFixtureB();(e==r||e==i)&&this.m_world.m_contactManager.Destroy(n)}this.m_flags&b.e_activeFlag&&e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b.prototype.SetPositionAndAngle=function(e,t){t===undefined&&(t=0);var n;if(this.m_world.IsLocked()!=1){this.m_xf.R.Set(t),this.m_xf.position.SetV(e),n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t,r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(r,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},b.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},b.prototype.GetTransform=function(){return this.m_xf},b.prototype.GetPosition=function(){return this.m_xf.position},b.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},b.prototype.GetAngle=function(){return this.m_sweep.a},b.prototype.SetAngle=function(e){e===undefined&&(e=0),this.SetPositionAndAngle(this.GetPosition(),e)},b.prototype.GetWorldCenter=function(){return this.m_sweep.c},b.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b.prototype.SetLinearVelocity=function(e){this.m_type!=b.b2_staticBody&&this.m_linearVelocity.SetV(e)},b.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b.prototype.SetAngularVelocity=function(e){e===undefined&&(e=0),this.m_type!=b.b2_staticBody&&(this.m_angularVelocity=e)},b.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b.prototype.GetDefinition=function(){var e=new w;return e.type=this.GetType(),e.allowSleep=(this.m_flags&b.e_allowSleepFlag)==b.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&b.e_fixedRotationFlag)==b.e_fixedRotationFlag,e.bullet=(this.m_flags&b.e_bulletFlag)==b.e_bulletFlag,e.awake=(this.m_flags&b.e_awakeFlag)==b.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},b.prototype.ApplyForce=function(e,t){this.m_type==b.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},b.prototype.ApplyTorque=function(e){e===undefined&&(e=0),this.m_type==b.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e)},b.prototype.ApplyImpulse=function(e,t){this.m_type==b.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x))},b.prototype.Split=function(t){for(var n=this.GetLinearVelocity().Copy(),r=this.GetAngularVelocity(),i=this.GetWorldCenter(),s=this.m_world.CreateBody(this.GetDefinition()),o,u=this.m_fixtureList;u;)if(t(u)){var a=u.m_next;o?o.m_next=a:this.m_fixtureList=a,this.m_fixtureCount--,u.m_next=s.m_fixtureList,s.m_fixtureList=u,s.m_fixtureCount++,u.m_body=s,u=a}else o=u,u=u.m_next;return this.ResetMassData(),s.ResetMassData(),o=this.GetWorldCenter(),t=s.GetWorldCenter(),o=e.AddVV(n,e.CrossFV(r,e.SubtractVV(o,i))),n=e.AddVV(n,e.CrossFV(r,e.SubtractVV(t,i))),this.SetLinearVelocity(o),s.SetLinearVelocity(n),this.SetAngularVelocity(r),s.SetAngularVelocity(r),this.SynchronizeFixtures(),s.SynchronizeFixtures(),s},b.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=i,t=n}r.m_fixtureCount=0;var r=this,i=e;r.GetWorldCenter(),i.GetWorldCenter(),r.GetLinearVelocity().Copy(),i.GetLinearVelocity().Copy(),r.GetAngularVelocity(),i.GetAngularVelocity(),r.ResetMassData(),this.SynchronizeFixtures()},b.prototype.GetMass=function(){return this.m_mass},b.prototype.GetInertia=function(){return this.m_I},b.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},b.prototype.SetMassData=function(t){a.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()!=1&&this.m_type==b.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&(this.m_flags&b.e_fixedRotationFlag)==0&&(this.m_I=t.I-this.m_mass*(t.center.x*t.center.x+t.center.y*t.center.y),this.m_invI=1/this.m_I);var n=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(t.center),this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},b.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero();if(this.m_type!=b.b2_staticBody&&this.m_type!=b.b2_kinematicBody){for(var t=o.Make(0,0),n=this.m_fixtureList;n;n=n.m_next)if(n.m_density!=0){var r=n.GetMassData();this.m_mass+=r.mass,t.x+=r.center.x*r.mass,t.y+=r.center.y*r.mass,this.m_I+=r.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):this.m_invMass=this.m_mass=1,this.m_I>0&&(this.m_flags&b.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(t.x*t.x+t.y*t.y),this.m_I*=this.m_inertiaScale,a.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,n=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(t),this.m_sweep.c0.SetV(e.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-n.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-n.x)}},b.prototype.GetWorldPoint=function(e){var t=this.m_xf.R;return e=new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},b.prototype.GetWorldVector=function(t){return e.MulMV(this.m_xf.R,t)},b.prototype.GetLocalPoint=function(t){return e.MulXT(this.m_xf,t)},b.prototype.GetLocalVector=function(t){return e.MulTMV(this.m_xf.R,t)},b.prototype.GetLinearVelocityFromWorldPoint=function(e){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},b.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R;return e=new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,new o(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},b.prototype.GetLinearDamping=function(){return this.m_linearDamping},b.prototype.SetLinearDamping=function(e){e===undefined&&(e=0),this.m_linearDamping=e},b.prototype.GetAngularDamping=function(){return this.m_angularDamping},b.prototype.SetAngularDamping=function(e){e===undefined&&(e=0),this.m_angularDamping=e},b.prototype.SetType=function(e){e===undefined&&(e=0);if(this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==b.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},b.prototype.GetType=function(){return this.m_type},b.prototype.SetBullet=function(e){e?this.m_flags|=b.e_bulletFlag:this.m_flags&=~b.e_bulletFlag},b.prototype.IsBullet=function(){return(this.m_flags&b.e_bulletFlag)==b.e_bulletFlag},b.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=b.e_allowSleepFlag:(this.m_flags&=~b.e_allowSleepFlag,this.SetAwake(!0))},b.prototype.SetAwake=function(e){e?(this.m_flags|=b.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b.prototype.IsAwake=function(){return(this.m_flags&b.e_awakeFlag)==b.e_awakeFlag},b.prototype.SetFixedRotation=function(e){e?this.m_flags|=b.e_fixedRotationFlag:this.m_flags&=~b.e_fixedRotationFlag,this.ResetMassData()},b.prototype.IsFixedRotation=function(){return(this.m_flags&b.e_fixedRotationFlag)==b.e_fixedRotationFlag},b.prototype.SetActive=function(e){if(e!=this.IsActive()){var t;if(e){this.m_flags|=b.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.CreateProxy(e,this.m_xf)}else{this.m_flags&=~b.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxy(e);for(e=this.m_contactList;e;)t=e,e=e.next,this.m_world.m_contactManager.Destroy(t.contact);this.m_contactList=null}}},b.prototype.IsActive=function(){return(this.m_flags&b.e_activeFlag)==b.e_activeFlag},b.prototype.IsSleepingAllowed=function(){return(this.m_flags&b.e_allowSleepFlag)==b.e_allowSleepFlag},b.prototype.GetFixtureList=function(){return this.m_fixtureList},b.prototype.GetJointList=function(){return this.m_jointList},b.prototype.GetControllerList=function(){return this.m_controllerList},b.prototype.GetContactList=function(){return this.m_contactList},b.prototype.GetNext=function(){return this.m_next},b.prototype.GetUserData=function(){return this.m_userData},b.prototype.SetUserData=function(e){this.m_userData=e},b.prototype.GetWorld=function(){return this.m_world},b.prototype.b2Body=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=b.e_bulletFlag),e.fixedRotation&&(this.m_flags|=b.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=b.e_allowSleepFlag),e.awake&&(this.m_flags|=b.e_awakeFlag),e.active&&(this.m_flags|=b.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=e.type,this.m_type==b.b2_dynamicBody?this.m_invMass=this.m_mass=1:this.m_invMass=this.m_mass=0,this.m_invI=this.m_I=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b.prototype.SynchronizeFixtures=function(){var e=b.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y),n=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(n,e,this.m_xf)},b.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},b.prototype.ShouldCollide=function(e){if(this.m_type!=b.b2_dynamicBody&&e.m_type!=b.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},b.prototype.Advance=function(e){e===undefined&&(e=0),this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},n.postDefs.push(function(){n.Dynamics.b2Body.s_xf1=new s,n.Dynamics.b2Body.e_islandFlag=1,n.Dynamics.b2Body.e_awakeFlag=2,n.Dynamics.b2Body.e_allowSleepFlag=4,n.Dynamics.b2Body.e_bulletFlag=8,n.Dynamics.b2Body.e_fixedRotationFlag=16,n.Dynamics.b2Body.e_activeFlag=32,n.Dynamics.b2Body.b2_staticBody=0,n.Dynamics.b2Body.b2_kinematicBody=1,n.Dynamics.b2Body.b2_dynamicBody=2}),w.b2BodyDef=function(){this.position=new o,this.linearVelocity=new o},w.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=b.b2_staticBody,this.active=!0,this.inertiaScale=1},E.b2ContactFilter=function(){},E.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();return n.groupIndex==r.groupIndex&&n.groupIndex!=0?n.groupIndex>0:(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0},E.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e instanceof L?e:null,t):!0},n.postDefs.push(function(){n.Dynamics.b2ContactFilter.b2_defaultFilter=new E}),S.b2ContactImpulse=function(){this.normalImpulses=new i(a.b2_maxManifoldPoints),this.tangentImpulses=new i(a.b2_maxManifoldPoints)},x.b2ContactListener=function(){},x.prototype.BeginContact=function(){},x.prototype.EndContact=function(){},x.prototype.PreSolve=function(){},x.prototype.PostSolve=function(){},n.postDefs.push(function(){n.Dynamics.b2ContactListener.b2_defaultListener=new x}),T.b2ContactManager=function(){},T.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=E.b2_defaultFilter,this.m_contactListener=x.b2_defaultListener,this.m_contactFactory=new P(this.m_allocator),this.m_broadPhase=new c},T.prototype.AddPair=function(e,t){var n=e instanceof L?e:null,r=t instanceof L?t:null,i=n.GetBody(),s=r.GetBody();if(i!=s){for(var o=s.GetContactList();o;){if(o.other==i){var u=o.contact.GetFixtureA(),a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}s.ShouldCollide(i)!=0&&this.m_contactFilter.ShouldCollide(n,r)!=0&&(o=this.m_contactFactory.Create(n,r),n=o.GetFixtureA(),r=o.GetFixtureB(),i=n.m_body,s=r.m_body,o.m_prev=null,o.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=o),this.m_world.m_contactList=o,o.m_nodeA.contact=o,o.m_nodeA.other=s,o.m_nodeA.prev=null,o.m_nodeA.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=o.m_nodeA),i.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=i,o.m_nodeB.prev=null,o.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=o.m_nodeB),s.m_contactList=o.m_nodeB,++this.m_world.m_contactCount)}},T.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(n.generateCallback(this,this.AddPair))},T.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB();t=t.GetBody(),n=n.GetBody(),e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==t.m_contactList&&(t.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==n.m_contactList&&(n.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},T.prototype.Collide=function(){for(var e=this.m_world.m_contactList;e;){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();if(r.IsAwake()==0&&i.IsAwake()==0)e=e.GetNext();else{if(e.m_flags&D.e_filterFlag){if(i.ShouldCollide(r)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}if(this.m_contactFilter.ShouldCollide(t,n)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}e.m_flags&=~D.e_filterFlag}this.m_broadPhase.TestOverlap(t.m_proxy,n.m_proxy)==0?(t=e,e=t.GetNext(),this.Destroy(t)):(e.Update(this.m_contactListener),e=e.GetNext())}}},n.postDefs.push(function(){n.Dynamics.b2ContactManager.s_evalCP=new l}),N.b2DebugDraw=function(){},N.prototype.b2DebugDraw=function(){},N.prototype.SetFlags=function(){},N.prototype.GetFlags=function(){},N.prototype.AppendFlags=function(){},N.prototype.ClearFlags=function(){},N.prototype.SetSprite=function(){},N.prototype.GetSprite=function(){},N.prototype.SetDrawScale=function(){},N.prototype.GetDrawScale=function(){},N.prototype.SetLineThickness=function(){},N.prototype.GetLineThickness=function(){},N.prototype.SetAlpha=function(){},N.prototype.GetAlpha=function(){},N.prototype.SetFillAlpha=function(){},N.prototype.GetFillAlpha=function(){},N.prototype.SetXFormScale=function(){},N.prototype.GetXFormScale=function(){},N.prototype.DrawPolygon=function(){},N.prototype.DrawSolidPolygon=function(){},N.prototype.DrawCircle=function(){},N.prototype.DrawSolidCircle=function(){},N.prototype.DrawSegment=function(){},N.prototype.DrawTransform=function(){},n.postDefs.push(function(){n.Dynamics.b2DebugDraw.e_shapeBit=1,n.Dynamics.b2DebugDraw.e_jointBit=2,n.Dynamics.b2DebugDraw.e_aabbBit=4,n.Dynamics.b2DebugDraw.e_pairBit=8,n.Dynamics.b2DebugDraw.e_centerOfMassBit=16,n.Dynamics.b2DebugDraw.e_controllerBit=32}),C.b2DestructionListener=function(){},C.prototype.SayGoodbyeJoint=function(){},C.prototype.SayGoodbyeFixture=function(){},k.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},k.prototype.Copy=function(){var e=new k;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},L.b2Fixture=function(){this.m_filter=new k},L.prototype.GetType=function(){return this.m_shape.GetType()},L.prototype.GetShape=function(){return this.m_shape},L.prototype.SetSensor=function(e){if(this.m_isSensor!=e){this.m_isSensor=e;if(this.m_body!=null)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.SetSensor(n.IsSensor()||r.IsSensor()),e=e.next}}},L.prototype.IsSensor=function(){return this.m_isSensor},L.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(!this.m_body)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.FlagForFiltering(),e=e.next}},L.prototype.GetFilterData=function(){return this.m_filter.Copy()},L.prototype.GetBody=function(){return this.m_body},L.prototype.GetNext=function(){return this.m_next},L.prototype.GetUserData=function(){return this.m_userData},L.prototype.SetUserData=function(e){this.m_userData=e},L.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},L.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},L.prototype.GetMassData=function(e){return e===undefined&&(e=null),e==null&&(e=new m),this.m_shape.ComputeMass(e,this.m_density),e},L.prototype.SetDensity=function(e){e===undefined&&(e=0),this.m_density=e},L.prototype.GetDensity=function(){return this.m_density},L.prototype.GetFriction=function(){return this.m_friction},L.prototype.SetFriction=function(e){e===undefined&&(e=0),this.m_friction=e},L.prototype.GetRestitution=function(){return this.m_restitution},L.prototype.SetRestitution=function(e){e===undefined&&(e=0),this.m_restitution=e},L.prototype.GetAABB=function(){return this.m_aabb},L.prototype.b2Fixture=function(){this.m_aabb=new f,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},L.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=e,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},L.prototype.Destroy=function(){this.m_shape=null},L.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},L.prototype.DestroyProxy=function(e){this.m_proxy!=null&&(e.DestroyProxy(this.m_proxy),this.m_proxy=null)},L.prototype.Synchronize=function(t,n,r){if(this.m_proxy){var i=new f,s=new f;this.m_shape.ComputeAABB(i,n),this.m_shape.ComputeAABB(s,r),this.m_aabb.Combine(i,s),n=e.SubtractVV(r.position,n.position),t.MoveProxy(this.m_proxy,this.m_aabb,n)}},A.b2FixtureDef=function(){this.filter=new k},A.prototype.b2FixtureDef=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},O.b2Island=function(){},O.prototype.b2Island=function(){this.m_bodies=new r,this.m_contacts=new r,this.m_joints=new r},O.prototype.Initialize=function(e,t,n,r,i,s){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0);var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null},O.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},O.prototype.Solve=function(t,n,r){var i=0,s=0,o;for(i=0;i<this.m_bodyCount;++i)s=this.m_bodies[i],s.GetType()==b.b2_dynamicBody&&(s.m_linearVelocity.x+=t.dt*(n.x+s.m_invMass*s.m_force.x),s.m_linearVelocity.y+=t.dt*(n.y+s.m_invMass*s.m_force.y),s.m_angularVelocity+=t.dt*s.m_invI*s.m_torque,s.m_linearVelocity.Multiply(e.Clamp(1-t.dt*s.m_linearDamping,0,1)),s.m_angularVelocity*=e.Clamp(1-t.dt*s.m_angularDamping,0,1));this.m_contactSolver.Initialize(t,this.m_contacts,this.m_contactCount,this.m_allocator),n=this.m_contactSolver,n.InitVelocityConstraints(t);for(i=0;i<this.m_jointCount;++i)o=this.m_joints[i],o.InitVelocityConstraints(t);for(i=0;i<t.velocityIterations;++i){for(s=0;s<this.m_jointCount;++s)o=this.m_joints[s],o.SolveVelocityConstraints(t);n.SolveVelocityConstraints()}for(i=0;i<this.m_jointCount;++i)o=this.m_joints[i],o.FinalizeVelocityConstraints();n.FinalizeVelocityConstraints();for(i=0;i<this.m_bodyCount;++i){s=this.m_bodies[i];if(s.GetType()!=b.b2_staticBody){var u=t.dt*s.m_linearVelocity.x,f=t.dt*s.m_linearVelocity.y;u*u+f*f>a.b2_maxTranslationSquared&&(s.m_linearVelocity.Normalize(),s.m_linearVelocity.x*=a.b2_maxTranslation*t.inv_dt,s.m_linearVelocity.y*=a.b2_maxTranslation*t.inv_dt),u=t.dt*s.m_angularVelocity,u*u>a.b2_maxRotationSquared&&(s.m_angularVelocity=s.m_angularVelocity<0?-a.b2_maxRotation*t.inv_dt:a.b2_maxRotation*t.inv_dt),s.m_sweep.c0.SetV(s.m_sweep.c),s.m_sweep.a0=s.m_sweep.a,s.m_sweep.c.x+=t.dt*s.m_linearVelocity.x,s.m_sweep.c.y+=t.dt*s.m_linearVelocity.y,s.m_sweep.a+=t.dt*s.m_angularVelocity,s.SynchronizeTransform()}}for(i=0;i<t.positionIterations;++i){u=n.SolvePositionConstraints(a.b2_contactBaumgarte),f=!0;for(s=0;s<this.m_jointCount;++s)o=this.m_joints[s],o=o.SolvePositionConstraints(a.b2_contactBaumgarte),f=f&&o;if(u&&f)break}this.Report(n.m_constraints);if(r){r=Number.MAX_VALUE,n=a.b2_linearSleepTolerance*a.b2_linearSleepTolerance,u=a.b2_angularSleepTolerance*a.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)s=this.m_bodies[i],s.GetType()!=b.b2_staticBody&&((s.m_flags&b.e_allowSleepFlag)==0&&(r=s.m_sleepTime=0),(s.m_flags&b.e_allowSleepFlag)==0||s.m_angularVelocity*s.m_angularVelocity>u||e.Dot(s.m_linearVelocity,s.m_linearVelocity)>n?r=s.m_sleepTime=0:(s.m_sleepTime+=t.dt,r=e.Min(r,s.m_sleepTime)));if(r>=a.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)s=this.m_bodies[i],s.SetAwake(!1)}},O.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){n=this.m_bodies[t];if(n.GetType()!=b.b2_staticBody){var i=e.dt*n.m_linearVelocity.x,s=e.dt*n.m_linearVelocity.y;i*i+s*s>a.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=a.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=a.b2_maxTranslation*e.inv_dt),i=e.dt*n.m_angularVelocity,i*i>a.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-a.b2_maxRotation*e.inv_dt:a.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}}for(t=0;t<e.positionIterations;++t){i=r.SolvePositionConstraints(.75),s=!0;for(n=0;n<this.m_jointCount;++n){var o=this.m_joints[n].SolvePositionConstraints(a.b2_contactBaumgarte);s=s&&o}if(i&&s)break}this.Report(r.m_constraints)},O.prototype.Report=function(e){if(this.m_listener!=null)for(var t=0;t<this.m_contactCount;++t){for(var n=this.m_contacts[t],r=e[t],i=0;i<r.pointCount;++i)O.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,O.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,O.s_impulse)}},O.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},O.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},O.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},n.postDefs.push(function(){n.Dynamics.b2Island.s_impulse=new S}),M.b2TimeStep=function(){},M.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},_.b2World=function(){this.s_stack=new r,this.m_contactManager=new T,this.m_contactSolver=new H,this.m_island=new O},_.prototype.b2World=function(e,t){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,_.m_warmStarting=!0,_.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_groundBody=this.CreateBody(new w)},_.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},_.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},_.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},_.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},_.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next)for(var r=n.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)},_.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},_.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},_.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;e=new b(e,this),e.m_prev=null;if(e.m_next=this.m_bodyList)this.m_bodyList.m_prev=e;return this.m_bodyList=e,++this.m_bodyCount,e},_.prototype.DestroyBody=function(e){if(this.IsLocked()!=1){for(var t=e.m_jointList;t;){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}for(t=e.m_controllerList;t;)n=t,t=t.nextController,n.controller.RemoveBody(e);for(t=e.m_contactList;t;)n=t,t=t.next,this.m_contactManager.Destroy(n.contact);e.m_contactList=null;for(t=e.m_fixtureList;t;)n=t,t=t.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(n),n.DestroyProxy(this.m_contactManager.m_broadPhase),n.Destroy();e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount}},_.prototype.CreateJoint=function(e){var t=B.Create(e,null);t.m_prev=null;if(t.m_next=this.m_jointList)this.m_jointList.m_prev=t;this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null;if(t.m_edgeA.next=t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null;if(t.m_edgeB.next=t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next;return t},_.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,B.Destroy(e,null),--this.m_jointCount;if(t==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next},_.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList=e,e.m_world=this,this.m_controllerCount++,e},_.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},_.prototype.CreateController=function(e){if(e.m_world!=this)throw Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},_.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},_.prototype.SetWarmStarting=function(e){_.m_warmStarting=e},_.prototype.SetContinuousPhysics=function(e){_.m_continuousPhysics=e},_.prototype.GetBodyCount=function(){return this.m_bodyCount},_.prototype.GetJointCount=function(){return this.m_jointCount},_.prototype.GetContactCount=function(){return this.m_contactCount},_.prototype.SetGravity=function(e){this.m_gravity=e},_.prototype.GetGravity=function(){return this.m_gravity},_.prototype.GetGroundBody=function(){return this.m_groundBody},_.prototype.Step=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.m_flags&_.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~_.e_newFixture),this.m_flags|=_.e_locked;var r=_.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,r.inv_dt=e>0?1/e:0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=_.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),_.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~_.e_locked},_.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},_.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags(),t,n,r;new o,new o,new o;var i;new f,new f,i=[new o,new o,new o,new o];var s=new u(0,0,0);if(e&N.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){i=t.m_xf;for(n=t.GetFixtureList();n;n=n.m_next)r=n.GetShape(),t.IsActive()==0?s.Set(.5,.5,.3):t.GetType()==b.b2_staticBody?s.Set(.5,.9,.5):t.GetType()==b.b2_kinematicBody?s.Set(.5,.5,.9):t.IsAwake()==0?s.Set(.6,.6,.6):s.Set(.9,.7,.7),this.DrawShape(r,i,s)}if(e&N.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(e&N.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(e&N.e_pairBit){s.Set(.3,.9,.9);for(t=this.m_contactManager.m_contactList;t;t=t.GetNext())r=t.GetFixtureA(),n=t.GetFixtureB(),r=r.GetAABB().GetCenter(),n=n.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(r,n,s)}if(e&N.e_aabbBit){r=this.m_contactManager.m_broadPhase,i=[new o,new o,new o,new o];for(t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=0)for(n=t.GetFixtureList();n;n=n.GetNext()){var a=r.GetFatAABB(n.m_proxy);i[0].Set(a.lowerBound.x,a.lowerBound.y),i[1].Set(a.upperBound.x,a.lowerBound.y),i[2].Set(a.upperBound.x,a.upperBound.y),i[3].Set(a.lowerBound.x,a.upperBound.y),this.m_debugDraw.DrawPolygon(i,4,s)}}if(e&N.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)i=_.s_xf,i.R=t.m_xf.R,i.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(i)}},_.prototype.QueryAABB=function(e,t){var n=this.m_contactManager.m_broadPhase;n.Query(function(t){return e(n.GetUserData(t))},t)},_.prototype.QueryShape=function(e,t,n){n===undefined&&(n=null),n==null&&(n=new s,n.SetIdentity());var r=this.m_contactManager.m_broadPhase,i=new f;t.ComputeAABB(i,n),r.Query(function(i){return i=r.GetUserData(i)instanceof L?r.GetUserData(i):null,y.TestOverlap(t,n,i.GetShape(),i.GetBody().GetTransform())?e(i):!0},i)},_.prototype.QueryPoint=function(e,t){var n=this.m_contactManager.m_broadPhase,r=new f;r.lowerBound.Set(t.x-a.b2_linearSlop,t.y-a.b2_linearSlop),r.upperBound.Set(t.x+a.b2_linearSlop,t.y+a.b2_linearSlop),n.Query(function(r){return r=n.GetUserData(r)instanceof L?n.GetUserData(r):null,r.TestPoint(t)?e(r):!0},r)},_.prototype.RayCast=function(e,t,n){var r=this.m_contactManager.m_broadPhase,i=new p,s=new h(t,n);r.RayCast(function(s,u){var a=r.GetUserData(u);a=a instanceof L?a:null;if(a.RayCast(i,s)){var f=i.fraction,l=new o((1-f)*t.x+f*n.x,(1-f)*t.y+f*n.y);return e(a,l,i.normal,f)}return s.maxFraction},s)},_.prototype.RayCastOne=function(e,t){var n;return this.RayCast(function(e,t,r,i){return i===undefined&&(i=0),n=e,i},e,t),n},_.prototype.RayCastAll=function(e,t){var n=new r;return this.RayCast(function(e){return n[n.length]=e,1},e,t),n},_.prototype.GetBodyList=function(){return this.m_bodyList},_.prototype.GetJointList=function(){return this.m_jointList},_.prototype.GetContactList=function(){return this.m_contactList},_.prototype.IsLocked=function(){return(this.m_flags&_.e_locked)>0},_.prototype.Solve=function(e){for(var t,n=this.m_controllerList;n;n=n.m_next)n.Step(e);n=this.m_island,n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~b.e_islandFlag;for(var r=this.m_contactList;r;r=r.m_next)r.m_flags&=~D.e_islandFlag;for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;parseInt(this.m_bodyCount),r=this.s_stack;for(var i=this.m_bodyList;i;i=i.m_next)if(!(i.m_flags&b.e_islandFlag)&&i.IsAwake()!=0&&i.IsActive()!=0&&i.GetType()!=b.b2_staticBody){n.Clear();var s=0;r[s++]=i;for(i.m_flags|=b.e_islandFlag;s>0;){t=r[--s],n.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()!=b.b2_staticBody){for(var o,u=t.m_contactList;u;u=u.next)u.contact.m_flags&D.e_islandFlag||u.contact.IsSensor()!=1&&u.contact.IsEnabled()!=0&&u.contact.IsTouching()!=0&&(n.AddContact(u.contact),u.contact.m_flags|=D.e_islandFlag,o=u.other,o.m_flags&b.e_islandFlag||(r[s++]=o,o.m_flags|=b.e_islandFlag));for(t=t.m_jointList;t;t=t.next)t.joint.m_islandFlag!=1&&(o=t.other,o.IsActive()!=0&&(n.AddJoint(t.joint),t.joint.m_islandFlag=!0,o.m_flags&b.e_islandFlag||(r[s++]=o,o.m_flags|=b.e_islandFlag)))}}n.Solve(e,this.m_gravity,this.m_allowSleep);for(s=0;s<n.m_bodyCount;++s)t=n.m_bodies[s],t.GetType()==b.b2_staticBody&&(t.m_flags&=~b.e_islandFlag)}for(s=0;s<r.length;++s){if(!r[s])break;r[s]=null}for(t=this.m_bodyList;t;t=t.m_next)t.IsAwake()==0||t.IsActive()==0||t.GetType()!=b.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},_.prototype.SolveTOI=function(e){var t,n,r,i=this.m_island;i.Initialize(this.m_bodyCount,a.b2_maxTOIContactsPerIsland,a.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var s=_.s_queue;for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~b.e_islandFlag,t.m_sweep.t0=0;for(r=this.m_contactList;r;r=r.m_next)r.m_flags&=~(D.e_toiFlag|D.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(;;){var o=null,u=1;for(r=this.m_contactList;r;r=r.m_next)if(r.IsSensor()!=1&&r.IsEnabled()!=0&&r.IsContinuous()!=0){t=1;if(r.m_flags&D.e_toiFlag)t=r.m_toi;else{t=r.m_fixtureA,n=r.m_fixtureB,t=t.m_body,n=n.m_body;if(!(t.GetType()==b.b2_dynamicBody&&t.IsAwake()!=0||n.GetType()==b.b2_dynamicBody&&n.IsAwake()!=0))continue;var f=t.m_sweep.t0;t.m_sweep.t0<n.m_sweep.t0?(f=n.m_sweep.t0,t.m_sweep.Advance(f)):n.m_sweep.t0<t.m_sweep.t0&&(f=t.m_sweep.t0,n.m_sweep.Advance(f)),t=r.ComputeTOI(t.m_sweep,n.m_sweep),a.b2Assert(0<=t&&t<=1),t>0&&t<1&&(t=(1-t)*f+t,t>1&&(t=1)),r.m_toi=t,r.m_flags|=D.e_toiFlag}Number.MIN_VALUE<t&&t<u&&(o=r,u=t)}if(o==null||1-100*Number.MIN_VALUE<u)break;t=o.m_fixtureA,n=o.m_fixtureB,t=t.m_body,n=n.m_body,_.s_backupA.Set(t.m_sweep),_.s_backupB.Set(n.m_sweep),t.Advance(u),n.Advance(u),o.Update(this.m_contactManager.m_contactListener),o.m_flags&=~D.e_toiFlag;if(o.IsSensor()==1||o.IsEnabled()==0)t.m_sweep.Set(_.s_backupA),n.m_sweep.Set(_.s_backupB),t.SynchronizeTransform(),n.SynchronizeTransform();else if(o.IsTouching()!=0){t=t,t.GetType()!=b.b2_dynamicBody&&(t=n),i.Clear(),o=r=0,s[r+o++]=t;for(t.m_flags|=b.e_islandFlag;o>0;){t=s[r++],--o,i.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()==b.b2_dynamicBody){for(n=t.m_contactList;n;n=n.next){if(i.m_contactCount==i.m_contactCapacity)break;n.contact.m_flags&D.e_islandFlag||n.contact.IsSensor()!=1&&n.contact.IsEnabled()!=0&&n.contact.IsTouching()!=0&&(i.AddContact(n.contact),n.contact.m_flags|=D.e_islandFlag,f=n.other,f.m_flags&b.e_islandFlag||(f.GetType()!=b.b2_staticBody&&(f.Advance(u),f.SetAwake(!0)),s[r+o]=f,++o,f.m_flags|=b.e_islandFlag))}for(t=t.m_jointList;t;t=t.next)i.m_jointCount!=i.m_jointCapacity&&t.joint.m_islandFlag!=1&&(f=t.other,f.IsActive()!=0&&(i.AddJoint(t.joint),t.joint.m_islandFlag=!0,f.m_flags&b.e_islandFlag||(f.GetType()!=b.b2_staticBody&&(f.Advance(u),f.SetAwake(!0)),s[r+o]=f,++o,f.m_flags|=b.e_islandFlag)))}}r=_.s_timestep,r.warmStarting=!1,r.dt=(1-u)*e.dt,r.inv_dt=1/r.dt,r.dtRatio=0,r.velocityIterations=e.velocityIterations,r.positionIterations=e.positionIterations,i.SolveTOI(r);for(u=u=0;u<i.m_bodyCount;++u){t=i.m_bodies[u],t.m_flags&=~b.e_islandFlag;if(t.IsAwake()!=0&&t.GetType()==b.b2_dynamicBody){t.SynchronizeFixtures();for(n=t.m_contactList;n;n=n.next)n.contact.m_flags&=~D.e_toiFlag}}for(u=0;u<i.m_contactCount;++u)r=i.m_contacts[u],r.m_flags&=~(D.e_toiFlag|D.e_islandFlag);for(u=0;u<i.m_jointCount;++u)r=i.m_joints[u],r.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},_.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf.position,i=n.m_xf.position,s=e.GetAnchorA(),o=e.GetAnchorB(),u=_.s_jointColor;switch(e.m_type){case B.e_distanceJoint:this.m_debugDraw.DrawSegment(s,o,u);break;case B.e_pulleyJoint:t=e instanceof j?e:null,e=t.GetGroundAnchorA(),t=t.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(e,s,u),this.m_debugDraw.DrawSegment(t,o,u),this.m_debugDraw.DrawSegment(e,t,u);break;case B.e_mouseJoint:this.m_debugDraw.DrawSegment(s,o,u);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,s,u),this.m_debugDraw.DrawSegment(s,o,u),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(i,o,u)}},_.prototype.DrawShape=function(t,n,i){switch(t.m_type){case y.e_circleShape:var s=t instanceof d?t:null;this.m_debugDraw.DrawSolidCircle(e.MulX(n,s.m_p),s.m_radius,n.R.col1,i);break;case y.e_polygonShape:s=0,s=t instanceof g?t:null,t=parseInt(s.GetVertexCount());var o=s.GetVertices(),u=new r(t);for(s=0;s<t;++s)u[s]=e.MulX(n,o[s]);this.m_debugDraw.DrawSolidPolygon(u,t,i);break;case y.e_edgeShape:s=t instanceof v?t:null,this.m_debugDraw.DrawSegment(e.MulX(n,s.GetVertex1()),e.MulX(n,s.GetVertex2()),i)}},n.postDefs.push(function(){n.Dynamics.b2World.s_timestep2=new M,n.Dynamics.b2World.s_xf=new s,n.Dynamics.b2World.s_backupA=new t,n.Dynamics.b2World.s_backupB=new t,n.Dynamics.b2World.s_timestep=new M,n.Dynamics.b2World.s_queue=new r,n.Dynamics.b2World.s_jointColor=new u(.5,.8,.8),n.Dynamics.b2World.e_newFixture=1,n.Dynamics.b2World.e_locked=2})}(),function(){var e=n.Collision.Shapes.b2CircleShape,t=n.Collision.Shapes.b2EdgeShape,s=n.Collision.Shapes.b2PolygonShape,o=n.Collision.Shapes.b2Shape,u=n.Dynamics.Contacts.b2CircleContact,a=n.Dynamics.Contacts.b2Contact,f=n.Dynamics.Contacts.b2ContactConstraint,l=n.Dynamics.Contacts.b2ContactConstraintPoint,c=n.Dynamics.Contacts.b2ContactEdge,h=n.Dynamics.Contacts.b2ContactFactory,p=n.Dynamics.Contacts.b2ContactRegister,d=n.Dynamics.Contacts.b2ContactResult,v=n.Dynamics.Contacts.b2ContactSolver,m=n.Dynamics.Contacts.b2EdgeAndCircleContact,g=n.Dynamics.Contacts.b2NullContact,y=n.Dynamics.Contacts.b2PolyAndCircleContact,b=n.Dynamics.Contacts.b2PolyAndEdgeContact,w=n.Dynamics.Contacts.b2PolygonContact,E=n.Dynamics.Contacts.b2PositionSolverManifold,S=n.Dynamics.b2Body,x=n.Dynamics.b2TimeStep,T=n.Common.b2Settings,N=n.Common.Math.b2Mat22,C=n.Common.Math.b2Math,k=n.Common.Math.b2Vec2,L=n.Collision.b2Collision,A=n.Collision.b2ContactID,O=n.Collision.b2Manifold,M=n.Collision.b2TimeOfImpact,_=n.Collision.b2TOIInput,D=n.Collision.b2WorldManifold;n.inherit(u,n.Dynamics.Contacts.b2Contact),u.prototype.__super=n.Dynamics.Contacts.b2Contact.prototype,u.b2CircleContact=function(){n.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},u.Create=function(){return new u},u.Destroy=function(){},u.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},u.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();L.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)},a.b2Contact=function(){this.m_nodeA=new c,this.m_nodeB=new c,this.m_manifold=new O,this.m_oldManifold=new O},a.prototype.GetManifold=function(){return this.m_manifold},a.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},a.prototype.IsTouching=function(){return(this.m_flags&a.e_touchingFlag)==a.e_touchingFlag},a.prototype.IsContinuous=function(){return(this.m_flags&a.e_continuousFlag)==a.e_continuousFlag},a.prototype.SetSensor=function(e){e?this.m_flags|=a.e_sensorFlag:this.m_flags&=~a.e_sensorFlag},a.prototype.IsSensor=function(){return(this.m_flags&a.e_sensorFlag)==a.e_sensorFlag},a.prototype.SetEnabled=function(e){e?this.m_flags|=a.e_enabledFlag:this.m_flags&=~a.e_enabledFlag},a.prototype.IsEnabled=function(){return(this.m_flags&a.e_enabledFlag)==a.e_enabledFlag},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetFixtureA=function(){return this.m_fixtureA},a.prototype.GetFixtureB=function(){return this.m_fixtureB},a.prototype.FlagForFiltering=function(){this.m_flags|=a.e_filterFlag},a.prototype.b2Contact=function(){},a.prototype.Reset=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),this.m_flags=a.e_enabledFlag;if(!e||!t)this.m_fixtureB=this.m_fixtureA=null;else{if(e.IsSensor()||t.IsSensor())this.m_flags|=a.e_sensorFlag;var n=e.GetBody(),r=t.GetBody();if(n.GetType()!=S.b2_dynamicBody||n.IsBullet()||r.GetType()!=S.b2_dynamicBody||r.IsBullet())this.m_flags|=a.e_continuousFlag;this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}},a.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=a.e_enabledFlag;var n=!1;t=(this.m_flags&a.e_touchingFlag)==a.e_touchingFlag;var r=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,s=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&a.e_sensorFlag)s&&(n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),r=r.GetTransform(),i=i.GetTransform(),n=o.TestOverlap(n,r,s,i)),this.m_manifold.m_pointCount=0;else{r.GetType()!=S.b2_dynamicBody||r.IsBullet()||i.GetType()!=S.b2_dynamicBody||i.IsBullet()?this.m_flags|=a.e_continuousFlag:this.m_flags&=~a.e_continuousFlag;if(s){this.Evaluate(),n=this.m_manifold.m_pointCount>0;for(s=0;s<this.m_manifold.m_pointCount;++s){var u=this.m_manifold.m_points[s];u.m_normalImpulse=0,u.m_tangentImpulse=0;for(var f=u.m_id,l=0;l<this.m_oldManifold.m_pointCount;++l){var c=this.m_oldManifold.m_points[l];if(c.m_id.key==f.key){u.m_normalImpulse=c.m_normalImpulse,u.m_tangentImpulse=c.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;n!=t&&(r.SetAwake(!0),i.SetAwake(!0))}n?this.m_flags|=a.e_touchingFlag:this.m_flags&=~a.e_touchingFlag,t==0&&n==1&&e.BeginContact(this),t==1&&n==0&&e.EndContact(this),(this.m_flags&a.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)},a.prototype.Evaluate=function(){},a.prototype.ComputeTOI=function(e,t){return a.s_input.proxyA.Set(this.m_fixtureA.GetShape()),a.s_input.proxyB.Set(this.m_fixtureB.GetShape()),a.s_input.sweepA=e,a.s_input.sweepB=t,a.s_input.tolerance=T.b2_linearSlop,M.TimeOfImpact(a.s_input)},n.postDefs.push(function(){n.Dynamics.Contacts.b2Contact.e_sensorFlag=1,n.Dynamics.Contacts.b2Contact.e_continuousFlag=2,n.Dynamics.Contacts.b2Contact.e_islandFlag=4,n.Dynamics.Contacts.b2Contact.e_toiFlag=8,n.Dynamics.Contacts.b2Contact.e_touchingFlag=16,n.Dynamics.Contacts.b2Contact.e_enabledFlag=32,n.Dynamics.Contacts.b2Contact.e_filterFlag=64,n.Dynamics.Contacts.b2Contact.s_input=new _}),f.b2ContactConstraint=function(){this.localPlaneNormal=new k,this.localPoint=new k,this.normal=new k,this.normalMass=new N,this.K=new N},f.prototype.b2ContactConstraint=function(){this.points=new r(T.b2_maxManifoldPoints);for(var e=0;e<T.b2_maxManifoldPoints;e++)this.points[e]=new l},l.b2ContactConstraintPoint=function(){this.localPoint=new k,this.rA=new k,this.rB=new k},c.b2ContactEdge=function(){},h.b2ContactFactory=function(){},h.prototype.b2ContactFactory=function(e){this.m_allocator=e,this.InitializeRegisters()},h.prototype.AddType=function(e,t,n,r){n===undefined&&(n=0),r===undefined&&(r=0),this.m_registers[n][r].createFcn=e,this.m_registers[n][r].destroyFcn=t,this.m_registers[n][r].primary=!0,n!=r&&(this.m_registers[r][n].createFcn=e,this.m_registers[r][n].destroyFcn=t,this.m_registers[r][n].primary=!1)},h.prototype.InitializeRegisters=function(){this.m_registers=new r(o.e_shapeTypeCount);for(var e=0;e<o.e_shapeTypeCount;e++){this.m_registers[e]=new r(o.e_shapeTypeCount);for(var t=0;t<o.e_shapeTypeCount;t++)this.m_registers[e][t]=new p}this.AddType(u.Create,u.Destroy,o.e_circleShape,o.e_circleShape),this.AddType(y.Create,y.Destroy,o.e_polygonShape,o.e_circleShape),this.AddType(w.Create,w.Destroy,o.e_polygonShape,o.e_polygonShape),this.AddType(m.Create,m.Destroy,o.e_edgeShape,o.e_circleShape),this.AddType(b.Create,b.Destroy,o.e_polygonShape,o.e_edgeShape)},h.prototype.Create=function(e,t){var n=parseInt(e.GetType()),r=parseInt(t.GetType());return n=this.m_registers[n][r],n.pool?(r=n.pool,n.pool=r.m_next,n.poolCount--,r.Reset(e,t),r):(r=n.createFcn,r!=null?(n.primary?(r=r(this.m_allocator),r.Reset(e,t)):(r=r(this.m_allocator),r.Reset(t,e)),r):null)},h.prototype.Destroy=function(e){e.m_manifold.m_pointCount>0&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=parseInt(e.m_fixtureA.GetType()),n=parseInt(e.m_fixtureB.GetType());t=this.m_registers[t][n],t.poolCount++,e.m_next=t.pool,t.pool=e,t=t.destroyFcn,t(e,this.m_allocator)},p.b2ContactRegister=function(){},d.b2ContactResult=function(){this.position=new k,this.normal=new k,this.id=new A},v.b2ContactSolver=function(){this.m_step=new x,this.m_constraints=new r},v.prototype.b2ContactSolver=function(){},v.prototype.Initialize=function(e,t,n,r){n===undefined&&(n=0);var i;this.m_step.Set(e),this.m_allocator=r,e=0;for(this.m_constraintCount=n;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new f;for(e=0;e<n;++e){i=t[e],r=i.m_fixtureA;var s=i.m_fixtureB,o=r.m_shape.m_radius,u=s.m_shape.m_radius,a=r.m_body,l=s.m_body,c=i.GetManifold(),h=T.b2MixFriction(r.GetFriction(),s.GetFriction()),p=T.b2MixRestitution(r.GetRestitution(),s.GetRestitution()),d=a.m_linearVelocity.x,m=a.m_linearVelocity.y,g=l.m_linearVelocity.x,y=l.m_linearVelocity.y,b=a.m_angularVelocity,w=l.m_angularVelocity;T.b2Assert(c.m_pointCount>0),v.s_worldManifold.Initialize(c,a.m_xf,o,l.m_xf,u),s=v.s_worldManifold.m_normal.x,i=v.s_worldManifold.m_normal.y,r=this.m_constraints[e],r.bodyA=a,r.bodyB=l,r.manifold=c,r.normal.x=s,r.normal.y=i,r.pointCount=c.m_pointCount,r.friction=h,r.restitution=p,r.localPlaneNormal.x=c.m_localPlaneNormal.x,r.localPlaneNormal.y=c.m_localPlaneNormal.y,r.localPoint.x=c.m_localPoint.x,r.localPoint.y=c.m_localPoint.y,r.radius=o+u,r.type=c.m_type;for(o=0;o<r.pointCount;++o){h=c.m_points[o],u=r.points[o],u.normalImpulse=h.m_normalImpulse,u.tangentImpulse=h.m_tangentImpulse,u.localPoint.SetV(h.m_localPoint),h=u.rA.x=v.s_worldManifold.m_points[o].x-a.m_sweep.c.x,p=u.rA.y=v.s_worldManifold.m_points[o].y-a.m_sweep.c.y;var E=u.rB.x=v.s_worldManifold.m_points[o].x-l.m_sweep.c.x,S=u.rB.y=v.s_worldManifold.m_points[o].y-l.m_sweep.c.y,x=h*i-p*s,N=E*i-S*s;x*=x,N*=N,u.normalMass=1/(a.m_invMass+l.m_invMass+a.m_invI*x+l.m_invI*N);var C=a.m_mass*a.m_invMass+l.m_mass*l.m_invMass;C+=a.m_mass*a.m_invI*x+l.m_mass*l.m_invI*N,u.equalizedMass=1/C,N=i,C=-s,x=h*C-p*N,N=E*C-S*N,x*=x,N*=N,u.tangentMass=1/(a.m_invMass+l.m_invMass+a.m_invI*x+l.m_invI*N),u.velocityBias=0,h=r.normal.x*(g+ -w*S-d- -b*p)+r.normal.y*(y+w*E-m-b*h),h<-T.b2_velocityThreshold&&(u.velocityBias+=-r.restitution*h)}r.pointCount==2&&(y=r.points[0],g=r.points[1],c=a.m_invMass,a=a.m_invI,d=l.m_invMass,l=l.m_invI,m=y.rA.x*i-y.rA.y*s,y=y.rB.x*i-y.rB.y*s,b=g.rA.x*i-g.rA.y*s,g=g.rB.x*i-g.rB.y*s,s=c+d+a*m*m+l*y*y,i=c+d+a*b*b+l*g*g,l=c+d+a*m*b+l*y*g,s*s<100*(s*i-l*l)?(r.K.col1.Set(s,l),r.K.col2.Set(l,i),r.K.GetInverse(r.normalMass)):r.pointCount=1)}},v.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var n=this.m_constraints[t],r=n.bodyA,i=n.bodyB,s=r.m_invMass,o=r.m_invI,u=i.m_invMass,a=i.m_invI,f=n.normal.x,l=n.normal.y,c=l,h=-f,p=0,d=0;if(e.warmStarting){d=n.pointCount;for(p=0;p<d;++p){var v=n.points[p];v.normalImpulse*=e.dtRatio,v.tangentImpulse*=e.dtRatio;var m=v.normalImpulse*f+v.tangentImpulse*c,g=v.normalImpulse*l+v.tangentImpulse*h;r.m_angularVelocity-=o*(v.rA.x*g-v.rA.y*m),r.m_linearVelocity.x-=s*m,r.m_linearVelocity.y-=s*g,i.m_angularVelocity+=a*(v.rB.x*g-v.rB.y*m),i.m_linearVelocity.x+=u*m,i.m_linearVelocity.y+=u*g}}else{d=n.pointCount;for(p=0;p<d;++p)r=n.points[p],r.normalImpulse=0,r.tangentImpulse=0}}},v.prototype.SolveVelocityConstraints=function(){for(var e=0,t,n=0,r=0,i=0,s=r=r=n=n=0,o=n=n=0,u=n=i=0,a=0,f,l=0;l<this.m_constraintCount;++l){i=this.m_constraints[l];var c=i.bodyA,h=i.bodyB,p=c.m_angularVelocity,d=h.m_angularVelocity,v=c.m_linearVelocity,m=h.m_linearVelocity,g=c.m_invMass,y=c.m_invI,b=h.m_invMass,w=h.m_invI;u=i.normal.x;var E=a=i.normal.y;f=-u,o=i.friction;for(e=0;e<i.pointCount;e++)t=i.points[e],n=m.x-d*t.rB.y-v.x+p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,n=n*E+r*f,n=t.tangentMass*-n,r=o*t.normalImpulse,r=C.Clamp(t.tangentImpulse+n,-r,r),n=r-t.tangentImpulse,s=n*E,n*=f,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.tangentImpulse=r;parseInt(i.pointCount);if(i.pointCount==1)t=i.points[0],n=m.x+ -d*t.rB.y-v.x- -p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,i=n*u+r*a,n=-t.normalMass*(i-t.velocityBias),r=t.normalImpulse+n,r=r>0?r:0,n=r-t.normalImpulse,s=n*u,n*=a,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.normalImpulse=r;else{t=i.points[0],e=i.points[1],n=t.normalImpulse,o=e.normalImpulse;var S=(m.x-d*t.rB.y-v.x+p*t.rA.y)*u+(m.y+d*t.rB.x-v.y-p*t.rA.x)*a,x=(m.x-d*e.rB.y-v.x+p*e.rA.y)*u+(m.y+d*e.rB.x-v.y-p*e.rA.x)*a;r=S-t.velocityBias,s=x-e.velocityBias,f=i.K,r-=f.col1.x*n+f.col2.x*o;for(s-=f.col1.y*n+f.col2.y*o;;){f=i.normalMass,E=-(f.col1.x*r+f.col2.x*s),f=-(f.col1.y*r+f.col2.y*s);if(E>=0&&f>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=-t.normalMass*r,f=0,x=i.K.col1.y*E+s;if(E>=0&&x>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=0,f=-e.normalMass*s,S=i.K.col2.x*f+r;if(f>=0&&S>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}f=E=0,S=r,x=s;if(S>=0&&x>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}break}}c.m_angularVelocity=p,h.m_angularVelocity=d}},v.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],n=t.manifold,r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}},v.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);for(var t=0,n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;v.s_psm.Initialize(r);for(var l=v.s_psm.m_normal,c=0;c<r.pointCount;c++){var h=r.points[c],p=v.s_psm.m_points[c],d=v.s_psm.m_separations[c],m=p.x-i.m_sweep.c.x,g=p.y-i.m_sweep.c.y,y=p.x-s.m_sweep.c.x;p=p.y-s.m_sweep.c.y,t=t<d?t:d,d=C.Clamp(e*(d+T.b2_linearSlop),-T.b2_maxLinearCorrection,0),d=-h.equalizedMass*d,h=d*l.x,d*=l.y,i.m_sweep.c.x-=o*h,i.m_sweep.c.y-=o*d,i.m_sweep.a-=u*(m*d-g*h),i.SynchronizeTransform(),s.m_sweep.c.x+=a*h,s.m_sweep.c.y+=a*d,s.m_sweep.a+=f*(y*d-p*h),s.SynchronizeTransform()}}return t>-1.5*T.b2_linearSlop},n.postDefs.push(function(){n.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new D,n.Dynamics.Contacts.b2ContactSolver.s_psm=new E}),n.inherit(m,n.Dynamics.Contacts.b2Contact),m.prototype.__super=n.Dynamics.Contacts.b2Contact.prototype,m.b2EdgeAndCircleContact=function(){n.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.Create=function(){return new m},m.Destroy=function(){},m.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},m.prototype.Evaluate=function(){var n=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof t?this.m_fixtureA.GetShape():null,n.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)},m.prototype.b2CollideEdgeAndCircle=function(){},n.inherit(g,n.Dynamics.Contacts.b2Contact),g.prototype.__super=n.Dynamics.Contacts.b2Contact.prototype,g.b2NullContact=function(){n.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},g.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},g.prototype.Evaluate=function(){},n.inherit(y,n.Dynamics.Contacts.b2Contact),y.prototype.__super=n.Dynamics.Contacts.b2Contact.prototype,y.b2PolyAndCircleContact=function(){n.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(){return new y},y.Destroy=function(){},y.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),T.b2Assert(e.GetType()==o.e_polygonShape),T.b2Assert(t.GetType()==o.e_circleShape)},y.prototype.Evaluate=function(){var t=this.m_fixtureA.m_body,n=this.m_fixtureB.m_body;L.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof s?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)},n.inherit(b,n.Dynamics.Contacts.b2Contact),b.prototype.__super=n.Dynamics.Contacts.b2Contact.prototype,b.b2PolyAndEdgeContact=function(){n.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b.Create=function(){return new b},b.Destroy=function(){},b.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),T.b2Assert(e.GetType()==o.e_polygonShape),T.b2Assert(t.GetType()==o.e_edgeShape)},b.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof s?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof t?this.m_fixtureB.GetShape():null,n.m_xf)},b.prototype.b2CollidePolyAndEdge=function(){},n.inherit(w,n.Dynamics.Contacts.b2Contact),w.prototype.__super=n.Dynamics.Contacts.b2Contact.prototype,w.b2PolygonContact=function(){n.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},w.Create=function(){return new w},w.Destroy=function(){},w.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},w.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();L.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof s?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof s?this.m_fixtureB.GetShape():null,t.m_xf)},E.b2PositionSolverManifold=function(){},E.prototype.b2PositionSolverManifold=function(){this.m_normal=new k,this.m_separations=new i(T.b2_maxManifoldPoints),this.m_points=new r(T.b2_maxManifoldPoints);for(var e=0;e<T.b2_maxManifoldPoints;e++)this.m_points[e]=new k},E.prototype.Initialize=function(e){T.b2Assert(e.pointCount>0);var t=0,n=0,r=0,i,s=0,o=0;switch(e.type){case O.e_circles:i=e.bodyA.m_xf.R,r=e.localPoint,t=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),n=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R,r=e.points[0].localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),i=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),r=s-t,o=i-n;var u=r*r+o*o;u>Number.MIN_VALUE*Number.MIN_VALUE?(u=Math.sqrt(u),this.m_normal.x=r/u,this.m_normal.y=o/u):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(t+s),this.m_points[0].y=.5*(n+i),this.m_separations[0]=r*this.m_normal.x+o*this.m_normal.y-e.radius;break;case O.e_faceA:i=e.bodyA.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyA.m_xf.R,r=e.localPoint,s=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].x=n,this.m_points[t].y=r;break;case O.e_faceB:i=e.bodyB.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyB.m_xf.R,r=e.localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},n.postDefs.push(function(){n.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new k,n.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new k})}(),function(){var e=n.Common.Math.b2Mat22,t=n.Common.Math.b2Math,r=n.Common.Math.b2Vec2,i=n.Common.b2Color,s=n.Dynamics.Controllers.b2BuoyancyController,o=n.Dynamics.Controllers.b2ConstantAccelController,u=n.Dynamics.Controllers.b2ConstantForceController,a=n.Dynamics.Controllers.b2Controller,f=n.Dynamics.Controllers.b2ControllerEdge,l=n.Dynamics.Controllers.b2GravityController,c=n.Dynamics.Controllers.b2TensorDampingController;n.inherit(s,n.Dynamics.Controllers.b2Controller),s.prototype.__super=n.Dynamics.Controllers.b2Controller.prototype,s.b2BuoyancyController=function(){n.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new r(0,-1),this.density=this.offset=0,this.velocity=new r(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},s.prototype.Step=function(){if(this.m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;if(t.IsAwake()!=0){for(var n=new r,i=new r,s=0,o=0,u=t.GetFixtureList();u;u=u.GetNext()){var a=new r,f=u.GetShape().ComputeSubmergedArea(this.normal,this.offset,t.GetTransform(),a);s+=f,n.x+=f*a.x,n.y+=f*a.y;var l=0;l=1,o+=f*l,i.x+=f*a.x*l,i.y+=f*a.y*l}n.x/=s,n.y/=s,i.x/=o,i.y/=o,s<Number.MIN_VALUE||(o=this.gravity.GetNegative(),o.Multiply(this.density*s),t.ApplyForce(o,i),i=t.GetLinearVelocityFromWorldPoint(n),i.Subtract(this.velocity),i.Multiply(-this.linearDrag*s),t.ApplyForce(i,n),t.ApplyTorque(-t.GetInertia()/t.GetMass()*s*t.GetAngularVelocity()*this.angularDrag))}}}},s.prototype.Draw=function(e){var t=new r,n=new r;t.x=this.normal.x*this.offset+this.normal.y*1e3,t.y=this.normal.y*this.offset-this.normal.x*1e3,n.x=this.normal.x*this.offset-this.normal.y*1e3,n.y=this.normal.y*this.offset+this.normal.x*1e3;var s=new i(0,0,1);e.DrawSegment(t,n,s)},n.inherit(o,n.Dynamics.Controllers.b2Controller),o.prototype.__super=n.Dynamics.Controllers.b2Controller.prototype,o.b2ConstantAccelController=function(){n.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new r(0,0)},o.prototype.Step=function(e){e=new r(this.A.x*e.dt,this.A.y*e.dt);for(var t=this.m_bodyList;t;t=t.nextBody){var n=t.body;n.IsAwake()&&n.SetLinearVelocity(new r(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}},n.inherit(u,n.Dynamics.Controllers.b2Controller),u.prototype.__super=n.Dynamics.Controllers.b2Controller.prototype,u.b2ConstantForceController=function(){n.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new r(0,0)},u.prototype.Step=function(){for(var e=this.m_bodyList;e;e=e.nextBody){var t=e.body;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}},a.b2Controller=function(){},a.prototype.Step=function(){},a.prototype.Draw=function(){},a.prototype.AddBody=function(e){var t=new f;t.controller=this,t.body=e,t.nextBody=this.m_bodyList,t.prevBody=null,this.m_bodyList=t,t.nextBody&&(t.nextBody.prevBody=t),this.m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList=t,t.nextController&&(t.nextController.prevController=t),e.m_controllerCount++},a.prototype.RemoveBody=function(e){for(var t=e.m_controllerList;t&&t.controller!=this;)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),this.m_bodyList==t&&(this.m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,this.m_bodyCount--},a.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)},a.prototype.GetNext=function(){return this.m_next},a.prototype.GetWorld=function(){return this.m_world},a.prototype.GetBodyList=function(){return this.m_bodyList},f.b2ControllerEdge=function(){},n.inherit(l,n.Dynamics.Controllers.b2Controller),l.prototype.__super=n.Dynamics.Controllers.b2Controller.prototype,l.b2GravityController=function(){n.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},l.prototype.Step=function(){var e=null,t=null,n=null,i=0,s=null,o=null,u=null,a=0,f=0,l=0;a=null;if(this.invSqr)for(e=this.m_bodyList;e;e=e.nextBody){t=e.body,n=t.GetWorldCenter(),i=t.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody)o=s.body,u=o.GetWorldCenter(),a=u.x-n.x,f=u.y-n.y,l=a*a+f*f,l<Number.MIN_VALUE||(a=new r(a,f),a.Multiply(this.G/l/Math.sqrt(l)*i*o.GetMass()),t.IsAwake()&&t.ApplyForce(a,n),a.Multiply(-1),o.IsAwake()&&o.ApplyForce(a,u))}else for(e=this.m_bodyList;e;e=e.nextBody){t=e.body,n=t.GetWorldCenter(),i=t.GetMass();for(s=this.m_bodyList;s!=e;s=s.nextBody)o=s.body,u=o.GetWorldCenter(),a=u.x-n.x,f=u.y-n.y,l=a*a+f*f,l<Number.MIN_VALUE||(a=new r(a,f),a.Multiply(this.G/l*i*o.GetMass()),t.IsAwake()&&t.ApplyForce(a,n),a.Multiply(-1),o.IsAwake()&&o.ApplyForce(a,u))}},n.inherit(c,n.Dynamics.Controllers.b2Controller),c.prototype.__super=n.Dynamics.Controllers.b2Controller.prototype,c.b2TensorDampingController=function(){n.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new e,this.maxTimestep=0},c.prototype.SetAxisAligned=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,this.maxTimestep=e>0||t>0?1/Math.max(e,t):0},c.prototype.Step=function(e){e=e.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var i=n.body;if(i.IsAwake()){var s=i.GetWorldVector(t.MulMV(this.T,i.GetLocalVector(i.GetLinearVelocity())));i.SetLinearVelocity(new r(i.GetLinearVelocity().x+s.x*e,i.GetLinearVelocity().y+s.y*e))}}}}}(),function(){var e=n.Common.b2Settings,t=n.Common.Math.b2Mat22,r=n.Common.Math.b2Mat33,i=n.Common.Math.b2Math,s=n.Common.Math.b2Vec2,o=n.Common.Math.b2Vec3,u=n.Dynamics.Joints.b2DistanceJoint,a=n.Dynamics.Joints.b2DistanceJointDef,f=n.Dynamics.Joints.b2FrictionJoint,l=n.Dynamics.Joints.b2FrictionJointDef,c=n.Dynamics.Joints.b2GearJoint,h=n.Dynamics.Joints.b2GearJointDef,p=n.Dynamics.Joints.b2Jacobian,d=n.Dynamics.Joints.b2Joint,v=n.Dynamics.Joints.b2JointDef,m=n.Dynamics.Joints.b2JointEdge,g=n.Dynamics.Joints.b2LineJoint,y=n.Dynamics.Joints.b2LineJointDef,b=n.Dynamics.Joints.b2MouseJoint,w=n.Dynamics.Joints.b2MouseJointDef,E=n.Dynamics.Joints.b2PrismaticJoint,S=n.Dynamics.Joints.b2PrismaticJointDef,x=n.Dynamics.Joints.b2PulleyJoint,T=n.Dynamics.Joints.b2PulleyJointDef,N=n.Dynamics.Joints.b2RevoluteJoint,C=n.Dynamics.Joints.b2RevoluteJointDef,k=n.Dynamics.Joints.b2WeldJoint,L=n.Dynamics.Joints.b2WeldJointDef;n.inherit(u,n.Dynamics.Joints.b2Joint),u.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,u.b2DistanceJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_u=new s},u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},u.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},u.prototype.GetReactionTorque=function(){return 0},u.prototype.GetLength=function(){return this.m_length},u.prototype.SetLength=function(e){e===undefined&&(e=0),this.m_length=e},u.prototype.GetFrequency=function(){return this.m_frequencyHz},u.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},u.prototype.GetDampingRatio=function(){return this.m_dampingRatio},u.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},u.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},u.prototype.InitVelocityConstraints=function(t){var n,r=0,i=this.m_bodyA,s=this.m_bodyB;n=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,u=this.m_localAnchor1.y-i.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=r,n=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,f=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*f,f=n.col1.y*a+n.col2.y*f,a=r,this.m_u.x=s.m_sweep.c.x+a-i.m_sweep.c.x-o,this.m_u.y=s.m_sweep.c.y+f-i.m_sweep.c.y-u,r=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),r>e.b2_linearSlop?this.m_u.Multiply(1/r):this.m_u.SetZero(),n=o*this.m_u.y-u*this.m_u.x;var l=a*this.m_u.y-f*this.m_u.x;n=i.m_invMass+i.m_invI*n*n+s.m_invMass+s.m_invI*l*l,this.m_mass=n!=0?1/n:0;if(this.m_frequencyHz>0){r-=this.m_length,l=2*Math.PI*this.m_frequencyHz;var c=this.m_mass*l*l;this.m_gamma=t.dt*(2*this.m_mass*this.m_dampingRatio*l+t.dt*c),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=r*t.dt*c*this.m_gamma,this.m_mass=n+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}t.warmStarting?(this.m_impulse*=t.dtRatio,t=this.m_impulse*this.m_u.x,n=this.m_impulse*this.m_u.y,i.m_linearVelocity.x-=i.m_invMass*t,i.m_linearVelocity.y-=i.m_invMass*n,i.m_angularVelocity-=i.m_invI*(o*n-u*t),s.m_linearVelocity.x+=s.m_invMass*t,s.m_linearVelocity.y+=s.m_invMass*n,s.m_angularVelocity+=s.m_invI*(a*n-f*t)):this.m_impulse=0},u.prototype.SolveVelocityConstraints=function(){var e,t=this.m_bodyA,n=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=-this.m_mass*(this.m_u.x*(n.m_linearVelocity.x+ -n.m_angularVelocity*u-(t.m_linearVelocity.x+ -t.m_angularVelocity*i))+this.m_u.y*(n.m_linearVelocity.y+n.m_angularVelocity*o-(t.m_linearVelocity.y+t.m_angularVelocity*r))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=s,e=s*this.m_u.x,s*=this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*e,t.m_linearVelocity.y-=t.m_invMass*s,t.m_angularVelocity-=t.m_invI*(r*s-i*e),n.m_linearVelocity.x+=n.m_invMass*e,n.m_linearVelocity.y+=n.m_invMass*s,n.m_angularVelocity+=n.m_invI*(o*s-u*e)},u.prototype.SolvePositionConstraints=function(){var t;if(this.m_frequencyHz>0)return!0;var n=this.m_bodyA,r=this.m_bodyB;t=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=t.col1.x*s+t.col2.x*o;o=t.col1.y*s+t.col2.y*o,s=u,t=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=t.col1.x*a+t.col2.x*f,f=t.col1.y*a+t.col2.y*f,a=u,u=r.m_sweep.c.x+a-n.m_sweep.c.x-s;var l=r.m_sweep.c.y+f-n.m_sweep.c.y-o;t=Math.sqrt(u*u+l*l),u/=t,l/=t,t-=this.m_length,t=i.Clamp(t,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection);var c=-this.m_mass*t;return this.m_u.Set(u,l),u=c*this.m_u.x,l=c*this.m_u.y,n.m_sweep.c.x-=n.m_invMass*u,n.m_sweep.c.y-=n.m_invMass*l,n.m_sweep.a-=n.m_invI*(s*l-o*u),r.m_sweep.c.x+=r.m_invMass*u,r.m_sweep.c.y+=r.m_invMass*l,r.m_sweep.a+=r.m_invI*(a*l-f*u),n.SynchronizeTransform(),r.SynchronizeTransform(),i.Abs(t)<e.b2_linearSlop},n.inherit(a,n.Dynamics.Joints.b2JointDef),a.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,a.b2DistanceJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},a.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},a.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r)),e=r.x-n.x,n=r.y-n.y,this.length=Math.sqrt(e*e+n*n),this.dampingRatio=this.frequencyHz=0},n.inherit(f,n.Dynamics.Joints.b2Joint),f.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,f.b2FrictionJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new s,this.m_localAnchorB=new s,this.m_linearMass=new t,this.m_linearImpulse=new s},f.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},f.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},f.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},f.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_angularImpulse},f.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},f.prototype.GetMaxForce=function(){return this.m_maxForce},f.prototype.SetMaxTorque=function(e){e===undefined&&(e=0),this.m_maxTorque=e},f.prototype.GetMaxTorque=function(){return this.m_maxTorque},f.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},f.prototype.InitVelocityConstraints=function(e){var n,r=0,i=this.m_bodyA,s=this.m_bodyB;n=i.m_xf.R;var o=this.m_localAnchorA.x-i.m_sweep.localCenter.x,u=this.m_localAnchorA.y-i.m_sweep.localCenter.y;r=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=r,n=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,f=this.m_localAnchorB.y-s.m_sweep.localCenter.y;r=n.col1.x*a+n.col2.x*f,f=n.col1.y*a+n.col2.y*f,a=r,n=i.m_invMass,r=s.m_invMass;var l=i.m_invI,c=s.m_invI,h=new t;h.col1.x=n+r,h.col2.x=0,h.col1.y=0,h.col2.y=n+r,h.col1.x+=l*u*u,h.col2.x+=-l*o*u,h.col1.y+=-l*o*u,h.col2.y+=l*o*o,h.col1.x+=c*f*f,h.col2.x+=-c*a*f,h.col1.y+=-c*a*f,h.col2.y+=c*a*a,h.GetInverse(this.m_linearMass),this.m_angularMass=l+c,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting?(this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio,e=this.m_linearImpulse,i.m_linearVelocity.x-=n*e.x,i.m_linearVelocity.y-=n*e.y,i.m_angularVelocity-=l*(o*e.y-u*e.x+this.m_angularImpulse),s.m_linearVelocity.x+=r*e.x,s.m_linearVelocity.y+=r*e.y,s.m_angularVelocity+=c*(a*e.y-f*e.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},f.prototype.SolveVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,o=this.m_bodyB,u=r.m_linearVelocity,a=r.m_angularVelocity,f=o.m_linearVelocity,l=o.m_angularVelocity,c=r.m_invMass,h=o.m_invMass,p=r.m_invI,d=o.m_invI;t=r.m_xf.R;var v=this.m_localAnchorA.x-r.m_sweep.localCenter.x,m=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n,t=o.m_xf.R;var g=this.m_localAnchorB.x-o.m_sweep.localCenter.x,y=this.m_localAnchorB.y-o.m_sweep.localCenter.y;n=t.col1.x*g+t.col2.x*y,y=t.col1.y*g+t.col2.y*y,g=n,t=0,n=-this.m_angularMass*(l-a);var b=this.m_angularImpulse;t=e.dt*this.m_maxTorque,this.m_angularImpulse=i.Clamp(this.m_angularImpulse+n,-t,t),n=this.m_angularImpulse-b,a-=p*n,l+=d*n,t=i.MulMV(this.m_linearMass,new s(-(f.x-l*y-u.x+a*m),-(f.y+l*g-u.y-a*v))),n=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(t),t=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),t=i.SubtractVV(this.m_linearImpulse,n),u.x-=c*t.x,u.y-=c*t.y,a-=p*(v*t.y-m*t.x),f.x+=h*t.x,f.y+=h*t.y,l+=d*(g*t.y-y*t.x),r.m_angularVelocity=a,o.m_angularVelocity=l},f.prototype.SolvePositionConstraints=function(){return!0},n.inherit(l,n.Dynamics.Joints.b2JointDef),l.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,l.b2FrictionJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},l.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_frictionJoint,this.maxTorque=this.maxForce=0},l.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},n.inherit(c,n.Dynamics.Joints.b2Joint),c.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,c.b2GearJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new s,this.m_groundAnchor2=new s,this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_J=new p},c.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},c.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},c.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},c.prototype.GetReactionTorque=function(e){e===undefined&&(e=0);var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r;return r=t.col1.y*n+t.col2.y*r,n=i,e*(this.m_impulse*this.m_J.angularB-n*this.m_impulse*this.m_J.linearB.y+r*this.m_impulse*this.m_J.linearB.x)},c.prototype.GetRatio=function(){return this.m_ratio},c.prototype.SetRatio=function(e){e===undefined&&(e=0),this.m_ratio=e},c.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type),n=parseInt(e.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var r=0,i=0;this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==d.e_revoluteJoint?(this.m_revolute1=e.joint1 instanceof N?e.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),r=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1 instanceof E?e.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),r=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==d.e_revoluteJoint?(this.m_revolute2=e.joint2 instanceof N?e.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),i=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2 instanceof E?e.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),i=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=r+this.m_ratio*i,this.m_impulse=0},c.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s=0,o=0,u=0,a=0,f=u=0,l=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,l+=r.m_invI):(t=t.m_xf.R,o=this.m_prismatic1.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=r.m_xf.R,u=this.m_localAnchor1.x-r.m_sweep.localCenter.x,a=this.m_localAnchor1.y-r.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f,u=u*o-a*s,this.m_J.linearA.Set(-s,-o),this.m_J.angularA=-u,l+=r.m_invMass+r.m_invI*u*u),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*i.m_invI):(t=n.m_xf.R,o=this.m_prismatic2.m_localXAxis1,s=t.col1.x*o.x+t.col2.x*o.y,o=t.col1.y*o.x+t.col2.y*o.y,t=i.m_xf.R,u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,f=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=f,u=u*o-a*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*o),this.m_J.angularB=-this.m_ratio*u,l+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*u*u)),this.m_mass=l>0?1/l:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},c.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity);this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularA,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularB},c.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,n=this.m_bodyB,r=0,i=0;return r=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),i=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),r=-this.m_mass*(this.m_constant-(r+this.m_ratio*i)),t.m_sweep.c.x+=t.m_invMass*r*this.m_J.linearA.x,t.m_sweep.c.y+=t.m_invMass*r*this.m_J.linearA.y,t.m_sweep.a+=t.m_invI*r*this.m_J.angularA,n.m_sweep.c.x+=n.m_invMass*r*this.m_J.linearB.x,n.m_sweep.c.y+=n.m_invMass*r*this.m_J.linearB.y,n.m_sweep.a+=n.m_invI*r*this.m_J.angularB,t.SynchronizeTransform(),n.SynchronizeTransform(),0<e.b2_linearSlop},n.inherit(h,n.Dynamics.Joints.b2JointDef),h.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,h.b2GearJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},h.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},p.b2Jacobian=function(){this.linearA=new s,this.linearB=new s},p.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},p.prototype.Set=function(e,t,n,r){t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},p.prototype.Compute=function(e,t,n,r){return t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},d.b2Joint=function(){this.m_edgeA=new m,this.m_edgeB=new m,this.m_localCenterA=new s,this.m_localCenterB=new s},d.prototype.GetType=function(){return this.m_type},d.prototype.GetAnchorA=function(){return null},d.prototype.GetAnchorB=function(){return null},d.prototype.GetReactionForce=function(){return null},d.prototype.GetReactionTorque=function(){return 0},d.prototype.GetBodyA=function(){return this.m_bodyA},d.prototype.GetBodyB=function(){return this.m_bodyB},d.prototype.GetNext=function(){return this.m_next},d.prototype.GetUserData=function(){return this.m_userData},d.prototype.SetUserData=function(e){this.m_userData=e},d.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},d.Create=function(e){var t=null;switch(e.type){case d.e_distanceJoint:t=new u(e instanceof a?e:null);break;case d.e_mouseJoint:t=new b(e instanceof w?e:null);break;case d.e_prismaticJoint:t=new E(e instanceof S?e:null);break;case d.e_revoluteJoint:t=new N(e instanceof C?e:null);break;case d.e_pulleyJoint:t=new x(e instanceof T?e:null);break;case d.e_gearJoint:t=new c(e instanceof h?e:null);break;case d.e_lineJoint:t=new g(e instanceof y?e:null);break;case d.e_weldJoint:t=new k(e instanceof L?e:null);break;case d.e_frictionJoint:t=new f(e instanceof l?e:null)}return t},d.Destroy=function(){},d.prototype.b2Joint=function(t){e.b2Assert(t.bodyA!=t.bodyB),this.m_type=t.type,this.m_next=this.m_prev=null,this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData},d.prototype.InitVelocityConstraints=function(){},d.prototype.SolveVelocityConstraints=function(){},d.prototype.FinalizeVelocityConstraints=function(){},d.prototype.SolvePositionConstraints=function(){return!1},n.postDefs.push(function(){n.Dynamics.Joints.b2Joint.e_unknownJoint=0,n.Dynamics.Joints.b2Joint.e_revoluteJoint=1,n.Dynamics.Joints.b2Joint.e_prismaticJoint=2,n.Dynamics.Joints.b2Joint.e_distanceJoint=3,n.Dynamics.Joints.b2Joint.e_pulleyJoint=4,n.Dynamics.Joints.b2Joint.e_mouseJoint=5,n.Dynamics.Joints.b2Joint.e_gearJoint=6,n.Dynamics.Joints.b2Joint.e_lineJoint=7,n.Dynamics.Joints.b2Joint.e_weldJoint=8,n.Dynamics.Joints.b2Joint.e_frictionJoint=9,n.Dynamics.Joints.b2Joint.e_inactiveLimit=0,n.Dynamics.Joints.b2Joint.e_atLowerLimit=1,n.Dynamics.Joints.b2Joint.e_atUpperLimit=2,n.Dynamics.Joints.b2Joint.e_equalLimits=3}),v.b2JointDef=function(){},v.prototype.b2JointDef=function(){this.type=d.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},m.b2JointEdge=function(){},n.inherit(g,n.Dynamics.Joints.b2Joint),g.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,g.b2LineJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_localXAxis1=new s,this.m_localYAxis1=new s,this.m_axis=new s,this.m_perp=new s,this.m_K=new t,this.m_impulse=new s},g.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},g.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},g.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},g.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},g.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},g.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},g.prototype.IsLimitEnabled=function(){return this.m_enableLimit},g.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},g.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},g.prototype.GetUpperLimit=function(){return this.m_upperTranslation},g.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},g.prototype.IsMotorEnabled=function(){return this.m_enableMotor},g.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},g.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},g.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},g.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},g.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},g.prototype.GetMotorForce=function(){return this.m_motorImpulse},g.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=d.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},g.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,r=this.m_bodyB,s,o=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(r.GetLocalCenter());var u=n.GetTransform();r.GetTransform(),s=n.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y;o=s.col1.x*a+s.col2.x*f,f=s.col1.y*a+s.col2.y*f,a=o,s=r.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*l+s.col2.x*c,c=s.col1.y*l+s.col2.y*c,l=o,s=r.m_sweep.c.x+l-n.m_sweep.c.x-a,o=r.m_sweep.c.y+c-n.m_sweep.c.y-f,this.m_invMassA=n.m_invMass,this.m_invMassB=r.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=r.m_invI,this.m_axis.SetV(i.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(s+a)*this.m_axis.y-(o+f)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(i.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(s+a)*this.m_perp.y-(o+f)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x,u=this.m_invMassA,a=this.m_invMassB,f=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=u+a+f*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+a+f*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(s=this.m_axis.x*s+this.m_axis.y*o,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?this.m_limitState=d.e_equalLimits:s<=this.m_lowerTranslation?this.m_limitState!=d.e_atLowerLimit&&(this.m_limitState=d.e_atLowerLimit,this.m_impulse.y=0):s>=this.m_upperTranslation?this.m_limitState!=d.e_atUpperLimit&&(this.m_limitState=d.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=d.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=d.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,o=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,u=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,n.m_linearVelocity.x-=this.m_invMassA*t,n.m_linearVelocity.y-=this.m_invMassA*s,n.m_angularVelocity-=this.m_invIA*o,r.m_linearVelocity.x+=this.m_invMassB*t,r.m_linearVelocity.y+=this.m_invMassB*s,r.m_angularVelocity+=this.m_invIB*u):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},g.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,o=t.m_angularVelocity,u=n.m_linearVelocity,a=n.m_angularVelocity,f=0,l=0,c=0,h=0;this.m_enableMotor&&this.m_limitState!=d.e_equalLimits&&(h=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(u.x-r.x)+this.m_axis.y*(u.y-r.y)+this.m_a2*a-this.m_a1*o)),f=this.m_motorImpulse,l=e.dt*this.m_maxMotorForce,this.m_motorImpulse=i.Clamp(this.m_motorImpulse+h,-l,l),h=this.m_motorImpulse-f,f=h*this.m_axis.x,l=h*this.m_axis.y,c=h*this.m_a1,h*=this.m_a2,r.x-=this.m_invMassA*f,r.y-=this.m_invMassA*l,o-=this.m_invIA*c,u.x+=this.m_invMassB*f,u.y+=this.m_invMassB*l,a+=this.m_invIB*h),l=this.m_perp.x*(u.x-r.x)+this.m_perp.y*(u.y-r.y)+this.m_s2*a-this.m_s1*o,this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit?(c=this.m_axis.x*(u.x-r.x)+this.m_axis.y*(u.y-r.y)+this.m_a2*a-this.m_a1*o,f=this.m_impulse.Copy(),e=this.m_K.Solve(new s,-l,-c),this.m_impulse.Add(e),this.m_limitState==d.e_atLowerLimit?this.m_impulse.y=i.Max(this.m_impulse.y,0):this.m_limitState==d.e_atUpperLimit&&(this.m_impulse.y=i.Min(this.m_impulse.y,0)),l=-l-(this.m_impulse.y-f.y)*this.m_K.col2.x,c=0,c=this.m_K.col1.x!=0?l/this.m_K.col1.x+f.x:f.x,this.m_impulse.x=c,e.x=this.m_impulse.x-f.x,e.y=this.m_impulse.y-f.y,f=e.x*this.m_perp.x+e.y*this.m_axis.x,l=e.x*this.m_perp.y+e.y*this.m_axis.y,c=e.x*this.m_s1+e.y*this.m_a1,h=e.x*this.m_s2+e.y*this.m_a2):(e=0,e=this.m_K.col1.x!=0?-l/this.m_K.col1.x:0,this.m_impulse.x+=e,f=e*this.m_perp.x,l=e*this.m_perp.y,c=e*this.m_s1,h=e*this.m_s2),r.x-=this.m_invMassA*f,r.y-=this.m_invMassA*l,o-=this.m_invIA*c,u.x+=this.m_invMassB*f,u.y+=this.m_invMassB*l,a+=this.m_invIB*h,t.m_linearVelocity.SetV(r),t.m_angularVelocity=o,n.m_linearVelocity.SetV(u),n.m_angularVelocity=a},g.prototype.SolvePositionConstraints=function(){var n=this.m_bodyA,r=this.m_bodyB,o=n.m_sweep.c,u=n.m_sweep.a,a=r.m_sweep.c,f=r.m_sweep.a,l,c=0,h=0,p=0,d=0,v=l=0,m=0;h=!1;var g=0,y=t.FromAngle(u);p=t.FromAngle(f),l=y,m=this.m_localAnchor1.x-this.m_localCenterA.x;var b=this.m_localAnchor1.y-this.m_localCenterA.y;c=l.col1.x*m+l.col2.x*b,b=l.col1.y*m+l.col2.y*b,m=c,l=p,p=this.m_localAnchor2.x-this.m_localCenterB.x,d=this.m_localAnchor2.y-this.m_localCenterB.y,c=l.col1.x*p+l.col2.x*d,d=l.col1.y*p+l.col2.y*d,p=c,l=a.x+p-o.x-m,c=a.y+d-o.y-b;if(this.m_enableLimit){this.m_axis=i.MulMV(y,this.m_localXAxis1),this.m_a1=(l+m)*this.m_axis.y-(c+b)*this.m_axis.x,this.m_a2=p*this.m_axis.y-d*this.m_axis.x;var w=this.m_axis.x*l+this.m_axis.y*c;i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?(g=i.Clamp(w,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection),v=i.Abs(w),h=!0):w<=this.m_lowerTranslation?(g=i.Clamp(w-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-w,h=!0):w>=this.m_upperTranslation&&(g=i.Clamp(w-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection),v=w-this.m_upperTranslation,h=!0)}return this.m_perp=i.MulMV(y,this.m_localYAxis1),this.m_s1=(l+m)*this.m_perp.y-(c+b)*this.m_perp.x,this.m_s2=p*this.m_perp.y-d*this.m_perp.x,y=new s,b=this.m_perp.x*l+this.m_perp.y*c,v=i.Max(v,i.Abs(b)),m=0,h?(h=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=h+p+d*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=d*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=h+p+d*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_K.Solve(y,-b,-g)):(h=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,l=this.m_invIB,g=h+p+d*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,h=0,h=g!=0?-b/g:0,y.x=h,y.y=0),g=y.x*this.m_perp.x+y.y*this.m_axis.x,h=y.x*this.m_perp.y+y.y*this.m_axis.y,b=y.x*this.m_s1+y.y*this.m_a1,y=y.x*this.m_s2+y.y*this.m_a2,o.x-=this.m_invMassA*g,o.y-=this.m_invMassA*h,u-=this.m_invIA*b,a.x+=this.m_invMassB*g,a.y+=this.m_invMassB*h,f+=this.m_invIB*y,n.m_sweep.a=u,r.m_sweep.a=f,n.SynchronizeTransform(),r.SynchronizeTransform(),v<=e.b2_linearSlop&&m<=e.b2_angularSlop},n.inherit(y,n.Dynamics.Joints.b2JointDef),y.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,y.b2LineJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s,this.localAxisA=new s},y.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},y.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},n.inherit(b,n.Dynamics.Joints.b2Joint),b.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,b.b2MouseJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.m_localAnchor=new s,this.m_target=new s,this.m_impulse=new s,this.m_mass=new t,this.m_C=new s},b.prototype.GetAnchorA=function(){return this.m_target},b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*this.m_impulse.x,e*this.m_impulse.y)},b.prototype.GetReactionTorque=function(){return 0},b.prototype.GetTarget=function(){return this.m_target},b.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=e},b.prototype.GetMaxForce=function(){return this.m_maxForce},b.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},b.prototype.GetFrequency=function(){return this.m_frequencyHz},b.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},b.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},b.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_gamma=this.m_beta=0},b.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=n*r*r;this.m_gamma=e.dt*(2*n*this.m_dampingRatio*r+e.dt*i),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=e.dt*i*this.m_gamma,i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,r=this.m_localAnchor.y-t.m_sweep.localCenter.y;var s=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r,n=s,i=t.m_invMass,s=t.m_invI,this.K1.col1.x=i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i,this.K2.col1.x=s*r*r,this.K2.col2.x=-s*n*r,this.K2.col1.y=-s*n*r,this.K2.col2.y=s*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+n-this.m_target.x,this.m_C.y=t.m_sweep.c.y+r-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=i*this.m_impulse.x,t.m_linearVelocity.y+=i*this.m_impulse.y,t.m_angularVelocity+=s*(n*this.m_impulse.y-r*this.m_impulse.x)},b.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r=0,i=0;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r,r=t.m_linearVelocity.x+ -t.m_angularVelocity*o;var u=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=u+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,u=-(n.col1.x*r+n.col2.x*i),i=-(n.col1.y*r+n.col2.y*i),n=this.m_impulse.x,r=this.m_impulse.y,this.m_impulse.x+=u,this.m_impulse.y+=i,e=e.dt*this.m_maxForce,this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length()),u=this.m_impulse.x-n,i=this.m_impulse.y-r,t.m_linearVelocity.x+=t.m_invMass*u,t.m_linearVelocity.y+=t.m_invMass*i,t.m_angularVelocity+=t.m_invI*(s*i-o*u)},b.prototype.SolvePositionConstraints=function(){return!0},n.inherit(w,n.Dynamics.Joints.b2JointDef),w.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,w.b2MouseJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new s},w.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},n.inherit(E,n.Dynamics.Joints.b2Joint),E.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,E.b2PrismaticJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_localXAxis1=new s,this.m_localYAxis1=new s,this.m_axis=new s,this.m_perp=new s,this.m_K=new r,this.m_impulse=new o},E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},E.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},E.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},E.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},E.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},E.prototype.IsLimitEnabled=function(){return this.m_enableLimit},E.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},E.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},E.prototype.GetUpperLimit=function(){return this.m_upperTranslation},E.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},E.prototype.IsMotorEnabled=function(){return this.m_enableMotor},E.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},E.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},E.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},E.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},E.prototype.GetMotorForce=function(){return this.m_motorImpulse},E.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=d.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},E.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,r=this.m_bodyB,s,o=0;this.m_localCenterA.SetV(n.GetLocalCenter()),this.m_localCenterB.SetV(r.GetLocalCenter());var u=n.GetTransform();r.GetTransform(),s=n.m_xf.R;var a=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y;o=s.col1.x*a+s.col2.x*f,f=s.col1.y*a+s.col2.y*f,a=o,s=r.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,c=this.m_localAnchor2.y-this.m_localCenterB.y;o=s.col1.x*l+s.col2.x*c,c=s.col1.y*l+s.col2.y*c,l=o,s=r.m_sweep.c.x+l-n.m_sweep.c.x-a,o=r.m_sweep.c.y+c-n.m_sweep.c.y-f,this.m_invMassA=n.m_invMass,this.m_invMassB=r.m_invMass,this.m_invIA=n.m_invI,this.m_invIB=r.m_invI,this.m_axis.SetV(i.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(s+a)*this.m_axis.y-(o+f)*this.m_axis.x,this.m_a2=l*this.m_axis.y-c*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(i.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(s+a)*this.m_perp.y-(o+f)*this.m_perp.x,this.m_s2=l*this.m_perp.y-c*this.m_perp.x,u=this.m_invMassA,a=this.m_invMassB,f=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=u+a+f*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=f*this.m_s1+l*this.m_s2,this.m_K.col1.z=f*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=f+l,this.m_K.col2.z=f*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=u+a+f*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_enableLimit?(s=this.m_axis.x*s+this.m_axis.y*o,i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?this.m_limitState=d.e_equalLimits:s<=this.m_lowerTranslation?this.m_limitState!=d.e_atLowerLimit&&(this.m_limitState=d.e_atLowerLimit,this.m_impulse.z=0):s>=this.m_upperTranslation?this.m_limitState!=d.e_atUpperLimit&&(this.m_limitState=d.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=d.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=d.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,s=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,o=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,u=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,n.m_linearVelocity.x-=this.m_invMassA*t,n.m_linearVelocity.y-=this.m_invMassA*s,n.m_angularVelocity-=this.m_invIA*o,r.m_linearVelocity.x+=this.m_invMassB*t,r.m_linearVelocity.y+=this.m_invMassB*s,r.m_angularVelocity+=this.m_invIB*u):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},E.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,u=t.m_angularVelocity,a=n.m_linearVelocity,f=n.m_angularVelocity,l=0,c=0,h=0,p=0;this.m_enableMotor&&this.m_limitState!=d.e_equalLimits&&(p=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(a.x-r.x)+this.m_axis.y*(a.y-r.y)+this.m_a2*f-this.m_a1*u)),l=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=i.Clamp(this.m_motorImpulse+p,-e,e),p=this.m_motorImpulse-l,l=p*this.m_axis.x,c=p*this.m_axis.y,h=p*this.m_a1,p*=this.m_a2,r.x-=this.m_invMassA*l,r.y-=this.m_invMassA*c,u-=this.m_invIA*h,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,f+=this.m_invIB*p),h=this.m_perp.x*(a.x-r.x)+this.m_perp.y*(a.y-r.y)+this.m_s2*f-this.m_s1*u,c=f-u,this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit?(e=this.m_axis.x*(a.x-r.x)+this.m_axis.y*(a.y-r.y)+this.m_a2*f-this.m_a1*u,l=this.m_impulse.Copy(),e=this.m_K.Solve33(new o,-h,-c,-e),this.m_impulse.Add(e),this.m_limitState==d.e_atLowerLimit?this.m_impulse.z=i.Max(this.m_impulse.z,0):this.m_limitState==d.e_atUpperLimit&&(this.m_impulse.z=i.Min(this.m_impulse.z,0)),h=-h-(this.m_impulse.z-l.z)*this.m_K.col3.x,c=-c-(this.m_impulse.z-l.z)*this.m_K.col3.y,c=this.m_K.Solve22(new s,h,c),c.x+=l.x,c.y+=l.y,this.m_impulse.x=c.x,this.m_impulse.y=c.y,e.x=this.m_impulse.x-l.x,e.y=this.m_impulse.y-l.y,e.z=this.m_impulse.z-l.z,l=e.x*this.m_perp.x+e.z*this.m_axis.x,c=e.x*this.m_perp.y+e.z*this.m_axis.y,h=e.x*this.m_s1+e.y+e.z*this.m_a1,p=e.x*this.m_s2+e.y+e.z*this.m_a2):(e=this.m_K.Solve22(new s,-h,-c),this.m_impulse.x+=e.x,this.m_impulse.y+=e.y,l=e.x*this.m_perp.x,c=e.x*this.m_perp.y,h=e.x*this.m_s1+e.y,p=e.x*this.m_s2+e.y),r.x-=this.m_invMassA*l,r.y-=this.m_invMassA*c,u-=this.m_invIA*h,a.x+=this.m_invMassB*l,a.y+=this.m_invMassB*c,f+=this.m_invIB*p,t.m_linearVelocity.SetV(r),t.m_angularVelocity=u,n.m_linearVelocity.SetV(a),n.m_angularVelocity=f},E.prototype.SolvePositionConstraints=function(){var n=this.m_bodyA,r=this.m_bodyB,u=n.m_sweep.c,a=n.m_sweep.a,f=r.m_sweep.c,l=r.m_sweep.a,c,h=0,p=0,d=0,v=h=c=0,m=0;p=!1;var g=0,y=t.FromAngle(a),b=t.FromAngle(l);c=y,m=this.m_localAnchor1.x-this.m_localCenterA.x;var w=this.m_localAnchor1.y-this.m_localCenterA.y;h=c.col1.x*m+c.col2.x*w,w=c.col1.y*m+c.col2.y*w,m=h,c=b,b=this.m_localAnchor2.x-this.m_localCenterB.x,d=this.m_localAnchor2.y-this.m_localCenterB.y,h=c.col1.x*b+c.col2.x*d,d=c.col1.y*b+c.col2.y*d,b=h,c=f.x+b-u.x-m,h=f.y+d-u.y-w;if(this.m_enableLimit){this.m_axis=i.MulMV(y,this.m_localXAxis1),this.m_a1=(c+m)*this.m_axis.y-(h+w)*this.m_axis.x,this.m_a2=b*this.m_axis.y-d*this.m_axis.x;var E=this.m_axis.x*c+this.m_axis.y*h;i.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*e.b2_linearSlop?(g=i.Clamp(E,-e.b2_maxLinearCorrection,e.b2_maxLinearCorrection),v=i.Abs(E),p=!0):E<=this.m_lowerTranslation?(g=i.Clamp(E-this.m_lowerTranslation+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-E,p=!0):E>=this.m_upperTranslation&&(g=i.Clamp(E-this.m_upperTranslation+e.b2_linearSlop,0,e.b2_maxLinearCorrection),v=E-this.m_upperTranslation,p=!0)}return this.m_perp=i.MulMV(y,this.m_localYAxis1),this.m_s1=(c+m)*this.m_perp.y-(h+w)*this.m_perp.x,this.m_s2=b*this.m_perp.y-d*this.m_perp.x,y=new o,w=this.m_perp.x*c+this.m_perp.y*h,b=l-a-this.m_refAngle,v=i.Max(v,i.Abs(w)),m=i.Abs(b),p?(p=this.m_invMassA,d=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=p+d+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=c*this.m_s1+h*this.m_s2,this.m_K.col1.z=c*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=c+h,this.m_K.col2.z=c*this.m_a1+h*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=p+d+c*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_K.Solve33(y,-w,-b,-g)):(p=this.m_invMassA,d=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,g=c*this.m_s1+h*this.m_s2,E=c+h,this.m_K.col1.Set(p+d+c*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,g,0),this.m_K.col2.Set(g,E,0),g=this.m_K.Solve22(new s,-w,-b),y.x=g.x,y.y=g.y,y.z=0),g=y.x*this.m_perp.x+y.z*this.m_axis.x,p=y.x*this.m_perp.y+y.z*this.m_axis.y,w=y.x*this.m_s1+y.y+y.z*this.m_a1,y=y.x*this.m_s2+y.y+y.z*this.m_a2,u.x-=this.m_invMassA*g,u.y-=this.m_invMassA*p,a-=this.m_invIA*w,f.x+=this.m_invMassB*g,f.y+=this.m_invMassB*p,l+=this.m_invIB*y,n.m_sweep.a=a,r.m_sweep.a=l,n.SynchronizeTransform(),r.SynchronizeTransform(),v<=e.b2_linearSlop&&m<=e.b2_angularSlop},n.inherit(S,n.Dynamics.Joints.b2JointDef),S.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,S.b2PrismaticJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s,this.localAxisA=new s},S.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},S.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},n.inherit(x,n.Dynamics.Joints.b2Joint),x.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,x.b2PulleyJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new s,this.m_groundAnchor2=new s,this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_u1=new s,this.m_u2=new s},x.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},x.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},x.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},x.prototype.GetReactionTorque=function(){return 0},x.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},x.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},x.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(t*t+e*e)},x.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(t*t+e*e)},x.prototype.GetRatio=function(){return this.m_ratio},x.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=i.Min(e.maxLengthA,this.m_constant-this.m_ratio*x.b2_minPulleyLength),this.m_maxLength2=i.Min(e.maxLengthB,(this.m_constant-x.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},x.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,r=this.m_bodyB,i;i=n.m_xf.R;var s=this.m_localAnchor1.x-n.m_sweep.localCenter.x,o=this.m_localAnchor1.y-n.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=u,i=r.m_sweep.c.x+a,u=r.m_sweep.c.y+f;var l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,c=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(n.m_sweep.c.x+s-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),n.m_sweep.c.y+o-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(i-l,u-c),i=this.m_u1.Length(),u=this.m_u2.Length(),i>e.b2_linearSlop?this.m_u1.Multiply(1/i):this.m_u1.SetZero(),u>e.b2_linearSlop?this.m_u2.Multiply(1/u):this.m_u2.SetZero(),this.m_constant-i-this.m_ratio*u>0?(this.m_state=d.e_inactiveLimit,this.m_impulse=0):this.m_state=d.e_atUpperLimit,i<this.m_maxLength1?(this.m_limitState1=d.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=d.e_atUpperLimit,u<this.m_maxLength2?(this.m_limitState2=d.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=d.e_atUpperLimit,i=s*this.m_u1.y-o*this.m_u1.x,u=a*this.m_u2.y-f*this.m_u2.x,this.m_limitMass1=n.m_invMass+n.m_invI*i*i,this.m_limitMass2=r.m_invMass+r.m_invI*u*u,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,t.warmStarting?(this.m_impulse*=t.dtRatio,this.m_limitImpulse1*=t.dtRatio,this.m_limitImpulse2*=t.dtRatio,t=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,i=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,u=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*t,n.m_linearVelocity.y+=n.m_invMass*i,n.m_angularVelocity+=n.m_invI*(s*i-o*t),r.m_linearVelocity.x+=r.m_invMass*u,r.m_linearVelocity.y+=r.m_invMass*l,r.m_angularVelocity+=r.m_invI*(a*l-f*u)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},x.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,s=this.m_localAnchor1.y-e.m_sweep.localCenter.y,o=n.col1.x*r+n.col2.x*s;s=n.col1.y*r+n.col2.y*s,r=o,n=t.m_xf.R;var u=this.m_localAnchor2.x-t.m_sweep.localCenter.x,a=this.m_localAnchor2.y-t.m_sweep.localCenter.y;o=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=o;var f=o=n=0,l=0;n=l=n=l=f=o=n=0,this.m_state==d.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*s,o=e.m_linearVelocity.y+e.m_angularVelocity*r,f=t.m_linearVelocity.x+ -t.m_angularVelocity*a,l=t.m_linearVelocity.y+t.m_angularVelocity*u,n=-(this.m_u1.x*n+this.m_u1.y*o)-this.m_ratio*(this.m_u2.x*f+this.m_u2.y*l),l=this.m_pulleyMass*-n,n=this.m_impulse,this.m_impulse=i.Max(0,this.m_impulse+l),l=this.m_impulse-n,n=-l*this.m_u1.x,o=-l*this.m_u1.y,f=-this.m_ratio*l*this.m_u2.x,l=-this.m_ratio*l*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*o,e.m_angularVelocity+=e.m_invI*(r*o-s*n),t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(u*l-a*f)),this.m_limitState1==d.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*s,o=e.m_linearVelocity.y+e.m_angularVelocity*r,n=-(this.m_u1.x*n+this.m_u1.y*o),l=-this.m_limitMass1*n,n=this.m_limitImpulse1,this.m_limitImpulse1=i.Max(0,this.m_limitImpulse1+l),l=this.m_limitImpulse1-n,n=-l*this.m_u1.x,o=-l*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*o,e.m_angularVelocity+=e.m_invI*(r*o-s*n)),this.m_limitState2==d.e_atUpperLimit&&(f=t.m_linearVelocity.x+ -t.m_angularVelocity*a,l=t.m_linearVelocity.y+t.m_angularVelocity*u,n=-(this.m_u2.x*f+this.m_u2.y*l),l=-this.m_limitMass2*n,n=this.m_limitImpulse2,this.m_limitImpulse2=i.Max(0,this.m_limitImpulse2+l),l=this.m_limitImpulse2-n,f=-l*this.m_u2.x,l=-l*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(u*l-a*f))},x.prototype.SolvePositionConstraints=function(){var t=this.m_bodyA,n=this.m_bodyB,r,s=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,u=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,a=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,f=0,l=0,c=0,h=0,p=r=0,v=0,m=0,g=p=m=r=p=r=0;return this.m_state==d.e_atUpperLimit&&(r=t.m_xf.R,f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,l=this.m_localAnchor1.y-t.m_sweep.localCenter.y,p=r.col1.x*f+r.col2.x*l,l=r.col1.y*f+r.col2.y*l,f=p,r=n.m_xf.R,c=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,p=r.col1.x*c+r.col2.x*h,h=r.col1.y*c+r.col2.y*h,c=p,r=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,v=n.m_sweep.c.x+c,m=n.m_sweep.c.y+h,this.m_u1.Set(r-s,p-o),this.m_u2.Set(v-u,m-a),r=this.m_u1.Length(),p=this.m_u2.Length(),r>e.b2_linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),p>e.b2_linearSlop?this.m_u2.Multiply(1/p):this.m_u2.SetZero(),r=this.m_constant-r-this.m_ratio*p,g=i.Max(g,-r),r=i.Clamp(r+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_pulleyMass*r,r=-m*this.m_u1.x,p=-m*this.m_u1.y,v=-this.m_ratio*m*this.m_u2.x,m=-this.m_ratio*m*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*r,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*r),n.m_sweep.c.x+=n.m_invMass*v,n.m_sweep.c.y+=n.m_invMass*m,n.m_sweep.a+=n.m_invI*(c*m-h*v),t.SynchronizeTransform(),n.SynchronizeTransform()),this.m_limitState1==d.e_atUpperLimit&&(r=t.m_xf.R,f=this.m_localAnchor1.x-t.m_sweep.localCenter.x,l=this.m_localAnchor1.y-t.m_sweep.localCenter.y,p=r.col1.x*f+r.col2.x*l,l=r.col1.y*f+r.col2.y*l,f=p,r=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,this.m_u1.Set(r-s,p-o),r=this.m_u1.Length(),r>e.b2_linearSlop?(this.m_u1.x*=1/r,this.m_u1.y*=1/r):this.m_u1.SetZero(),r=this.m_maxLength1-r,g=i.Max(g,-r),r=i.Clamp(r+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_limitMass1*r,r=-m*this.m_u1.x,p=-m*this.m_u1.y,t.m_sweep.c.x+=t.m_invMass*r,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*r),t.SynchronizeTransform()),this.m_limitState2==d.e_atUpperLimit&&(r=n.m_xf.R,c=this.m_localAnchor2.x-n.m_sweep.localCenter.x,h=this.m_localAnchor2.y-n.m_sweep.localCenter.y,p=r.col1.x*c+r.col2.x*h,h=r.col1.y*c+r.col2.y*h,c=p,v=n.m_sweep.c.x+c,m=n.m_sweep.c.y+h,this.m_u2.Set(v-u,m-a),p=this.m_u2.Length(),p>e.b2_linearSlop?(this.m_u2.x*=1/p,this.m_u2.y*=1/p):this.m_u2.SetZero(),r=this.m_maxLength2-p,g=i.Max(g,-r),r=i.Clamp(r+e.b2_linearSlop,-e.b2_maxLinearCorrection,0),m=-this.m_limitMass2*r,v=-m*this.m_u2.x,m=-m*this.m_u2.y,n.m_sweep.c.x+=n.m_invMass*v,n.m_sweep.c.y+=n.m_invMass*m,n.m_sweep.a+=n.m_invI*(c*m-h*v),n.SynchronizeTransform()),g<e.b2_linearSlop},n.postDefs.push(function(){n.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),n.inherit(T,n.Dynamics.Joints.b2JointDef),T.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,T.b2PulleyJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new s,this.groundAnchorB=new s,this.localAnchorA=new s,this.localAnchorB=new s},T.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},T.prototype.Initialize=function(e,t,n,r,i,s,o){o===undefined&&(o=0),this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s),e=i.x-n.x,n=i.y-n.y,this.lengthA=Math.sqrt(e*e+n*n),n=s.x-r.x,r=s.y-r.y,this.lengthB=Math.sqrt(n*n+r*r),this.ratio=o,o=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=o-this.ratio*x.b2_minPulleyLength,this.maxLengthB=(o-x.b2_minPulleyLength)/this.ratio},n.inherit(N,n.Dynamics.Joints.b2Joint),N.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,N.b2RevoluteJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new t,this.K1=new t,this.K2=new t,this.K3=new t,this.impulse3=new o,this.impulse2=new s,this.reduced=new s,this.m_localAnchor1=new s,this.m_localAnchor2=new s,this.m_impulse=new o,this.m_mass=new r},N.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},N.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},N.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*this.m_impulse.x,e*this.m_impulse.y)},N.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},N.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},N.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},N.prototype.IsLimitEnabled=function(){return this.m_enableLimit},N.prototype.EnableLimit=function(e){this.m_enableLimit=e},N.prototype.GetLowerLimit=function(){return this.m_lowerAngle},N.prototype.GetUpperLimit=function(){return this.m_upperAngle},N.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_lowerAngle=e,this.m_upperAngle=t},N.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},N.prototype.EnableMotor=function(e){this.m_enableMotor=e},N.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},N.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},N.prototype.SetMaxMotorTorque=function(e){e===undefined&&(e=0),this.m_maxMotorTorque=e},N.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},N.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=d.e_inactiveLimit},N.prototype.InitVelocityConstraints=function(t){var n=this.m_bodyA,r=this.m_bodyB,s,o=0;s=n.m_xf.R;var u=this.m_localAnchor1.x-n.m_sweep.localCenter.x,a=this.m_localAnchor1.y-n.m_sweep.localCenter.y;o=s.col1.x*u+s.col2.x*a,a=s.col1.y*u+s.col2.y*a,u=o,s=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;o=s.col1.x*f+s.col2.x*l,l=s.col1.y*f+s.col2.y*l,f=o,s=n.m_invMass,o=r.m_invMass;var c=n.m_invI,h=r.m_invI;this.m_mass.col1.x=s+o+a*a*c+l*l*h,this.m_mass.col2.x=-a*u*c-l*f*h,this.m_mass.col3.x=-a*c-l*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=s+o+u*u*c+f*f*h,this.m_mass.col3.y=u*c+f*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,this.m_motorMass=1/(c+h),this.m_enableMotor==0&&(this.m_motorImpulse=0);if(this.m_enableLimit){var p=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;i.Abs(this.m_upperAngle-this.m_lowerAngle)<2*e.b2_angularSlop?this.m_limitState=d.e_equalLimits:p<=this.m_lowerAngle?(this.m_limitState!=d.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=d.e_atLowerLimit):p>=this.m_upperAngle?(this.m_limitState!=d.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=d.e_atUpperLimit):(this.m_limitState=d.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=d.e_inactiveLimit;t.warmStarting?(this.m_impulse.x*=t.dtRatio,this.m_impulse.y*=t.dtRatio,this.m_motorImpulse*=t.dtRatio,t=this.m_impulse.x,p=this.m_impulse.y,n.m_linearVelocity.x-=s*t,n.m_linearVelocity.y-=s*p,n.m_angularVelocity-=c*(u*p-a*t+this.m_motorImpulse+this.m_impulse.z),r.m_linearVelocity.x+=o*t,r.m_linearVelocity.y+=o*p,r.m_angularVelocity+=h*(f*p-l*t+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},N.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=0,s=r=0,o=0,u=0,a=0,f=t.m_linearVelocity,l=t.m_angularVelocity,c=n.m_linearVelocity,h=n.m_angularVelocity,p=t.m_invMass,v=n.m_invMass,m=t.m_invI,g=n.m_invI;this.m_enableMotor&&this.m_limitState!=d.e_equalLimits&&(s=this.m_motorMass*-(h-l-this.m_motorSpeed),o=this.m_motorImpulse,u=e.dt*this.m_maxMotorTorque,this.m_motorImpulse=i.Clamp(this.m_motorImpulse+s,-u,u),s=this.m_motorImpulse-o,l-=m*s,h+=g*s);if(this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit){e=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=e.col1.x*s+e.col2.x*o,o=e.col1.y*s+e.col2.y*o,s=r,e=n.m_xf.R,u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y,r=e.col1.x*u+e.col2.x*a,a=e.col1.y*u+e.col2.y*a,u=r,e=c.x+ -h*a-f.x- -l*o;var y=c.y+h*u-f.y-l*s;this.m_mass.Solve33(this.impulse3,-e,-y,-(h-l)),this.m_limitState==d.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==d.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,r<0&&(this.m_mass.Solve22(this.reduced,-e,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==d.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,r>0&&(this.m_mass.Solve22(this.reduced,-e,-y),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),f.x-=p*this.impulse3.x,f.y-=p*this.impulse3.y,l-=m*(s*this.impulse3.y-o*this.impulse3.x+this.impulse3.z),c.x+=v*this.impulse3.x,c.y+=v*this.impulse3.y,h+=g*(u*this.impulse3.y-a*this.impulse3.x+this.impulse3.z)}else e=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,r=e.col1.x*s+e.col2.x*o,o=e.col1.y*s+e.col2.y*o,s=r,e=n.m_xf.R,u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y,r=e.col1.x*u+e.col2.x*a,a=e.col1.y*u+e.col2.y*a,u=r,this.m_mass.Solve22(this.impulse2,-(c.x+ -h*a-f.x- -l*o),-(c.y+h*u-f.y-l*s)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,f.x-=p*this.impulse2.x,f.y-=p*this.impulse2.y,l-=m*(s*this.impulse2.y-o*this.impulse2.x),c.x+=v*this.impulse2.x,c.y+=v*this.impulse2.y,h+=g*(u*this.impulse2.y-a*this.impulse2.x);t.m_linearVelocity.SetV(f),t.m_angularVelocity=l,n.m_linearVelocity.SetV(c),n.m_angularVelocity=h},N.prototype.SolvePositionConstraints=function(){var t=0,n,r=this.m_bodyA,s=this.m_bodyB,o=0,u=n=0,a=0,f=0;if(this.m_enableLimit&&this.m_limitState!=d.e_inactiveLimit){t=s.m_sweep.a-r.m_sweep.a-this.m_referenceAngle;var l=0;this.m_limitState==d.e_equalLimits?(t=i.Clamp(t-this.m_lowerAngle,-e.b2_maxAngularCorrection,e.b2_maxAngularCorrection),l=-this.m_motorMass*t,o=i.Abs(t)):this.m_limitState==d.e_atLowerLimit?(t-=this.m_lowerAngle,o=-t,t=i.Clamp(t+e.b2_angularSlop,-e.b2_maxAngularCorrection,0),l=-this.m_motorMass*t):this.m_limitState==d.e_atUpperLimit&&(o=t-=this.m_upperAngle,t=i.Clamp(t-e.b2_angularSlop,0,e.b2_maxAngularCorrection),l=-this.m_motorMass*t),r.m_sweep.a-=r.m_invI*l,s.m_sweep.a+=s.m_invI*l,r.SynchronizeTransform(),s.SynchronizeTransform()}n=r.m_xf.R,l=this.m_localAnchor1.x-r.m_sweep.localCenter.x,t=this.m_localAnchor1.y-r.m_sweep.localCenter.y,u=n.col1.x*l+n.col2.x*t,t=n.col1.y*l+n.col2.y*t,l=u,n=s.m_xf.R;var c=this.m_localAnchor2.x-s.m_sweep.localCenter.x,h=this.m_localAnchor2.y-s.m_sweep.localCenter.y;u=n.col1.x*c+n.col2.x*h,h=n.col1.y*c+n.col2.y*h,c=u,a=s.m_sweep.c.x+c-r.m_sweep.c.x-l,f=s.m_sweep.c.y+h-r.m_sweep.c.y-t;var p=a*a+f*f;n=Math.sqrt(p),u=r.m_invMass;var v=s.m_invMass,m=r.m_invI,g=s.m_invI,y=10*e.b2_linearSlop;return p>y*y&&(p=1/(u+v),a=p*-a,f=p*-f,r.m_sweep.c.x-=.5*u*a,r.m_sweep.c.y-=.5*u*f,s.m_sweep.c.x+=.5*v*a,s.m_sweep.c.y+=.5*v*f,a=s.m_sweep.c.x+c-r.m_sweep.c.x-l,f=s.m_sweep.c.y+h-r.m_sweep.c.y-t),this.K1.col1.x=u+v,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=u+v,this.K2.col1.x=m*t*t,this.K2.col2.x=-m*l*t,this.K2.col1.y=-m*l*t,this.K2.col2.y=m*l*l,this.K3.col1.x=g*h*h,this.K3.col2.x=-g*c*h,this.K3.col1.y=-g*c*h,this.K3.col2.y=g*c*c,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(N.tImpulse,-a,-f),a=N.tImpulse.x,f=N.tImpulse.y,r.m_sweep.c.x-=r.m_invMass*a,r.m_sweep.c.y-=r.m_invMass*f,r.m_sweep.a-=r.m_invI*(l*f-t*a),s.m_sweep.c.x+=s.m_invMass*a,s.m_sweep.c.y+=s.m_invMass*f,s.m_sweep.a+=s.m_invI*(c*f-h*a),r.SynchronizeTransform(),s.SynchronizeTransform(),n<=e.b2_linearSlop&&o<=e.b2_angularSlop},n.postDefs.push(function(){n.Dynamics.Joints.b2RevoluteJoint.tImpulse=new s}),n.inherit(C,n.Dynamics.Joints.b2JointDef),C.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,C.b2RevoluteJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},C.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},C.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},n.inherit(k,n.Dynamics.Joints.b2Joint),k.prototype.__super=n.Dynamics.Joints.b2Joint.prototype,k.b2WeldJoint=function(){n.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new s,this.m_localAnchorB=new s,this.m_impulse=new o,this.m_mass=new r},k.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},k.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},k.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new s(e*this.m_impulse.x,e*this.m_impulse.y)},k.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},k.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new r},k.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=r.m_invMass,n=i.m_invMass;var f=r.m_invI,l=i.m_invI;this.m_mass.col1.x=t+n+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=t*this.m_impulse.x,r.m_linearVelocity.y-=t*this.m_impulse.y,r.m_angularVelocity-=f*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=n*this.m_impulse.x,i.m_linearVelocity.y+=n*this.m_impulse.y,i.m_angularVelocity+=l*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},k.prototype.SolveVelocityConstraints=function(){var e,t=0,n=this.m_bodyA,r=this.m_bodyB,i=n.m_linearVelocity,s=n.m_angularVelocity,u=r.m_linearVelocity,a=r.m_angularVelocity,f=n.m_invMass,l=r.m_invMass,c=n.m_invI,h=r.m_invI;e=n.m_xf.R;var p=this.m_localAnchorA.x-n.m_sweep.localCenter.x,d=this.m_localAnchorA.y-n.m_sweep.localCenter.y;t=e.col1.x*p+e.col2.x*d,d=e.col1.y*p+e.col2.y*d,p=t,e=r.m_xf.R;var v=this.m_localAnchorB.x-r.m_sweep.localCenter.x,m=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*v+e.col2.x*m,m=e.col1.y*v+e.col2.y*m,v=t,e=u.x-a*m-i.x+s*d,t=u.y+a*v-i.y-s*p;var g=a-s,y=new o;this.m_mass.Solve33(y,-e,-t,-g),this.m_impulse.Add(y),i.x-=f*y.x,i.y-=f*y.y,s-=c*(p*y.y-d*y.x+y.z),u.x+=l*y.x,u.y+=l*y.y,a+=h*(v*y.y-m*y.x+y.z),n.m_angularVelocity=s,r.m_angularVelocity=a},k.prototype.SolvePositionConstraints=function(){var t,n=0,r=this.m_bodyA,s=this.m_bodyB;t=r.m_xf.R;var u=this.m_localAnchorA.x-r.m_sweep.localCenter.x,a=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=s.m_xf.R;var f=this.m_localAnchorB.x-s.m_sweep.localCenter.x,l=this.m_localAnchorB.y-s.m_sweep.localCenter.y;n=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=n,t=r.m_invMass,n=s.m_invMass;var c=r.m_invI,h=s.m_invI,p=s.m_sweep.c.x+f-r.m_sweep.c.x-u,d=s.m_sweep.c.y+l-r.m_sweep.c.y-a,v=s.m_sweep.a-r.m_sweep.a-this.m_referenceAngle,m=10*e.b2_linearSlop,g=Math.sqrt(p*p+d*d),y=i.Abs(v);return g>m&&(c*=1,h*=1),this.m_mass.col1.x=t+n+a*a*c+l*l*h,this.m_mass.col2.x=-a*u*c-l*f*h,this.m_mass.col3.x=-a*c-l*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+u*u*c+f*f*h,this.m_mass.col3.y=u*c+f*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,m=new o,this.m_mass.Solve33(m,-p,-d,-v),r.m_sweep.c.x-=t*m.x,r.m_sweep.c.y-=t*m.y,r.m_sweep.a-=c*(u*m.y-a*m.x+m.z),s.m_sweep.c.x+=n*m.x,s.m_sweep.c.y+=n*m.y,s.m_sweep.a+=h*(f*m.y-l*m.x+m.z),r.SynchronizeTransform(),s.SynchronizeTransform(),g<=e.b2_linearSlop&&y<=e.b2_angularSlop},n.inherit(L,n.Dynamics.Joints.b2JointDef),L.prototype.__super=n.Dynamics.Joints.b2JointDef.prototype,L.b2WeldJointDef=function(){n.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new s,this.localAnchorB=new s},L.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=d.e_weldJoint,this.referenceAngle=0},L.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var e=n.Dynamics.b2DebugDraw;e.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},e.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"},e.prototype.b2DebugDraw=function(){this.m_drawFlags=0},e.prototype.SetFlags=function(e){e===undefined&&(e=0),this.m_drawFlags=e},e.prototype.GetFlags=function(){return this.m_drawFlags},e.prototype.AppendFlags=function(e){e===undefined&&(e=0),this.m_drawFlags|=e},e.prototype.ClearFlags=function(e){e===undefined&&(e=0),this.m_drawFlags&=~e},e.prototype.SetSprite=function(e){this.m_ctx=e},e.prototype.GetSprite=function(){return this.m_ctx},e.prototype.SetDrawScale=function(e){e===undefined&&(e=0),this.m_drawScale=e},e.prototype.GetDrawScale=function(){return this.m_drawScale},e.prototype.SetLineThickness=function(e){e===undefined&&(e=0),this.m_lineThickness=e,this.m_ctx.strokeWidth=e},e.prototype.GetLineThickness=function(){return this.m_lineThickness},e.prototype.SetAlpha=function(e){e===undefined&&(e=0),this.m_alpha=e},e.prototype.GetAlpha=function(){return this.m_alpha},e.prototype.SetFillAlpha=function(e){e===undefined&&(e=0),this.m_fillAlpha=e},e.prototype.GetFillAlpha=function(){return this.m_fillAlpha},e.prototype.SetXFormScale=function(e){e===undefined&&(e=0),this.m_xformScale=e},e.prototype.GetXFormScale=function(){return this.m_xformScale},e.prototype.DrawPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.moveTo(e[0].x*i,e[0].y*i);for(n=1;n<t;n++)r.lineTo(e[n].x*i,e[n].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.stroke()}},e.prototype.DrawSolidPolygon=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.fillStyle=this._color(n.color,this.m_fillAlpha),r.moveTo(e[0].x*i,e[0].y*i);for(n=1;n<t;n++)r.lineTo(e[n].x*i,e[n].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.fill(),r.stroke()}},e.prototype.DrawCircle=function(e,t,n){if(t){var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.arc(e.x*i,e.y*i,t*i,0,Math.PI*2,!0),r.closePath(),r.stroke()}},e.prototype.DrawSolidCircle=function(e,t,n,r){if(t){var i=this.m_ctx,s=this.m_drawScale,o=e.x*s,u=e.y*s;i.moveTo(0,0),i.beginPath(),i.strokeStyle=this._color(r.color,this.m_alpha),i.fillStyle=this._color(r.color,this.m_fillAlpha),i.arc(o,u,t*s,0,Math.PI*2,!0),i.moveTo(o,u),i.lineTo((e.x+n.x*t)*s,(e.y+n.y*t)*s),i.closePath(),i.fill(),i.stroke()}},e.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.color,this.m_alpha),r.beginPath(),r.moveTo(e.x*i,e.y*i),r.lineTo(t.x*i,t.y*i),r.closePath(),r.stroke()},e.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n,(e.position.y+this.m_xformScale*e.R.col1.y)*n),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n,(e.position.y+this.m_xformScale*e.R.col2.y)*n),t.closePath(),t.stroke()}}();var s;for(s=0;s<n.postDefs.length;++s)n.postDefs[s]();delete n.postDefs,function(e){e.fn.getStyleObject=function(){var e=this.get(0),t,n={};if(window.getComputedStyle){var r=function(e,t){return t.toUpperCase()};t=window.getComputedStyle(e,null);for(var i=0;i<t.length;i++){var s=t[i],o=s.replace(/\-([a-z])/g,r),u=t.getPropertyValue(s);n[o]=u}return n}if(e.currentStyle){t=e.currentStyle;for(var s in t)n[s]=t[s];return n}return this.css()}}(e),function(e){isString=function(e){return toString.call(e)=="[object String]"},e.fn.bodysnatch=function(){var t=this;return t.each(function(n,r){var i=e(this),s=i.clone();w=i.width(),h=i.height(),w&&h?(window.getComputedStyle&&window.getComputedStyle.cssText?s.attr("style",window.getComputedStyle(i[0]).cssText):s.css(i.getStyleObject()),s.css({position:"absolute",top:i.offset().top,left:i.offset().left,width:i.width(),height:i.height(),margin:0}),s.addClass("perfect")):(s.css({position:"absolute",top:i.offset().top,left:i.offset().left,margin:0}),s.addClass("imperfect")),i[0].id&&(i[0].id=i[0].id+"_snatched"),i.addClass("snatched"),s.addClass("bodysnatcher"),i.css("visibility","hidden"),i[0].pause&&(i[0].pause(),i[0].src=""),t[n]=s[0],e("body").append(s)})}}(e),function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){function Y(e){return e.replace(/(?:^|\s)\w/g,function(e){return e.toUpperCase()})}function et(e){if(Z[e])return Z[e];var t=["ms","moz","webkit","o"],n=document.createElement("div"),r;for(var i=0,s=t.length;i<s;++i){r=t[i]+Y(e);if(typeof n.style[r]!="undefined")return Z[e]=r}return Z[e]=e}var t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G;E=n.Common.Math.b2Vec2,l=n.Collision.b2AABB,h=n.Dynamics.b2BodyDef,c=n.Dynamics.b2Body,m=n.Dynamics.b2FixtureDef,v=n.Dynamics.b2Fixture,S=n.Dynamics.b2World,g=n.Collision.Shapes.b2MassData,b=n.Collision.Shapes.b2PolygonShape,p=n.Collision.Shapes.b2CircleShape,d=n.Dynamics.b2DebugDraw,w=n.Dynamics.Joints.b2RevoluteJointDef,y=n.Dynamics.Joints.b2MouseJointDef,t=e,B={"-webkit-transform":"translateZ(0)","-moz-transform":"translateZ(0)","-o-transform":"translateZ(0)",transform:"translateZ(0)"},f=!1,i=!1,K={},Q=0,G=0,a=30,r=Math.PI/180,u=180/Math.PI,o=Math.PI*2,j={},O=!1,C=1.5,k=.3,L=.4,A="box",R=0,U=0,q=void 0,F=!1,W=void 0,I=void 0,s=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d;return i=e,R=void 0,U=void 0,l=void 0,c=void 0,s=!1,u=function(e){return d(e),r(R,U)},d=function(e){var t;return e.preventDefault(),t=e.originalEvent,t&&t.touches&&t.touches.length===1?(t.preventDefault(),R=t.touches[0].pageX,U=t.touches[0].pageY):(R=e.pageX,U=e.pageY)},a=function(e){return i.addEventListener("mousedown",o,!0),i.removeEventListener("mousemove",u,!0),s=!1,d(e),n(R,U)},p=function(e){return i.addEventListener("touchstart",h,!0),i.removeEventListener("touchmove",u,!0),s=!1,d(e),n(R,U)},o=function(e){return i.removeEventListener("mousedown",o,!0),i.addEventListener("mouseup",a,!0),i.addEventListener("mousemove",u,!0),s=!0,d(e),t(R,U)},h=function(e){return i.removeEventListener("touchstart",h,!0),i.addEventListener("touchend",p,!0),i.addEventListener("touchmove",u,!0),s=!0,d(e),t(R,U)},i.addEventListener("mousedown",o,!0),i.addEventListener("touchstart",h,!0),f={},f.mouseX=function(){return R},f.mouseY=function(){return U},f.isDown=function(){return s},f},M=function(e,t){return F=!0,z(e,t)},V=function(e,t){return F=!1,R=null,U=null},z=function(e,t){return R=e/30,U=t/30},D=function(){var e;return q=new E(R,U),e=new l,e.lowerBound.Set(R-.001,U-.001),e.upperBound.Set(R+.001,U+.001),W=null,K.QueryAABB(P,e),W},P=function(e){return e.GetBody().GetType()!==c.b2_staticBody&&e.GetShape().TestPoint(e.GetBody().GetTransform(),q)?(W=e.GetBody(),!1):!0},H=function(e){var t,n,r,i;t=e,n="",r=0,i=0;while(typeof t=="object"&&typeof t.tagName!="undefined"){i+=t.offsetTop,r+=t.offsetLeft,n=t.tagName.toUpperCase(),n==="BODY"&&(t=0);if(typeof t=="object"?typeof t.offsetParent=="object":void 0)t=t.offsetParent}return{x:r,y:i}},J=function(){var e,t;F&&!I&&(e=D(),e&&(t=new y,t.bodyA=K.GetGroundBody(),t.bodyB=e,t.target.Set(R,U),t.collideConnected=!0,t.maxForce=300*e.GetMass(),I=K.CreateJoint(t),e.SetAwake(!0)));if(I)return F?I.SetTarget(new E(R,U)):(K.DestroyJoint(I),I=null)},N=function(e,n,r,i,s,o){return n==null&&(n=A),r==null&&(r=O),i==null&&(i=C),s==null&&(s=L),o==null&&(o=k),t(e).each(function(e,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,C;return f=t(u),h=f.width(),c=f.height(),!h||!c?(f.attr("src")&&(typeof console!="undefined"&&console!==null&&console.log(" - box2d-jquery ERROR: an element withour width or height, will lead to strangeness!"),f.on("load",function(){return N(this,n,r,i,s,o)})),!0):(l=t(u).position(),E=h/2,p=c/2,S=l.left+E,C=l.top+p,g=f.attr("data-box2d-shape")?f.attr("data-box2d-shape"):n,d=parseFloat(f.attr("data-box2d-density")?f.attr("data-box2d-density"):i),m=parseFloat(f.attr("data-box2d-restitution")?f.attr("data-box2d-restitution"):s),v=parseFloat(f.attr("data-box2d-friction")?f.attr("data-box2d-friction"):o),f.attr("data-box2d-static")==="true"?y=!0:f.attr("data-box2d-static")==="false"?y=!1:y=r,g&&g!=="circle"?a=x(S,C,E,p,y,d,m,v):(w=E>p?E:p,a=T(S,C,w,y,d,m,v)),a.m_userData={domObj:f,width:E,height:p},f.data("b2body",a),f.css({left:0,top:0}),b="50% 50% 0",f.css({"-webkit-transform-origin":b,"-moz-transform-origin":b,"-ms-transform-origin":b,"-o-transform-origin":b,"transform-origin":b}),!0)})},x=function(e,t,n,r,i,s,o,u){var f,l;return i==null&&(i=O),s==null&&(s=C),o==null&&(o=L),u==null&&(u=k),f=new h,f.type=i?c.b2_staticBody:c.b2_dynamicBody,f.position.x=e/a,f.position.y=t/a,l=new m,l.density=s,l.friction=u,l.restitution=o,l.shape=new b,l.shape.SetAsBox(n/a,r/a),K.CreateBody(f).CreateFixture(l)},T=function(e,t,n,r,i,s,o){var u,f;return r==null&&(r=O),i==null&&(i=C),s==null&&(s=L),o==null&&(o=k),u=new h,u.type=r?c.b2_staticBody:c.b2_dynamicBody,u.position.x=e/a,u.position.y=t/a,f=new m,f.density=i,f.friction=o,f.restitution=s,f.shape=new p(n/a),K.CreateBody(u).CreateFixture(f)};var Z={};_=function(){var e,t,n,r,i,s,f,l,c,h;r=0,e=K.m_bodyList,c=[];while(e){n=e.m_fixtureList;while(n){if(n.m_userData){if(n.m_userData.remove){n.m_userData.domObj.remove(),K.DestroyBody(e),n=n.m_next;continue}f=Math.floor(n.m_body.m_xf.position.x*a-n.m_userData.width),l=Math.floor(n.m_body.m_xf.position.y*a-n.m_userData.height),i=Math.round((n.m_body.m_sweep.a+o)%o*u*100)/100,s="rotate("+i+"deg)",h=n.m_userData.domObj[0],s="translate("+f+"px,"+l+"px) "+s,h.style[et("transform")]=s}n=n.m_next}c.push(e=e.m_next)}return c},$=function(){window.requestAnimationFrame($),J(),K.Step(2/60,8,3),_(),i&&K.DrawDebugData(),K.ClearForces()},X=function(e,n,r,o){var u,l,c,h,p;return n==null&&(n=C),r==null&&(r=L),o==null&&(o=k),f=!0,K=new S(new E(Q,G),!0),p=t(window).width(),c=t(window).height(),x(0,-1,t(window).width(),1,!0,n,r,o),x(t(window).width()+1,0,1,t(window.document).height(),!0,n,r,o),x(-1,0,1,t(window.document).height(),!0,n,r,o),x(0,t(window.document).height()+1,t(window).width(),1,!0,n,r,o),h=s(document,M,V,z),i&&(l=new d,u=t("<canvas></canvas>"),l.SetSprite(u[0].getContext("2d")),l.SetDrawScale(a),l.SetFillAlpha(.3),l.SetLineThickness(1),l.SetFlags(d.e_shapeBit|d.e_jointBit),u.css("position","absolute"),u.css("top",0),u.css("left",0),u.css("border","1px solid green"),u.attr("width",t(window).width()),u.attr("height",t(document).height()),K.SetDebugDraw(l),t("body").append(u)),$()},t.fn.extend({box2d:function(e,n){if(typeof e=="string"){if(e==="gravity"){var r=new E(n.x*a,n.y*a);K.SetGravity(r)}return this}var s,o,u,l,c,h,p,d,v;return p=t.fn.box2d,c=t.extend({},p.default_options,e),Q=c["x-velocity"],G=c["y-velocity"],u=c.density,h=c.restitution,l=c.friction,d=c.shape,v=c["static"],o=c.debug,f===!1&&(o===!0&&(i=!0),X(this,u,h,l)),s=this.bodysnatch(),N(s,d,v,u,h,l),t(s)}}),t.extend(t.fn.physics,{default_options:{"x-velocity":0,"y-velocity":0,density:C,restitution:L,friction:k,"static":O,shape:A,debug:i}})}.call(this)});