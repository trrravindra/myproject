define("erefill/mediators/my-managed-accounts",["jquery","stapes","./globals","modules/overlay","modules/api-tools","jquery.validate","jquery-ui-datepicker-fr","json!config"],function(e,t,n,r,i,s,o,u){"use strict";var a=t.subclass({constructor:function(){var t=this;t.initEvents(),e(function(){t.emit("domready")})},initEvents:function(){var t=this;t.on("domready",t.onDomReady),r.on("create",function(){window.setTimeout(function(){e("img.ui-datepicker-trigger").on("click",function(){e(this).siblings("input").blur()})},1e3);var s=e(r.getElement().find(".form-details")[0]),o=e(r.getElement().find(".close")[0]),u=s.find("button[type=submit]"),a=s.find(".check-consent"),f=s.find(".check-required"),l=s.find(".terms"),c=e(".consent em"),h=s.find("input[type=text]"),p=s.find("input[type=password]"),d=!1;s.hasClass("mysuccess")&&(d=!0),d==1&&e(".close").on("click",function(e){location.href=s.attr("action"),r.close()}),s.hasClass("mysuccess")&&u.on("click",function(e){e.preventDefault(),n.showOverlayLoader(),window.setTimeout(function(){location.href=s.attr("action")},500),r.close()}),t.initDatePicker(),e(".cancel-custodian").on("click",function(e){r.close()});var v=function(){var e=s.find(".check-required:checked").length,t=s.find("input[type=checkbox]"),n=s.find(".input:checkbox.accept-cust-term"),r=s.find(".input:checkbox.accept-cust-auth");e===f.length?u.removeClass("disabled"):u.addClass("disabled")};f.on("change",v),l.length&&l.on("scroll",function(t){var n=e(t.currentTarget),r=s.find(".row.disabled"),i=r.find(".checker.disabled"),o=i.find("input[type=checkbox]");n[0].scrollHeight-n.scrollTop()<=n.outerHeight()&&(r.removeClass("disabled"),i.removeClass("disabled"),o.removeAttr("disabled"),c.removeClass("error"))}),u.on("click",function(t){u.hasClass("disabled")&&(t.preventDefault(),s.hasClass("accept-request")?s.find("input[type=checkbox]").each(function(t){e(this).parent("span").hasClass("checked")?e(this).parent("span").hasClass("checked")&&e(this).closest("div.row").removeClass("error"):e(this).closest("div.row").addClass("error")}):c.addClass("error"))}),s.length&&s.validate({errorClass:"invalid",errorContainer:".err-msg",errorLabelContainer:".err-msg ul",wrapper:"li",onkeyup:!1,onclick:!1,onfocusout:!1,ignore:"",highlight:function(t,n){e(t).parents("label").length?e(t).parents("label").addClass(n):e(t).addClass(n)},unhighlight:function(t,n){e(t).parents("label").length?e(t).parents("label").removeClass(n):e(t).removeClass(n)},showErrors:function(t,n){var r=e(".err-msg").data("default-msg");this.defaultShowErrors(),this.errorContext.empty();if(n.length){var i=this.errorContext;r&&i.append(e("<li />").text(r));var s=[];e.each(n,function(t,n){e.inArray(n.message,s)===-1&&(s.push(n.message),i.append(e("<li />").text(n.message)))})}},submitHandler:function(s){var o=e(s),u=r.getElement(),a=this,f=o.find('input[name="password"]').data("invalid-password"),l=!1;o.hasClass("mysuccess")&&(l=!0);if(o.hasClass("form-step-1")){var c=o.serialize();o.fadeOut("slow",function(){u.find(".loader").fadeIn();var n=i.prepare("POST","erefillApi.setUpCustodianship",c);e.ajax(n).done(function(e){u.find(".loader").fadeOut("slow",function(){t.showSuccessMessage()})}).fail(function(e){u.find(".loader").fadeOut(),o.fadeIn(),a.showErrors({password:f})})})}else if(o.hasClass("grant-access")||o.hasClass("accept-request")||o.hasClass("decline-request")||o.hasClass("revoke-access")||o.hasClass("remove-request")||o.hasClass("cancel-request")||o.hasClass("custodian-minor"))n.showOverlayLoader(),t.hideErrorMessages(),window.setTimeout(function(){e.ajax({type:"POST",url:o.attr("action"),cache:!1,data:o.serialize(),success:function(t){var i=t,s={};i.errorType?s.errorType=i.errorType:s.errorType="";var u=i.token;if(i.message=="0"){e(".err-msg ul").html("<li>"+o.attr("data-access-error")+"</li>");if(s.errorType){var a="p.hiddenErrorMessage."+s.errorType;e(a).removeClass("hiddenErrorMessage")}e(".err-msg ul").show(),e(".err-msg").show()}else if(i.message=="1"){var f=o.attr("data-error-overlay");r.open({content:f,refresh:!0}),r.on("create",function(){if(s.errorType){var t=".overlay p.hiddenErrorMessage."+s.errorType;e(t).removeClass("hiddenErrorMessage")}})}else if(i.message=="2"){var f=o.attr("data-success-overlay");typeof dataLayer!="undefined"&&(o.hasClass("grant-access")?dataLayer.push({"virtual-pagename":"grant-custodian-request-confirmation",event:"virtual-pageview"}):o.hasClass("custodian-minor")?dataLayer.push({"virtual-pagename":"setup-minor-custodianship-confirmation",event:"virtual-pageview"}):o.hasClass("revoke-access")?dataLayer.push({"virtual-pagename":"revoke-custodian-access",event:"virtual-pageview"}):o.hasClass("accept-request")?dataLayer.push({"virtual-pagename":"accept-custodian",event:"virtual-pageview"}):o.hasClass("decline-request")&&dataLayer.push({"virtual-pagename":"decline-custodian",event:"virtual-pageview"})),r.open({content:f,refresh:!0})}n.removeOverlayLoader()},error:function(e){n.removeOverlayLoader();var t=e.getResponseHeader("url");e.status===403&&(window.location.href=t)}})},500);else{l==1&&(location.href=o.attr("action"),r.close());var h=e(this).attr("action");n.showOverlayLoader(),window.setTimeout(function(){e.ajax({url:h,type:"GET",data:e(this).serialize(),success:function(e){n.removeOverlayLoader()},failure:function(e){n.removeOverlayLoader()}})},500),r.close()}}})}),e("a.viewprescriptions").on("click",function(t){t.preventDefault();var r=e(this),i=r.data("path"),s=r.data("target");n.showOverlayLoader(),window.setTimeout(function(){e.ajax({type:"GET",url:i,cache:!1,success:function(e){var t={};typeof e!="string"&&(t=e);var n=t.userToken,r=t.patientOID;location.href=s+r},failure:function(e){n.removeOverlayLoader()}})},500)})},onDomReady:function(){r.on("create",function(){var t=e(r.getElement().find(".form-details")[0]),n=t.find(".terms");if(n.length>0){var i=n[0].scrollHeight,s=251;i<=e(n).innerHeight()&&(i=0),i<s&&(e(n).css({"min-height":0,height:"auto"}),e(n).val().length<=139&&e(n).css("height",parseInt(e(n).css("height"))-parseInt(e(n).css("line-height"))))}}),e(window.document).on("click",".populate-fields-modal",function(t){t.preventDefault(),n.showOverlayLoader();var i=e(this).attr("data-modal"),s=e(this).attr("data-remove");r.open({content:i,refresh:!0}),e.ajax({url:i,type:"GET",contentType:"application/json",cache:!1,success:function(e){r.open({content:i,refresh:!0,detachOnClose:!0})},failure:function(e){}}),n.removeOverlayLoader()})},hideErrorMessages:function(){e(".err-msg p").addClass("hiddenErrorMessage")},showSuccessMessage:function(){var e=r.getElement(),t=e.find(".form-step-2"),n=t.find("form");t.fadeIn("slow",function(){t.removeClass("hidden")})},setupStepTwoForm:function(){var t=r.getElement(),n=t.find(".step-2"),i=n.find("form");n.fadeIn("slow",function(){n.removeClass("hidden")});var s=i.find("button[type=submit]"),o=i.find(".check-consent"),u=i.find(".check-required"),a=i.find(".terms"),f=e(".consent em"),l=function(){var e=i.find(".check-required:checked").length;e===u.length?s.removeClass("disabled"):(s.addClass("disabled"),f.addClass("error"))};u.on("change",l),a.length&&a.on("scroll",function(t){var n=e(t.currentTarget),r=i.find(".row.disabled"),s=r.find(".checker.disabled"),o=s.find("input[type=checkbox]");n[0].scrollHeight-n.scrollTop()<=n.outerHeight()&&(r.removeClass("disabled"),s.removeClass("disabled"),o.removeAttr("disabled"),f.removeClass("error"))}),s.on("click",function(e){s.hasClass("disabled")&&(e.preventDefault(),f.addClass("error"))})},initDatePicker:function(){var t=this,n=new Date,i=new Date(n.getFullYear(),n.getMonth(),n.getDate()+1),s=e("html").attr("lang"),o=e(".date-of-birth-date-picker"),u=r.getElement(),a=n.getFullYear(),f=a-125,l=u.find("form");s&&e.datepicker.setDefaults(e.datepicker.regional[s]),o.datepicker({showOn:"button",dateFormat:"yy-mm-dd",buttonImage:l.attr("data-cal-enable"),buttonImageOnly:!0,buttonText:o.attr("title"),changeMonth:!0,changeYear:!0,maxDate:n,yearRange:f+":"+a,beforeShow:function(){setTimeout(function(){e(".ui-datepicker").css("z-index",1111).addClass("uniform"),e(".ui-datepicker").find("select").uniform({selectAutoWidth:!0})},0)},onChangeMonthYear:function(){setTimeout(function(){e(".ui-datepicker").find("select").uniform({selectAutoWidth:!0})},0)}})}});return new a}),require(["require-config"],function(){require(["erefill/mediators/my-managed-accounts"])}),define("erefill-my-managed-accounts",function(){}),define("erefill-my-managed-accounts",function(){});