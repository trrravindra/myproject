/*!
 * accounting.js v0.3.2
 * Copyright 2011, Joss Crowcroft
 *
 * Freely distributable under the MIT license.
 * Portions of accounting.js are inspired or borrowed from underscore.js
 *
 * Full details and documentation:
 * http://josscrowcroft.github.com/accounting.js/
 */

/**
 * @license RequireJS i18n 2.0.4 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/i18n for details
 */

!function(e,t){function a(e){return!!(""===e||e&&e.charCodeAt&&e.substr)}function o(e){return u?u(e):"[object Array]"===f.call(e)}function n(e){return e&&"[object Object]"===f.call(e)}function r(e,t){var a;e=e||{},t=t||{};for(a in t)t.hasOwnProperty(a)&&null==e[a]&&(e[a]=t[a]);return e}function i(e,t,a){var o,n,r=[];if(!e)return r;if(d&&e.map===d)return e.map(t,a);for(o=0,n=e.length;o<n;o++)r[o]=t.call(a,e[o],o,e);return r}function s(e,t){return e=Math.round(Math.abs(e)),isNaN(e)?t:e}function l(e){var t=c.settings.currency.format;return"function"==typeof e&&(e=e()),a(e)&&e.match("%v")?{pos:e,neg:e.replace("-","").replace("%v","-%v"),zero:e}:e&&e.pos&&e.pos.match("%v")?e:a(t)?c.settings.currency.format={pos:t,neg:t.replace("%v","-%v"),zero:t}:t}var c={};c.version="0.3.2",c.settings={currency:{symbol:"$",format:"%s%v",decimal:".",thousand:",",precision:2,grouping:3},number:{precision:0,grouping:3,thousand:",",decimal:"."}};var d=Array.prototype.map,u=Array.isArray,f=Object.prototype.toString,p=c.unformat=c.parse=function(e,t){if(o(e))return i(e,function(e){return p(e,t)});if("number"==typeof(e=e||0))return e;t=t||c.settings.number.decimal;var a=new RegExp("[^0-9-"+t+"]",["g"]),n=parseFloat((""+e).replace(/\((.*)\)/,"-$1").replace(a,"").replace(t,"."));return isNaN(n)?0:n},h=c.toFixed=function(e,t){t=s(t,c.settings.number.precision);var a=Math.pow(10,t);return(Math.round(c.unformat(e)*a)/a).toFixed(t)},m=c.formatNumber=function(e,t,a,l){if(o(e))return i(e,function(e){return m(e,t,a,l)});e=p(e);var d=r(n(t)?t:{precision:t,thousand:a,decimal:l},c.settings.number),u=s(d.precision),f=e<0?"-":"",v=parseInt(h(Math.abs(e||0),u),10)+"",g=v.length>3?v.length%3:0;return f+(g?v.substr(0,g)+d.thousand:"")+v.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+d.thousand)+(u?d.decimal+h(Math.abs(e),u).split(".")[1]:"")},v=c.formatMoney=function(e,t,a,d,u,f){if(o(e))return i(e,function(e){return v(e,t,a,d,u,f)});e=p(e);var h=r(n(t)?t:{symbol:t,precision:a,thousand:d,decimal:u,format:f},c.settings.currency),g=l(h.format);return(e>0?g.pos:e<0?g.neg:g.zero).replace("%s",h.symbol).replace("%v",m(Math.abs(e),s(h.precision),h.thousand,h.decimal))};c.formatColumn=function(e,t,d,u,f,h){if(!e)return[];var v=r(n(t)?t:{symbol:t,precision:d,thousand:u,decimal:f,format:h},c.settings.currency),g=l(v.format),y=g.pos.indexOf("%s")<g.pos.indexOf("%v"),b=0;return i(i(e,function(e,t){if(o(e))return c.formatColumn(e,v);e=p(e);var a=e>0?g.pos:e<0?g.neg:g.zero,n=a.replace("%s",v.symbol).replace("%v",m(Math.abs(e),s(v.precision),v.thousand,v.decimal));return n.length>b&&(b=n.length),n}),function(e,t){return a(e)&&e.length<b?y?e.replace(v.symbol,v.symbol+new Array(b-e.length+1).join(" ")):new Array(b-e.length+1).join(" ")+e:e})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.accounting=c):"function"==typeof define&&define.amd?define("accounting",[],function(){return c}):(c.noConflict=function(t){return function(){return e.accounting=t,c.noConflict=void 0,c}}(e.accounting),e.accounting=c)}(this),define("modules/format",["accounting"],function(e){function t(e,t,a,o){return t<0&&(t=e.length+t),e.slice(0,t)+o+e.slice(t+Math.abs(a))}function a(e){return e.replace(n,"")}var o={},n=/[^0-9]/g;return o.phone=function(e){var o=a(e+""),n=o.length;return n<7?e:(o=t(o,-4,0,"-"),7===n?o:n>10?(o=t(o,-8,0,") "),o=t(o,-13,0," (")):o=t(o,-8,0,"-"))},o.currency=function(t,a){return e.formatMoney(t,a)},{as:function(e,t){var a=Array.prototype.slice.call(arguments);return a.shift(),o[e].apply(o,a)}}}),define("modules/managers/browser-detect",[],function(){return{init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(e){for(var t=0;t<e.length;t++){var a=e[t].string,o=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,a){if(-1!=a.indexOf(e[t].subString))return e[t].identity}else if(o)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}),define("modules/nav-universal",["jquery","stapes"],function(e,t){"use strict";var a={el:null},o=t.subclass({constructor:function(t){var o=this;o.config=e.extend({},a,t),o.el=e(o.config.el),o.el.length&&(o.initEvents(),o.accessibilityDropdown())},initEvents:function(){},accessibilityDropdown:function(){var t=this;e(t.el).on({focusin:function(t){e(this).has("div.dropdown")&&e(this).addClass("accessibility-focus")},focusout:function(t){var a=e(this);setTimeout(function(){a.find(":focus").length||a.removeClass("accessibility-focus")},10)}},"nav > ul > li"),e(t.el).find(".stores-wide > .col:first-child ul li a, .stores-wide > .col.last ul li a").css("width","202px")}});return function(e){return new o(e)}}),define("mediators/aoda",["jquery","stapes"],function(e,t){"use strict";function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var o={TAB:9,ENTER:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40},n=function(t){var a=this;this.id=t,this.allTabs=e(".aoda-tabcontrol-"+t),this.allTabpanels=e(".aoda-tabpanel-"+t),this.curTab=this.allTabs.filter(".active"),this.curTabIndex=this.curTab.index(".aoda-tabcontrol-"+this.id);var o=function(t){var o;t&&(o=e("#"+t.attr("aria-controls")),a.allTabs.attr({"aria-selected":"false"}),a.allTabpanels.attr({"aria-hidden":"true"}),t.attr({"aria-selected":"true"}),o.attr({"aria-hidden":"false"}))};this.getActiveTab=function(){return this.curTab},this.getActiveTabpanel=function(){return e("#"+this.curTab.attr("aria-controls"))},this.getPreviousTab=function(){var t=this.curTabIndex;return 0===t?this.allTabs.last():e(this.allTabs[t-1])},this.getNextTab=function(){var t=this.curTabIndex,a=this.allTabs;return t+1===a.length?a.first():e(a[t+1])},this.selectTab=function(t){o(e(t)),this.curTab=e(t),this.curTabIndex=this.curTab.index(".aoda-tabcontrol-"+this.id)}},r={collapse:{method:"setupCollapse",selector:".collapse [data-collapse-target]"},tabs:{method:"setupTabs",selector:".tabs"}};return new(t.subclass({constructor:function(){var t=this;t.initEvents(),e(function(){t.emit("domready")})},initEvents:function(){var e=this;e.on("domready",e.onDomReady),e._initHandlersForCollapse(),e._initHandlersForTabs()},onDomReady:function(){},_initHandlersForCollapse:function(){var t=window.document,a=function(t){var a=e(this),o=e("#"+a.attr("aria-controls"));"true"===a.attr("aria-expanded")?(a.attr("aria-expanded","false"),o.attr("aria-hidden","true")):"false"===a.attr("aria-expanded")&&(a.attr("aria-expanded","true"),o.attr("aria-hidden","false"))};e(t).on({click:a,keypress:function(t){t.which===o.SPACE?e(this).click():t.which}},".aoda-collapse-button")},doCollapse:function(e,t){e.hasClass("aoda-collapse-button")&&(e.attr("aria-expanded","false"),t.attr("aria-hidden","true"))},setupCollapse:function(t){t||(t=window.document);var o=r.collapse.selector,n=e(t).find(o);n.length&&n.each(function(t){if(!e(this).data("aoda-collapse-button")){var o=e(this),n=o.parents(".collapse:first"),r=n.find(o.data("collapse-target")),i=a(),s=(n.attr("id"),o.attr("id")||"collapseCtrl-"+i),l=r.attr("id")||"collapseTarget-"+i,c=n.hasClass("open");o.attr({id:s,role:"button","aria-expanded":c?"true":"false","aria-controls":l}),o.attr("href")||o.attr("href","#"),o.addClass("aoda-collapse-button"),r.attr({id:l,"aria-hidden":c?"false":"true"}),o.data("aoda-collapse-button",!0)}})},_initHandlersForTabs:function(){e(window.document).on({keyup:function(t){var a=e(this),n=a.parents(".tabs:first"),r=n.data("aoda-tablist");t.which===o.LEFT||t.which===o.UP?(a=r.getPreviousTab(),a.click(),a.focus()):t.which===o.RIGHT||t.which===o.DOWN?(a=r.getNextTab(),a.click(),a.focus()):t.which===o.SPACE?(a.click(),setTimeout(function(){r.getActiveTabpanel().focus()},5)):t.which===o.ENTER&&setTimeout(function(){r.getActiveTabpanel().focus()},5)},click:function(t){e(this).parents(".tabs:first").data("aoda-tablist").selectTab(this)}},".aoda-tabcontrol"),e(window.document).on({keyup:function(t){var a,n=e(this),r=e(".aoda-tablist-"+n.data("aoda-id")),i=r.data("aoda-tablist");t.which===o.UP&&(t.ctrlKey||t.altKey)?a=i.getActiveTab().focus():t.which===o.PAGEDOWN&&t.altKey?(a=i.getNextTab(),a.click(),setTimeout(function(){a.focus()},5)):t.which===o.PAGEUP&&t.altKey&&(a=i.getPreviousTab(),a.click(),setTimeout(function(){a.focus()},5))}},".aoda-tabpanel")},setupTabs:function(t){t||(t=window.document);var o=r.tabs.selector,i=e(t).find(o).has("[data-tab-target]");i.length&&i.each(function(t){var o=e(this),r=o.find("[data-tab-target]"),i=o.attr("id")||a(),s=[];if(!(r.length<2)){try{r.each(function(t){var a=e(e(this).attr("data-tab-target"));if(1!==a.length)throw new Error("Tab Data target not found or multiple elements matching target.");s.push(a[0])}),s=e(s)}catch(e){return}o.attr({role:"tablist",id:o.attr("id")||"aoda-tablist-"+i}),o.addClass("aoda-tablist-"+i),r.each(function(t){var a=e(this),o=e(s[t]),n=a.attr("id")||"aoda-tabcontrol-"+i+"-"+t,r=o.attr("id")||"aoda-tabpanel-"+i+"-"+t;a.attr({role:"tab","aria-controls":r,"aria-selected":a.hasClass("active")?"true":"false",tabindex:0,id:n}),a.parent().attr("role","presentation"),a.attr("href")||a.attr("href","#"),a.addClass("aoda-tabcontrol aoda-tabcontrol-"+i),a.data("aoda-id",i),o.attr({id:r,role:"tabpanel","aria-hidden":a.hasClass("active")?"false":"true","aria-labelledby":n,tabindex:"-1"}),o.addClass("aoda-tabpanel aoda-tabpanel-"+i),o.css("outline","none"),o.data("aoda-id",i)}),o.data("aoda-tablist",new n(i))}})},scan:function(e,t){var a=this;if(e||(e=window.document),t){if("string"==typeof t&&r[t])a[r[t].method](e);else if(t.length)for(var o=0,n=t.length;o<n;++o)r[t[o]]&&a[r[t[o]].method](e)}else{var i;for(i in r)a[r[i].method](e)}}}))}),define("mediators/globals",["jquery","stapes","./conditionals","modules/api-tools","modules/link-scroller","modules/tooltip","modules/overlay","modules/nav","tpl!templates/global.overlay-find-store.html","tpl!templates/global.header-branded-store-anon.html","tpl!templates/global.header-branded-store-known.html","tpl!templates/dynamic-content.html","modules/format","json!config","jquery.validate","modules/managers/cookie-manager","modules/managers/browser-detect","modules/nav-universal","./aoda"],function(e,t,a,o,n,r,s,l,c,d,u,f,p,h,m,v,g,y,b){"use strict";return Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,o=this.length;a<o;a++)if(this[a]===e)return a;return-1}),window.console||(window.console={}),window.console.log||(window.console.log=function(){}),new(t.subclass({conditionals:a,constants:{cookieNames:{WELCOME_OVERLAYS:"welcome_overlays",USER_COOKIE:"cqssoid",USER_OVERLAY_STATUS:"user_stat",PCPLUS_SIGN_IN_EMAIL:"pcplus_signin_email",PCPLUS_REDIRECT_URL:"redirect_url"}},constructor:function(){var t=this;t.initEvents(),t.cookieManager=new v,t.BrowserDetect=g,t.BrowserDetect.init(),e(".pcplus-dashboard").length>0&&t.getDashboard(),e(function(){t.emit("domready")})},initEvents:function(){function t(){document.cookie="craveOfferId=;path=/;domain="+h.cookieDomain,document.cookie="startDate=;path=/;domain="+h.cookieDomain,document.cookie="endDate=;path=/;domain="+h.cookieDomain,document.cookie="pcPoints=;path=/;domain="+h.cookieDomain,document.cookie="crave_off_stat=;path=/;domain="+h.cookieDomain,document.cookie="crave_off_earned=;path=/;domain="+h.cookieDomain}var a=this;a.on("domready",a.onDomReady),s.on("create",function(e){a.conditionals.scan(s.getElement(),["uniform","quick-rating","placeholder"]),b.scan(s.getElement())});var o=function(t){if(9===t.keyCode||27===t.keyCode){var a=e(this),o=a.find(":focusable,iframe"),n=o.first(),r=o.last();if(9==t.keyCode)r[0]===n[0]?t.preventDefault():!0===t.shiftKey&&t.target==n[0]?(t.preventDefault(),r.focus()):!1===t.shiftKey&&t.target==r[0]&&(t.preventDefault(),n.focus());else switch(e(t.target).prop("nodeName")){case"SELECT":case"IFRAME":break;default:t.data&&t.data.close&&t.data.close()}}},n=function(){var e=s.getElement(),t=e.find(":focusable,iframe");t.first().is("iframe")&&t.first().attr("tabindex","0"),t.first().focus()};s.on("open",function(e){var t,a=s.getElement();a.find(".overlay-product .details p").length&&(t=a.find(".overlay-product .details p").first(),(t.prop("scrollHeight")>t.innerHeight()||t.prop("scrollWidth")>t.innerWidth())&&t.attr("tabindex","0")),a.find(".pharmacy-information .pharmacy-about").length&&(t=a.find(".pharmacy-information .pharmacy-about").first(),(t.prop("scrollHeight")>t.innerHeight()||t.prop("scrollWidth")>t.innerWidth())&&t.attr("tabindex","0")),window.setTimeout(n,100),a.on("keydown",s,o)}),s.on("create",function(t){var a=s.getElement();e("html").hasClass("lt-ie9")&&a.find(".overlay-find-store-form")&&(interval=window.setInterval(function(){a.find(".overlay-find-store-form .input-search").hasClass("placeholder")&&(window.clearInterval(interval),n())},100))}),s.on("close",function(e){s.getElement().off("keydown",o)}),s.on("create",function(){var t=s.getElement().find(".overlay-find-store-form"),a=s.getElement().find(".err-msg"),o=s.getElement().find(".input-search");a.attr("tabindex",0),a.focus(),a.on({click:function(){o.focus()},keypress:function(t){13!==t.which&&32!==t.which||e(this).click()}}),t.on("submit",function(t){t.preventDefault();var a=e(this);e(".err-msg",a).css("visibility","hidden");var o=e(".input-search",a),n=s.getElement().find(".overlay h4").text();if(o.val()){var r="";for(i=0;i<h.api.pcApi.services.storeLocator.params.banner.length;i++)r=""===r?"banner="+h.api.pcApi.services.storeLocator.params.banner[i]:r+"&banner="+h.api.pcApi.services.storeLocator.params.banner[i];var l=h.api.pcApi.base+h.api.pcApi.services.storeLocator.path+"?lang="+h.api.pcApi.services.storeLocator.params.lang+"&stores="+h.api.pcApi.services.storeLocator.params.stores+"&"+r+"&proximity="+h.api.pcApi.services.storeLocator.params.proximity+"&location="+encodeURIComponent(encodeURIComponent(o.val()))+"&departments=";e.ajax({type:"GET",dataType:"json",url:l,cache:!1,success:function(t){e(this).attr("href");t&&t.length>0?("Select a store :"==n||"Sélectionnez un magasin :"==n?dataLayer.push({category:"stores",action:"engagement:select a store:completion",label:"",value:"",event:"GA Event"}):"To find another store:"==n||"Pour trouver un autre magasin:"==n?dataLayer.push({category:"stores",action:"engagement:change store:completion",label:"",value:"",event:"GA Event"}):"To view a flyer for a store near you:"!=n&&"Pour afficher la circulaire du magasin près de chez vous:"!=n||dataLayer.push({category:"stores",action:"engagement:view weekly flyer:completion",label:"",value:"",event:"GA Event"}),window.setTimeout(function(){a.get(0).submit()},500)):("Select a store :"==n||"Sélectionnez un magasin :"==n?dataLayer.push({category:"stores",action:"engagement:select a store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):"To find another store:"==n||"Pour trouver un autre magasin:"==n?dataLayer.push({category:"stores",action:"engagement:change store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):dataLayer.push({category:"stores",action:"engagement:view weekly flyer:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}),e(".err-msg",a).css("visibility","visible").focus())}})}else"Select a store :"==n||"Sélectionnez un magasin :"==n?dataLayer.push({category:"stores",action:"engagement:select a store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):"To find another store:"==n||"Pour trouver un autre magasin:"==n?dataLayer.push({category:"stores",action:"engagement:change store:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}):dataLayer.push({category:"stores",action:"engagement:view weekly flyer:error",label:"Sorry, no results found for your search",value:"",event:"GA Event"}),e(".err-msg",a).css("visibility","visible").focus()})}),s.on("close",function(){var e=s.getElement().find(".overlay-find-store-form .err-msg"),t=s.getElement().find(".overlay-find-store-form .input-search");e.length&&(t.val(""),e.css("visibility","hidden"))}),s.on("create",function(t){var o=s.getElement().find(".form-write-review");if(o.length){var n={findProfanityIn:function(){return""}};require(["modules/profanity-filter"],function(t){var a=e("html").attr("lang");a=a&&a.length?a.split("_")[0]:"en",n=t,n.init({lang:a})}),e.validator.addMethod("profanity",function(e,t){return this.optional(t)||!n.findProfanityIn(e).length}),o.validate({errorClass:"invalid",errorContainer:".err-msg",errorLabelContainer:".err-msg",errorElement:"p",onkeyup:!1,onclick:!1,onfocusout:!1,ignore:"",highlight:function(t,a){e(t).parents("label").length?e(t).parents("label").addClass(a):e(t).addClass(a)},unhighlight:function(t,a){e(t).parents("label").length?e(t).parents("label").removeClass(a):e(t).removeClass(a)},showErrors:function(t,a){var o=e(".err-msg").data("default-msg");this.defaultShowErrors(),this.errorContext.empty();var n,r=(e(this),e(location).attr("href")),i=e("html").attr("lang");if(n=r.slice(r.indexOf(i)).split("/"),n.length<2)return"other";var s=n[1];if(a.length){var l=this.errorContext;o&&l.append(e("<p />").text(o));var c=[];e.each(a,function(t,a){-1===e.inArray(a.message,c)&&(c.push(a.message),l.append(e("<p />").text(a.message)))}),dataLayer.push({category:s,action:"engagement:write a review:error",label:c,value:"",event:"GA Event"})}},invalidHandler:function(){setTimeout(function(){a._aodaerror(".err-msg p")},1e3)},submitHandler:function(t){var a=e(".submit-response"),o=e(t),n=e("#recaptcha_challenge_field").val(),r=e("#recaptcha_response_field").val(),i=e("body").data("page-analytics");a.html("");var l,c=(e(this),e(location).attr("href")),d=e("html").attr("lang");o.serialize();if(l=c.slice(c.indexOf(d)).split("/"),l.length<2)return"other";var u=l[1];e.ajax({type:"GET",url:"/apps/lcl/recaptcha",data:{recaptchaResponseField:r,recaptchaChallengeField:n},success:function(n){if("true"!==n)return a.html(a.data("captcha")).show(),!1;e.ajax({type:"POST",url:o.attr("action"),data:o.serialize(),dataType:"html",success:function(n){if(s.getElement().find(".hide-on-submit").fadeOut(500),o.fadeOut(500,function(){a.html(a.data("success")).show(),e(t)[0].reset(),dataLayer.push({category:u,action:"engagement:submitted review",label:i.pageName,value:"",event:"GA Event"})}),"undefined"!=typeof dataLayer)try{dataLayer.push({pageview:i.pageCategory+":review modal:write review:thank you:"+i.pageName,event:"vir_pageview"})}catch(e){throw"There was an error submitting Analytics data. Check that GTM was loaded, or that your call is properly setup."}},failure:function(e){a.html(a.data("fail")).show()}})},failure:function(e){a.html(a.data("fail")).show()}})}})}}),s.on("open",function(t){var o=s.getElement().find(".form-write-review");if(o.length){var n=function(){var t=o.find(".writereview-recaptcha-div"),a=t.attr("data-recaptcha-code"),n=t.attr("data-recaptcha-theme");if(t.data("recaptcha-loaded"))return void window.Recaptcha.reload();t.prop("id","writereview-recaptcha"),window.Recaptcha.create(a,"writereview-recaptcha",{theme:n,callback:function(){o.find("#recaptcha_reload_btn").attr({tabindex:0,href:""}).on("click",function(e){e.preventDefault()}),o.find("#recaptcha_switch_audio_btn").attr({tabindex:0,href:""}).on("click",function(e){e.preventDefault()}),e("#recaptcha_switch_img_btn").attr({tabindex:0,href:"#"}).click(function(e){e.preventDefault()}),o.find("#recaptcha_whatsthis_btn").attr({tabindex:0,href:""}).on("click",function(e){e.preventDefault()})}})};if(o.find(".recaptcha").length&&!a.Recaptcha){var r="https:"===location.protocol,i=r?"https:":"http:";require([i+"//www.google.com/recaptcha/api/js/recaptcha_ajax.js"],function(){a.Recaptcha=window.Recaptcha,n()})}else n()}}),s.on("close",function(){setTimeout(function(){s.getElement().find(".submit-response").empty()},200),s.getElement().find("form, .hide-on-submit").show()}),s.on("close",function(){var t=s.getElement().find(".form-write-review");if(t.length){var a,o,n,r,i=s.getElement().find(".form-write-review .err-msg li"),l=(s.getElement().find(".review-rating"),s.getElement().find(".rating-input")),c=s.getElement().find(".rating-form-input"),d=s.getElement().find(".checker span");if(l.hasClass("rated")){l.removeClass("rated"),a=s.getElement().find(".rating-input span"),n=s.getElement().find(".rating-form-input").val(),c.val("");for(var u=0;u<a.length;u++)o=e(a[u]),o.hasClass("on")&&(o.removeClass("on"),function(e,t){e.one("click",function(){e.addClass("on"),l.addClass("rated"),c.val(t)})}(o,n))}i.length&&(r=s.getElement().find(".invalid"),i.remove(),r.removeClass("invalid")),t[0].reset(),d.removeClass("checked")}}),s.on("create",function(){var t=s.getElement().find(".see-more-button");t.length&&t.click(function(t){t.preventDefault();var a=e(this);"#"!==a.attr("href")&&e.ajax({type:"POST",url:a.attr("href"),success:function(e){"undefined"!=typeof console&&console.log("Successful request")},error:function(e){"undefined"!=typeof console&&console.log("Error with request")}})})}),e(window.document).on("click",".find-store-overlay-trigger",function(t){var a=e(this),o=a.data("overlay-find-store")||"Select a Loblaws store:",n=a.data("overlay-find-store-url")||"WF-store-search-results-page-default.php";if(t.preventDefault(),s.open({content:{helpText:o,link:n},dataType:"json",template:c,wrapClassName:"overlay-find-store"}),a.is(":focusable")){var r=function(){a.focus(),s.off("close",r)};s.on("close",r)}}),e(window.document).on("click",".ctrl-print",function(e){e.preventDefault(),window.print()}),e(window.document).on("click",".update-cookie",function(t){t.preventDefault();var o=e(this),n=o.attr("href"),r=o.data("cookies");r&&void 0!==r&&e.each(r.cookies,function(e,t){a.cookieManager.setCookie(t.name,t.value,t.expires,"/",h.cookieDomain,!1)}),window.location.href=n}),e(window.document).on("click",".header-branded .pcplus-show-offers-notloaded a",function(a){a.preventDefault(),t(),window.location.href=e(this).attr("href")}),e(window.document).on("click",".header-branded .pc-dropdown a",function(e){document.cookie="pc_user_context=dashboard;path=/;domain="+h.cookieDomain}),e(window.document).on("click",".sign-out",function(o){if(o.preventDefault(),t(),document.cookie="pc_user_context=;path=/;domain="+h.cookieDomain,document.cookie="user_offers=;path=/;domain="+h.cookieDomain,e(".my-offers").length<1){var n=new Date;n.setDate(n.getDate()-1),document.cookie=a.constants.cookieNames.USER_COOKIE+"=;path=/;domain="+h.cookieDomain+";expires= "+n.toGMTString(),document.cookie=a.constants.cookieNames.USER_OVERLAY_STATUS+"=;path=/;domain="+h.cookieDomain+";expires= "+n.toGMTString(),document.location.reload()}}),e(window.document).on("click",".pcplus-sign-in",function(o){o.preventDefault(),t(),document.cookie=a.constants.cookieNames.PCPLUS_REDIRECT_URL+"="+location.pathname+";path=/;domain="+h.cookieDomain,window.location.href=e(".pcplus-sign-in a").attr("href")}),e(window.document).on("change","select.submit-on-change",function(t){t.preventDefault(),e(this).parents("form:first").submit()}),b.scan(window.document,"collapse"),e(window.document).on("click",".collapse [data-collapse-target]",function(t){t.preventDefault();var a=e(this),o=a.parents(".collapse:first"),n=o.hasClass("open"),r=o.find(a.attr("data-collapse-target"));n&&r.css("display","block"),r.slideToggle(!n,function(e){}),o.toggleClass("open",!n).toggleClass("closed",n)}),e(window.document).on({keydown:function(t){var a=e(this);32===t.which?a.click():t.which},click:function(t){t.preventDefault();e(this);e(".collapse.open").each(function(t,a){var o=e(a),n=o.find("[data-collapse-target]"),r=o.find(n.attr("data-collapse-target"));r.slideToggle(!1,function(e){o.addClass("closed").removeClass("open")}),b.doCollapse(n,r)})}},".collapse-all"),e(window.document).on("click",".dropdown [data-dropdown-target]",function(t){t.preventDefault();var a=e(this),o=a.parents(".dropdown:first"),n=o.hasClass("open");o.find(a.attr("data-dropdown-target"));n||e(window.document).one("click",function(e){a.is(e.target)||a.click()}),o.toggleClass("open",!n).toggleClass("closed",n)}),b.scan(window.document,"tabs"),e(window.document).on("click",".tabs [data-tab-target]",function(t){t.preventDefault();var a=e(this),o=a.parents(".tabs:first"),n=e(a.attr("data-tab-target"));o.find("[data-tab-target]").each(function(){var t=e(this);t.removeClass("active"),e(t.attr("data-tab-target")).hide()}),a.addClass("active"),n.show()}),e(window.document).on("click",".share:not([data-active])",function(t){t.preventDefault(),e(this).attr("data-active","1"),a.conditionals.scan(e(this).parent(),"share")}),e(window.document).on("click",".modal",function(t){t.preventDefault();var a=e(this),o=a.attr("data-modal")||a.attr("href"),n=a.hasClass("modal-video")?"overlay-video":"",r=a.attr("data-default-tab"),i=!1;if((e("body").find(".receipe-to-riches").length>0||e("body").find(".page-article-details").length>0)&&(i=!0),s.open({content:o,refresh:i,wrapClassName:n,detachOnClose:!0},function(t){var o=s.getElement();"number"==typeof captchaStartTime&&captchaTimer();var n="",i="";if(void 0!==a.parents(".no-reviews")[0]&&(o.find(".write-review").css("display","block"),o.find(".read-reviews").css("display","none"),o.find(".tabs li a").removeClass("active"),o.find(".tabs li:eq(1) a").addClass("active")),r){var l=parseInt(r,10)-1;o.find(".tab-content").css("display","none"),o.find(".tab-content").eq(l).css("display","block"),o.find(".tabs li a").removeClass("active"),o.find(".tabs li:eq("+l+") a").addClass("active")}if(a.hasClass("reviews-seeall")?(n=e(".overlay-wrap").find(".read-reviews").attr("class").split(" "),i="read-reviews"==n[0]?n[1]:n[0],e(".overlay-wrap").find(".write-review").hide(),e(".overlay-wrap").find(".read-reviews").show(),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find("li a").removeClass("active"),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find('li a[data-tab-target*="'+i+'"]').addClass("active")):a.hasClass("reviews-writeyourown")&&(n=e(".overlay-wrap").find(".write-review").attr("class").split(" "),i="write-review"==n[0]?n[1]:n[0],e(".overlay-wrap").find(".read-reviews").hide(),e(".overlay-wrap").find(".write-review").show(),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find("li a").removeClass("active"),e(".overlay-wrap").find(".read-write-reviews .tabs.tab-layout").find('li a[data-tab-target*="'+i+'"]').addClass("active")),a.data("modal-open-callback")){var c=a.data("modal-open-callback");window[c]&&(window[c],!0)&&window[c].call(this,o)}b.scan(o,"tabs")}),a.is(":focusable")){var l=function(){a.focus(),s.off("close",l)};s.on("close",l)}});var r=function(t){var a,o,n,r,i=e(this),s=i.data("more-fn");if(!1!==s)return s?void s():(a=i.find(".header, .details"),a.length&&a.find(".more").length?(n=a.height(),i.addClass("no-transition"),a.css("height","auto"),o=a.height(),a.css("height",n),s=function(){r=!r,a.css("height",r?o:"")},i.data("more-fn",s),void setTimeout(function(){i.removeClass("no-transition"),s()},10)):i.data("more-fn",!1))},l=function(t){var a=e(this),o=a.data("more-fn");o&&o()};e(window.document).on({mouseenter:function(t){var a=e(this);a.data("mouseIn",!0),a.data("focussedIn")||(a.data("focussedIn",!0),r.call(this,t))},mouseleave:function(t){var a=e(this);a.removeData("mouseIn"),a.find("a:focus").length||(a.removeData("focussedIn"),l.call(this,t))},focusin:function(t){var a=e(this);a.hasClass("accessibility-focus")||a.addClass("accessibility-focus"),a.data("focussedIn")||(a.data("focussedIn",!0),r.call(this,t))},focusout:function(t){e(this)}},".card")},fireClickAnalytics:function(e){if("undefined"!=typeof dataLayer)try{dataLayer.push(e)}catch(e){consoleLog(e)}},onDomReady:function(){var t=this,a=h.cssToShow,o=h.cssToHide,r=e("body").data("page-analytics"),i=e(".main.three-ways-to-join .card .footer").attr("data-btn-msg");if(e(".main.three-ways-to-join .card .footer").each(function(){e(this).find("accessibility-hidden").text(i)}),e(".header-branded .logo a .first-logo")&&e(".header-branded .logo a .first-logo img").attr("tabindex",0),e(".header-branded .logo a .second-logo")&&e(".header-branded .logo a .second-logo img").attr("tabindex",0),r&&r.pageName&&"error-page"==r.pageName&&(e(".page-404 .content .content-404 .title").attr("tabindex",0),e(".page-404 .content .content-404 .title").focus()),e("input[type=select]").on("click",function(){e(this).simulate("mousedown")}),e("input[type=checkbox]").on("focus",function(){e(this).parent("span").css("outline","1px dotted #ccc")}),e("input[type=checkbox]").on("focusout",function(){e(this).parent("span").css("outline","0px dotted #ccc")}),setTimeout(function(){e(".share .buttons .button.pinterest a").attr("href","#"),e(".share .buttons .button.pinterest a").attr("title","pinterest link"),e(".share a.email").attr("title","Email link")},4e3),(r="monthlyflyer")&&e("iframe").css("z-index","-100"),e(".main.create-account .card.card-pcplus-overview .registration-card a").mouseover(function(){e(this).css("text-decoration","underline")}).mouseout(function(){e(this).css("text-decoration","none")}),e(".card-pcplus-overview .registration-card p span a").mouseover(function(){e(this).css("text-decoration","underline")}).mouseout(function(){e(this).css("text-decoration","none")}),t.playerArray="",t.videoArray={},t.videotime=0,t.timeupdater="",t.orgVideoId="",t.videoPlayCount=0,t.videoPositionCount=0,e("body").find(".modal-video").length>0){var c=document.createElement("script");c.src="//www.youtube.com/iframe_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}s.on("create",function(e){"overlay-video"==e.wrapClassName&&t._trackYouTube(t)}),s.on("close",function(){t.videoPlayCount=0,t.videoPositionCount=0});var u="";if(e("body").find(".secondary-logo").length>0&&document.cookie.indexOf("storeNumCookie")>=0){var m=t.cookieManager.getCookieByName("storeNumCookie");h.secondarylogostores.indexOf(e.trim(m))>-1?(e(".header-branded .logo .second-logo img").attr("style","padding-left:0px"),e(".first-logo").addClass("hidden"),e(".second-logo").removeClass("hidden")):(e(".first-logo").removeClass("hidden"),e(".second-logo").addClass("hidden"))}else e(".first-logo").removeClass("hidden"),e(".second-logo").removeClass("hidden");e("body").find("form.dynamic-content").length>0&&(e("form.dynamic-content").each(function(){u=""===u?e(this).serialize():u+"&"+e(this).serialize()}),f.format=p,e.ajax({type:"POST",
url:e(".dynamic-content").attr("action"),data:u,cache:!1,success:function(t){var a="",o="",n=0;if(void 0!==t.perfectpairing&&t.perfectpairing.length>0)for(n=0;n<t.perfectpairing.length;n++){var r=t.perfectpairing[n].title.replace(/"/g,'\\"'),i=t.perfectpairing[n].description.replace(/"/g,'\\"');a='{"content_type":"'+t.perfectpairing[n].contentType+'","imgUrl":"'+t.perfectpairing[n].img+'","pathUrl":"'+t.perfectpairing[n].path+'","title":"'+r+'","desc":"'+i+'","imgTitle":"'+t.perfectpairing[n].imgTitle+'","buttonLabel":"'+t.perfectpairing[n].buttonLabel+'","whyNotTryLabel":"'+t.perfectpairing[n].whyNotTryLabel+'"}',a=e.parseJSON(a),o=e(f.render(a)),o.appendTo("."+t.perfectpairing[n].contentType)}if(void 0!==t.whynottry&&t.whynottry.length>0)for(n=0;n<t.whynottry.length;n++){var s=t.whynottry[n].title.replace(/"/g,'\\"'),l=t.whynottry[n].description.replace(/"/g,'\\"');a='{"content_type":"'+t.whynottry[n].contentType+'","imgUrl":"'+t.whynottry[n].img+'","pathUrl":"'+t.whynottry[n].path+'","title":"'+s+'","desc":"'+l+'","imgTitle":"'+t.whynottry[n].imgTitle+'","buttonLabel":"'+t.whynottry[n].buttonLabel+'","whyNotTryLabel":"'+t.whynottry[n].whyNotTryLabel+'"}',a=e.parseJSON(a),o=e(f.render(a)),o.appendTo("."+t.whynottry[n].contentType)}if(void 0!==t.tiles&&t.tiles.length>0)for(n=0;n<t.tiles.length;n++){var c=t.tiles[n].title.replace(/"/g,'\\"'),d=t.tiles[n].description.replace(/"/g,'\\"');a='{"content_type":"'+t.tiles[n].contentType+'","img":"'+t.tiles[n].img+'","pathUrl":"'+t.tiles[n].path+'","title":"'+c+'","desc":"'+d+'","imgTitle":"'+t.tiles[n].imgTitle+'","buttonLabel":"'+t.tiles[n].buttonLabel+'","whyNotTryLabel":"'+t.tiles[n].whyNotTryLabel+'"}',a=e.parseJSON(a),o=e(f.render(a)),t.tiles[n].staticContent?t.tiles[n].staticContent&&(e(".card.promo."+t.tiles[n].contentType+"_static").attr("style","display: block"),e(".card.promo."+t.tiles[n].contentType).attr("style","display: none")):(e(".card.promo."+t.tiles[n].contentType+"_static").attr("style","display: none"),e(".card.promo."+t.tiles[n].contentType).attr("style","display: block"),e(".card.promo."+t.tiles[n].contentType).html(""),o.appendTo("."+t.tiles[n].contentType))}},error:function(t,a,o){var n=decodeURIComponent(t.responseText);n=e.parseJSON(n);var r=n.exception,i="<li>"+r+"</li>";e(".err-msg ul").html(i),e(".err-msg").show(),e(".err-msg ul").show()}})),e(".pcplus-dashboard").length>0&&t.welcomeOverlay(),t.initTabEnable();for(var v=0;v<a.length;v++)e("."+a[v]).removeClass("hide-section");for(var g=0;g<o.length;g++)e("."+o[g]).addClass("hide-section");h.analytics.enabled&&require(["modules/site-analytics"],function(e){e()}),h.provincePrompt&&(console.log("province prompt: "+h.provincePrompt),require(["modules/province-selection"],function(e){e()})),h.headerInfo&&h.headerInfo.showStoreHeader&&t.initStoreDataPopulate(),t.initTooltip(),n({el:".scroll-link"}),y({el:".nav-universal"}),l({el:".nav-contextual"}),t.populateUserFields()},_trackYouTube:function(t){var a,o,n=this,r=e(".overlay iframe"),i=r.attr("src"),s=!1;a=24,s=!0,s&&(o=i.substr(a),o.indexOf("?")>-1&&(o=o.substr(0,o.indexOf("?"))),t.videoArray={},t.videoArray.id=o,e.ajax({dataType:"JSON",url:"https://gdata.youtube.com/feeds/api/videos/"+o+"?v=2&alt=json"}).done(function(a){t.videoArray.title=a.entry.title.$t,e("body section").hasClass("page-pccc-landing")?t.fireAnalytics({category:"pccc landing",action:"engagement:video player modal",label:t.videoArray.title,value:"",event:"GA Event"}):t.fireAnalytics({category:"videos",action:"engagement:video player modal",label:t.videoArray.title,value:"",event:"GA Event"})}),r.attr("id",o)),n._onYouTubeIframeAPIReady(t)},_onYouTubeIframeAPIReady:function(e){var t=this;e.playerArray={},e.playerArray=new YT.Player(e.videoArray.id,{events:{onReady:function(e){}}}),e.playerArray.addEventListener("onStateChange",function(a){t.onPlayerStateChange(a,t,e)})},onPlayerReady:function(e){var t=this;e.emit(t.events.YT_PLAYER_READY)},loadVideo:function(e){var t=this;t.currentID!=e?(t.currentID=e,t.videoPositionCount=0,t.videoPlayCount=0,t.player&&t.player.loadVideoById(e)):t.player.playVideo()},cueVideo:function(e){var t=this;t.currentID=e,t.videoPositionCount=0,t.videoPlayCount=0,t.player&&t.player.cueVideoById(e)},onPlayerStateChange:function(e,t,a){e.target.id;e.data==YT.PlayerState.PLAYING?(0===a.videoPlayCount&&(a.emit("initialPlay"),a.videoPlayCount++,t.fireAnalytics({category:"videos",action:a.videoArray.title,label:"video: 0-25",value:"",event:"GA Event"})),a.timeupdater=setInterval(function(){t._updateTime(t,a)},500)):clearInterval(a.timeupdater)},_updateTime:function(e,t){var a=t.videotime;t.playerArray&&t.playerArray.getCurrentTime&&(t.videotime=t.playerArray.getCurrentTime()),t.videotime!==a&&e._onProgress(t.videotime,t)},_onProgress:function(e,t){var a=this,o=t.playerArray.getDuration();if(!isNaN(o)){var n=e/o;switch(!0){case n>=.99&&t.videoPositionCount<5:t.videoPositionCount=5,a.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:complete",value:"",event:"GA Event"}),t.videoPositionCount=0,t.videoPlayCount=0,clearInterval(t.timeupdater);break;case n>=.75&&t.videoPositionCount<4:t.videoPositionCount=4,a.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:76-100",value:"",event:"GA Event"});break;case n>=.5&&t.videoPositionCount<3:t.videoPositionCount=3,a.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:51-75",value:"",event:"GA Event"});break;case n>=.25&&t.videoPositionCount<2:t.videoPositionCount=2,a.fireAnalytics({category:"videos",action:t.videoArray.title,label:"video:26-50",value:"",event:"GA Event"});break;case e>=.5&&t.videoPositionCount<1:t.videoPositionCount=1}}},initTabEnable:function(){if(location.hash){var t=(e(this),e(".tabs li a")),a=location.hash.split("!");e(".tabs li").find("."+a[1]).length>0&&(t.each(function(){var t=e(this);t.removeClass("active"),e(t.attr("data-tab-target")).hide()}),e("."+a[1]).addClass("active"),e(e("."+a[1]).attr("data-tab-target")).show(),b.scan(window.document,"tabs"))}},initTooltip:function(){e(".header-branded .tooltip").each(function(){r({el:this,offsetX:-3})})},initStoreDataPopulate:function(){var t=this;if(h.headerInfo&&"IDENTIFIED"===h.headerInfo.state&&h.headerInfo.flyerUrl&&h.headerInfo.storeDetailsUrl)t.storeDataPopulate();else{var a={storeResultsUrl:h.headerInfo.storeResultsUrl,flyerLinkText:h.headerInfo.flyerLinkText},o=d.render(a);e(".header-branded .store-info-holder").append(o)}},storeDataPopulate:function(){var t=e(".linkStoreDetails"),a=e(".linkStoreFlyer"),o=e(".linkStoreFlyerNextWeek"),n=e(".linkCatering"),r=e(".linkCoupon"),i=e(".textStoreName"),s=h.headerInfo.storeResultsUrl,l=h.headerInfo.storeDetailsUrl,c=h.headerInfo.flyerUrl,d=h.headerInfo.flyerLinkText,f=h.headerInfo.flyerNextWeekUrl,p=h.headerInfo.cateringUrl,m=h.headerInfo.couponUrl,v=h.headerInfo.storeHours,g="";t.attr("href",l),t.removeClass("find-store-overlay-trigger"),a.attr("href",c),a.removeClass("find-store-overlay-trigger"),o.attr("href",f),o.removeClass("find-store-overlay-trigger"),n.attr("href",p),n.removeClass("find-store-overlay-trigger"),r.attr("href",m),r.removeClass("find-store-overlay-trigger"),i.text(h.headerInfo.storeName),h.headerInfo.flyerLinkExternal&&(a.attr("target","_blank"),g="_blank");var y={name:h.headerInfo.storeName,storeResultsUrl:s,storeDetailsUrl:l,flyerUrl:c,flyerLinkText:d,storeHours:v,flyerLinkTarget:g},b=u.render(y);e(".header-branded .store-info-holder").append(b),setTimeout(function(){e(".linkStoreDetails").attr("href",l),e(".linkStoreDetails").removeClass("find-store-overlay-trigger"),e(".linkStoreFlyer").attr("href",c),e(".linkStoreFlyer").removeClass("find-store-overlay-trigger")},4e3)},getCookies:function(e){var t=e+"=",a=document.cookie.split(";"),o=0,n=a.length;for(o;o<n;o+=1){for(var r=a[o];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null},getDashboard:function(){var e=this;e.userData=e.cookieManager.getCookieByName(e.constants.cookieNames.USER_COOKIE),require(["modules/pcplus-dashboard"],function(t){e.userDashboard=new t({userData:e.userData})})},populateUserFields:function(){var t=this;void 0!==t.userData&&e(".user-name").each(function(a){var o=e(this);o.hasClass("greeting")?o.text(o.text()+t.userData.name):o.html(t.userData.name)})},welcomeOverlay:function(){var t=this;if(h.pcplus&&h.pcplus.welcomeOverlayPath&&""!==h.pcplus.welcomeOverlayPath){var a=h.pcplus.welcomeOverlayPath,o=t.cookieManager.getCookieByName(t.constants.cookieNames.USER_COOKIE);s.open({content:a,wrapClassName:"overlay-pcplus"}),s.on("create",function(a){var n=s.getElement();if(n.find(".pcplus-welcome-overlay").length>0){var r=n.find(".pcplus-welcome-overlay").data("overlay-template-name"),i={category:"pc plus",action:"welcome modals:"+r,label:"view",value:"",event:"GA Event"};if(t.fireAnalytics(i),!n.hasClass("overlay-pcplus"))return;var l=n.find(".btn-positive"),c=(n.find(".btn-negative"),n.find("a"));if(void 0!==o&&o.hasOwnProperty("mid")){var d=o,u=d.name?d.name:"";n.find(".user-name").text(u)}l.length>0&&l.on("click",function(e){location.href=l.attr("href")}),c.length>0&&c.on("click",function(a){var o=e(this).text(),n={category:"pc plus",action:"welcome modals:"+r,label:"click:"+o,value:"",event:"GA Event"};t.fireAnalytics(n),s.close()})}}),s.on("close",function(a){if(s.getElement().find(".pcplus-welcome-overlay").length>0){var o=t.cookieManager.getCookieByName(t.constants.cookieNames.USER_OVERLAY_STATUS);e.isArray(o)&&o.shift(),t.cookieManager.setCookie(t.constants.cookieNames.USER_OVERLAY_STATUS,o,"","/",h.cookieDomain,!0)}})}},_aodaerror:function(t){e(t).each(function(){e(this).attr("tabindex",0)}),e("form :focus").blur();var a=e(t).filter(function(){return"none"!=e(this).css("display")});".form-errors p"==t||".err-msg p"==t?a.first().focus():".form-errors"==t&&e(t).focus()},fireAnalytics:function(e){if(window.dataLayer=window.dataLayer||[],void 0===window.dataLayer)return!1;try{return window.dataLayer.push(e),!0}catch(e){return!1}}}))}),define("modules/store-markers",["jquery","stapes","modules/api-tools","json!config","tpl!templates/global.store-info-window.html","modules/format"],function(e,t,a,o,n,r){"use strict";n.format=r;var i={map:null},s=t.subclass({constructor:function(t){var a=this;a.config=e.extend({},i,t),a.map=a.config.map,a.map&&a.initEvents()},initEvents:function(){var e=this;e.on({click:function(t){e.openInfoWindow(t)}})},closeInfoWindow:function(){var e=this;e.currentInfoWindow&&e.currentInfoWindow.close(),e.currentInfoWindow=!1},openInfoWindow:function(e){var t=this,a=t.get(e);if("undefined"!=typeof console&&(console.log(t.currentInfoWindow),console.log(typeof t.currentInfoWindow)),!a)return t;t.currentInfoWindow!==a.infoWindow&&(void 0!==t.currentInfoWindow&&google.maps.event.clearListeners(t.currentInfoWindow,"closeclick"),t.closeInfoWindow(),t.currentInfoWindow=a.infoWindow,google.maps.event.addListener(t.currentInfoWindow,"closeclick",function(){t.closeInfoWindow()}),t.currentInfoWindow.open(t.map,a.marker))},createMarker:function(e,t){if(!window.google)return void("undefined"!=typeof console&&console.log("Google not loaded"));var a=this,r=google.maps,i=new r.MarkerImage(t.identifierPin,new r.Size(21,34),new r.Point(0,0),new r.Point(10,34)),s=new r.MarkerImage(o.storeLocator.pinShadowUrlTpl,new r.Size(40,37),new r.Point(0,0),new r.Point(12,35)),l=new r.Marker({position:e,map:a.map,icon:i,shadow:s,title:t.banner.bannerName}),c=new r.InfoWindow({content:n.render(t)}),d="marker-"+t.identifier,u={marker:l,infoWindow:c};r.event.addListener(l,"click",function(){a.emit("click",d),a.emit("click:"+d,u)}),a.set(d,u)},clear:function(){var e=this;e.closeInfoWindow(),e.remove(function(e){return e.marker.setMap(null),!0})}});return function(e){return new s(e)}}),function(){"use strict";function e(e,t,a,o,n,r){t[e]&&(a.push(e),!0!==t[e]&&1!==t[e]||o.push(n+e+"/"+r))}function t(e,t,a,o,n){var r=o+t+"/"+n;require._fileExists(e.toUrl(r+".js"))&&a.push(r)}function a(e,t,o){var n;for(n in t)!t.hasOwnProperty(n)||e.hasOwnProperty(n)&&!o?"object"==typeof t[n]&&(!e[n]&&t[n]&&(e[n]={}),a(e[n],t[n],o)):e[n]=t[n]}var o=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(n){var r=n.config?n.config():{};return{version:"2.0.4",load:function(n,i,s,l){l=l||{},l.locale&&(r.locale=l.locale);var c,d,u,f=o.exec(n),p=f[1],h=f[4],m=f[5],v=h.split("-"),g=[],y={},b="";if(f[5]?(p=f[1],c=p+m):(c=n,m=f[4],h=r.locale,h||(h=r.locale="undefined"==typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),v=h.split("-")),l.isBuild){for(g.push(c),t(i,"root",g,p,m),d=0;d<v.length;d++)u=v[d],b+=(b?"-":"")+u,t(i,b,g,p,m);i(g,function(){s()})}else i([c],function(t){var o,n=[];for(e("root",t,n,g,p,m),d=0;d<v.length;d++)o=v[d],b+=(b?"-":"")+o,e(b,t,n,g,p,m);i(g,function(){var e,o,r;for(e=n.length-1;e>-1&&n[e];e--)r=n[e],o=t[r],!0!==o&&1!==o||(o=i(p+r+"/"+m)),a(y,o);s(y)})})}}})}(),define("nls/speak",{root:{header:"Find Your Local Pharmacy",searchlbl:"Search results for:",frmplaceholder:"Enter your address, postal code or city",btnfind:"Find",btnback:"Back to Home",storehr:"Store Hours",storesrv:"Store Services",btnselstore:"Select This Store",errmsg:"No Results Found"},fr_CA:!0}),define("mediators/storelocator",["jquery","stapes","modules/api-tools","./globals","modules/store-markers","tpl!templates/global.store-result.html","modules/format","i18n!nls/speak"],function(e,t,a,o,n,r,i,s){"use strict";var l=e.parseJSON(e("input[name='storelocator']").val());return new(t.subclass({constructor:function(){var t=this;t.bindEvents(),t.storeIdCookie="storeIdCookie",t.storeNameCookie="storeNameCookie",t.storeNumCookie="storeNumCookie",t.el=this&&this.document&&this.document.documentElement,l.departments&&"4300002"===l.departments&&t.setupSearchForPCPlus(),e(function(){t.emit("domready")})},setupSearchForPCPlus:function(){var t=e("#form-store-locator"),a=t.find('.departments input[type="checkbox"]'),o=a.filter("[value=4300002]");o.length>0&&o.prop("checked",!0).closest("span").addClass("checked")},bindEvents:function(){var e=this;e.on("domready",e.onDomReady)},localizetxt:function(){e(".page-details.locator .content h1").html(s.header),e(".page-details.locator .store-locator h4").html(s.searchlbl),e(".page-details.locator .store-listing .store-info .store-hours a").text(s.storehr),e(".page-details.locator .store-listing .store-services a").html(s.storesrv),e(".store-locator form input[type='text']").attr("placeholder",s.frmplaceholder),e(".store-locator form button.button-erefill").html(s.btnfind),e(".store-locator form a.button-erefill").html(s.btnback),e(".store-locator .store-listing .store-info .button.select-store-button").text(s.btnselstore),e(".store-locator form .error p").html(s.errmsg)},onDomReady:function(){var t,a,o,n,r,i=this;t=e(location).attr("href"),a=t.indexOf("c/"),o=t.indexOf("storelocator.html"),n=t.slice(a+2,o-1),e("#form-store-locator .button-erefill.red").on("click",function(t){t.preventDefault(),localStorage.removeItem("erefill-storeloc"),e("#form-store-locator").submit()});var s,l,c=(i.getUrlParameter("departments"),i.getUrlParameter("location"));localStorage.getItem("erefill-storeloc");l=localStorage.getItem("erefill-contextpath"),s=l+"/en_CA/store/location/"+c+"/department/300064/proximity/50/fetch/10",e("#form-store-locator").find("input[type=text]").val(c.replace("+"," ")),e(".enlang").on("click",function(t){t.preventDefault(),r=window.location,r=r.replace(n,"en_CA"),window.location.href=e(this).attr("href")+"?location="+c}),e(".frlang").on("click",function(t){t.preventDefault(),r=window.location,r=r.replace(n,"fr_CA"),window.location.href=e(this).attr("href")+"?location="+c}),e("#form-store-locator").attr("data-storeloc",s),window.google?(i.G=window.google.maps,i.initLocator()):(window.google_callback=function(){i.G=window.google.maps,i.initLocator()},require(["//maps.google.com/maps/api/js?sensor=false&callback=google_callback"]))},getUrlParameter:function(e){for(var t=window.location.search.substring(1),a=t.split("&"),o=0;o<a.length;o++){var n=a[o].split("=");if(n[0]==e)return n[1]}},initLocator:function(){var t=this,a=e("#form-store-locator"),o=a.find('.departments input[type="checkbox"]'),s=e(".map_canvas"),c=l.mapDefaults,d={mapTypeId:t.G.MapTypeId[c.mapType],center:new t.G.LatLng(c.center.lat,c.center.lng),zoom:c.zoom};t.$formStoreSearch=a,t.$departments=o,o.filter('[value=""], :not([value])').attr("disabled","disabled").closest("li").addClass("disabled"),r.format=i,t.prevSearch="",t.infoWindows=[],t.btnFind=e(".btn-find",a),t.inputSearch=e(".input-search",a),t.storeListing=e(".main .store-listing"),t.map=new t.G.Map(s[0],d),t.markers=n({map:t.map}),t.currentLocation=null,t.inputSearch.val()&&""!==t.inputSearch.val()?t.searchStores(t.getUrlParameter("location")):t.searchStores(l.defaultSearch),a.on("change",'.departments input[type="checkbox"]',function(e){t.searchStores()}),e(".main-store-locator").on("click",".store-info .title a, .store-info .map-marker",function(a){a.preventDefault();var o=e(this).attr("data-identifier");t.markers.openInfoWindow("marker-"+o)})},searchStores:function(e){var t=this;if(e=e||t.inputSearch.val()){(new t.G.Geocoder).geocode({address:e},function(a,o){if(o===t.G.GeocoderStatus.OK)try{t.currentLocation=a[0].geometry.location}catch(e){}else t.currentLocation=null;t.buildStoreList(e)})}},buildStoreList:function(t){console.log("buildStoreList");var a=this,o=a.$formStoreSearch,n=a.$departments,r=o.find(".error"),i=o.find(".input-search");a.mapBounds=new a.G.LatLngBounds,e.makeArray(n.filter(":checked").map(function(){return e(this).val()}));var s=o.attr("data-storeloc"),l=localStorage.getItem("erefill-storeloc");if(l){var c="["+decodeURIComponent(l)+"]";c=JSON.parse(c);var d=JSON.parse(c[0].response);d=d.stores,r.hide(),i.removeClass("input-error"),e.each(d,function(e,o){var n=String.fromCharCode(65+e);a.showResult(n,t,o)}),a.map.fitBounds(a.mapBounds)}else a.xhr&&a.xhr.abort&&a.xhr.abort(),a.xhr=e.ajax({type:"GET",url:s,beforeSend:function(e){e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.setRequestHeader("Accept","application/json")},success:function(o){var n=JSON.parse(o.response);n=n.stores,a.markers.clear(),a.storeListing.empty(),n&&n.length>0?(r.hide(),i.removeClass("input-error"),e.each(n,function(e,o){var n=String.fromCharCode(65+e);a.showResult(n,t,o)}),a.map.fitBounds(a.mapBounds)):(r.show(),i.addClass("input-error"))},error:function(e,t){}})},showResult:function(t,o,n){var i=this,s=new i.G.LatLng(n.address.latitude,n.address.longitude),c=e.extend({identifier:t,identifierPin:a.uriTemplate(l.pinUrlTpl,{identifier:t}),fromAddress:o,distance:n.distance},n),d=e(r.render(c));i.localizetxt(),i.markers.createMarker(s,c),d.appendTo(i.storeListing).on("click","a.button",{id:n.id,storeNumber:n.storeNumber,storeProvince:n.address.province,storeName:n.storeName},i.onSelectStore),i.mapBounds.extend(s)},calculateDistanceTo:function(e){var t=this;return t.currentLocation?(t.G.geometry.spherical.computeDistanceBetween(e,t.currentLocation)/1e3).toFixed(1).replace(".0","")+"km":""},onSelectStore:function(t){t.preventDefault();var a=e(this),n=a.attr("href");o.cookieManager.setCookie("storeIdCookie",t.data.id,l.cookieExpiry,"/",l.cookieDomain,!1),o.cookieManager.setCookie("storeNumCookie",t.data.storeNumber,l.cookieExpiry,"/",l.cookieDomain,!1),o.cookieManager.setCookie("storeProvienceCookie",t.data.storeProvince,l.cookieExpiry,"/",l.cookieDomain,!1),window.location.href=n}}))}),require(["require-config"],function(){require(["mediators/storelocator"])}),define("page-storelocator",function(){}),define("page-storelocator",function(){});