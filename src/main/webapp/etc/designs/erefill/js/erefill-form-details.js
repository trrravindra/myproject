define("erefill/mediators/form-details",["jquery","./globals","jquery-ui-datepicker-fr","json!config","../../modules/managers/cookie-manager","../../modules/overlay"],function(e,t,n,r,i,s){"use strict";var o=!1,u=function(n){var r={},i={},s="",u={check:{all:function(){for(var e in r)if(!r[e])return!1;return!0},any:function(){for(var e in r)if(r[e])return!0}},update:{all:function(){u.check.all()?i.button.submit.prop("disabled",!1):i.input.text.hasClass("form-security")?s=="undo"?(i.button.submit.prop("disabled",!0),s=""):i.button.submit.prop("disabled")?i.button.submit.prop("disabled",!0):i.button.submit.prop("disabled",!1):(i.input.text&&i.input.captchatext&&i.button.submit.prop("disabled",!1),i.button.submit.prop("disabled")||i.button.submit.prop("disabled",!1)),u.check.any()?(i.button.reset.addClass("active"),i.button.hint.addClass("active"),i.button.success.removeClass("active"),i.button.error.removeClass("active"),i.button.exception.removeClass("active")):(i.button.reset.removeClass("active"),i.button.hint.removeClass("active"),i.button.success.removeClass("active"),i.button.error.removeClass("active"),i.button.exception.removeClass("active"));var t=!1;i.input.text.each(function(){if(!e(this).val()||e(this).val()=="")return t=!1,!1;e(this).attr("value")!=e(this).val()&&(t=!0),o&&(t=!0)}),i.button.reset.toggleClass("active",t),t?t&&(i.input.text.parents().hasClass("section-username")||i.input.text.parents().hasClass("section-communication"))&&i.button.submit.prop("disabled",!1):(i.input.text.parents().hasClass("section-username")||i.input.text.parents().hasClass("section-communication"))&&i.button.submit.prop("disabled",!1),!i.button.reset.hasClass("active")&&i.input.text.hasClass("form-security")&&(s=""),i.button.reset.hasClass("active")&&i.input.text.hasClass("form-security")&&i.button.submit.prop("disabled",!1)},any:function(){u.check.any()?i.button.submit.prop("disabled",!1):i.button.submit.prop("disabled",!0)}},resetSecurityQuestions:function(){e("select.security-question").each(function(){var t=e(this),n=t.attr("data-previous-question");if(n){t.val(n);var r=t.find("option:selected").text();t.siblings("span").text(r),t.removeAttr("data-previous-question")}}),o=!1}},a={input:{all:function(){var t=e(this),n=t.attr("name"),i=t.val();r[n]=i!==""&&i!==e(this).attr("value")?!0:!1,u.update.all()},keypress:function(){var t=e(this);t.removeClass("border-error");var n=t.attr("name"),i=t.val();r[n]=i!==""&&i!==e(this).attr("value")?!0:!1,u.update.all()},check:function(){var t=e(this),n=t.attr("name"),i=t.prop("checked");r[n]=i,u.update.any()},radio:function(){r.radio=!0,u.update.all()}},button:{reset:function(){for(var e in r)r[e]=!1;s="undo",u.update.all(),i.button.reset.removeClass("active"),f.instances(),u.resetSecurityQuestions()},submit:function(n){var r=e(this).parents("form:first"),s=e(this).closest("form"),u=s.find(":input"),a=s.find(".err-msg"),f=s.find("label.error"),l=!1,c,h=!1,p=e("input[type=text]",s),r=e(this).parents("form:first");if(r.hasClass("section-communication")||r.hasClass("phone-number")){e(".phone1").val()==""&&e(".phone2").val()==""&&e(".phone3").val()==""&&(l=!1,h=!0),f.remove();if(h||r.valid())n.preventDefault(),l?(c=p.eq(0).data("msg-required"),a.append(e("<li tabindex='0'></li>").text(c))):(a.empty(),u.removeClass("border-error"),t.showOverlayLoader(),window.setTimeout(function(){e.ajax({type:"POST",url:r.attr("action"),headers:{Accept:"text/plain"},data:r.serialize(),success:function(n){var r=e(".section-communication").find(".button-unsubscribe"),i=e(".phone-number").find(".button-unsubscribe"),s=e(".section-communication").find(".button-error"),o=e(".phone-number").find(".button-error"),u=e(".phone-number").find(".button-success"),a=e(".section-communication").find(".button-success"),f=e(".phone-number").find(".button-invalid"),n=e.parseJSON(decodeURIComponent(n)),l=e('.section-communication input[name="email"]').val(),c=e.trim(e(".section-communication .confirmation-status").text()),h=e.trim(e(".phone-number .confirmation-status").text()),p=n.token_value;n.update_status=="ok"?n.unsubscribed?n.unsubscribed=="email"?(r.addClass("active"),i.removeClass("active"),u.removeClass("active"),a.removeClass("active"),f.removeClass("active")):n.unsubscribed=="phone"&&(r.removeClass("active"),i.addClass("active"),u.removeClass("active"),a.removeClass("active"),f.removeClass("active")):n.engagement&&(n.engagement=="email"?(r.removeClass("active"),i.removeClass("active"),u.removeClass("active"),a.addClass("active"),f.removeClass("active")):n.engagement=="phone"&&(r.removeClass("active"),i.removeClass("active"),u.addClass("active"),a.removeClass("active"),f.removeClass("active"))):n.update_status=="invalid"?n.engagement&&n.engagement=="phone"&&(r.removeClass("active"),i.removeClass("active"),o.removeClass("active"),s.removeClass("active"),f.addClass("active"),u.removeClass("active"),a.removeClass("active")):n.update_status=="error"&&(n.unsubscribed?n.unsubscribed=="email"?(r.removeClass("active"),r.removeClass("active"),i.removeClass("active"),o.removeClass("active"),s.addClass("active"),f.removeClass("active")):n.unsubscribed=="phone"&&(r.removeClass("active"),i.removeClass("active"),o.addClass("active"),s.removeClass("active"),f.removeClass("active")):n.engagement&&n.engagement=="phone"&&(r.removeClass("active"),i.removeClass("active"),o.addClass("active"),s.removeClass("active"),f.removeClass("active"))),e(".section-communication .confirmation-status").text(n.emailstatus),e(".phone-number .confirmation-status").text(n.phonestatus),t.removeOverlayLoader()}})},500));else if(r.hasClass("phone-number")){var f=s.find("label.error"),d=[];e("input.phone1").removeClass("border-error"),e("input.phone2").removeClass("border-error"),e("input.phone3").removeClass("border-error"),setTimeout(function(){f.each(function(){var t=e(this),n=t.text();f.attr("tabindex","0");var r="."+t.attr("for");e(r).hasClass("error")&&e(r).addClass("border-error");for(var i=0;i<d.length;i++)d[i]==n&&t.remove();d[d.length++]=n}),d.length=0},0)}a.find("li").length>1?a.first().focus():a.find("li").focus()}if(r.hasClass("form-account-update")){i.button.error.removeClass("active"),i.button.error1.removeClass("active"),i.button.exception.removeClass("active");if(r.valid()){n.preventDefault();var v=r.attr("action"),m=e("body").data("page-analytics"),g=new Date;g.setTime(g.getTime()+31536e6);var y="; expires="+g.toGMTString();t.showOverlayLoader();if(r.hasClass("section-questions")){var b=r.serialize(),w=b.split("&"),E={};for(var S in w){var x=w[S].split("=");E[x[0]]=x[1]}}window.setTimeout(function(){e.ajax({type:"POST",url:v,headers:{Accept:"text/plain"},data:r.serialize(),success:function(n){n=e.parseJSON(decodeURIComponent(n));if(n.update_status=="ok"){if(r.hasClass("section-questions")){var s=E.answer1,u=E.answer2,a=E.answer3;e("input.form-security[name='answer1']").attr("value",s),e("input.form-security[name='answer2']").attr("value",u),e("input.form-security[name='answer3']").attr("value",a)}i.button.reset.removeClass("active"),i.button.success.addClass("active"),i.button.error.removeClass("active"),i.button.exception.removeClass("active"),h instanceof Array&&(h=h.toString()),p instanceof Array&&(p=p.toString());if(typeof dataLayer!="undefined"){var f="";n.engagement=="username"?f="engagement:change user name":n.engagement=="password"?f="engagement:change password":n.engagement=="email"?f="engagement:change email":n.engagement=="security"&&(f="engagement:change security");try{dataLayer.push({category:m.pageCategory,action:f,label:m.pageURL,value:"",event:"GA Event"})}catch(l){throw"There was an error submitting Analytics data. Check that GTM was loaded, or that your call is properly setup."}}}else if(n.update_status=="error"){h instanceof Array&&(h=h.toString()),p instanceof Array&&(p=p.toString()),i.button.reset.removeClass("active"),i.button.success.removeClass("active"),i.button.error.addClass("active"),i.button.error1.removeClass("active"),i.button.exception.removeClass("active"),r.find("input.error").addClass("border-error");var c=r.find("input.error").next("p");c.attr("tabindex","0").focus()}else if(n.update_status=="error1"){var h=n.token_status,p=n.token_value;i.button.reset.removeClass("active"),i.button.success.removeClass("active"),i.button.error1.addClass("active"),i.button.error.removeClass("active"),i.button.exception.removeClass("active"),r.find("input.error").addClass("border-error"),e("input[name='currentpassword']").addClass("error border-error")}else n.update_status=="exception"&&(i.button.reset.removeClass("active"),i.button.success.removeClass("active"),i.button.error.removeClass("active"),i.button.error1.removeClass("active"),i.button.exception.addClass("active"),r.find("input.error").addClass("border-error"));t.removeOverlayLoader(),e("select.security-question").each(function(){var t=e(this),n=t.attr("data-previous-question");n&&t.removeAttr("data-previous-question"),t.attr("data-new-value",t.val())}),o=!1}})},500)}else r.find("input").hasClass("error")&&r.find("input.error").addClass("border-error")}r.hasClass("form-registration")&&r.valid()&&(n.preventDefault(),t.showOverlayLoader(),window.setTimeout(function(){e("form.form-registration").submit()},500)),r.hasClass("form-dob")&&(n.preventDefault(),t.showOverlayLoader(),window.setTimeout(function(){e("form.form-dob").submit()},500))}},bind:function(){i.button.reset.on("click",a.button.reset),i.button.submit.on("click",a.button.submit),i.input.radio.on("change",a.input.radio),i.input.check.on("change",a.input.check),i.input.select.on("change",a.input.all),i.input.text.on("change  focus paste textInput input propertychange",a.input.all),i.input.text.on("keyup",a.input.keypress)}},f={instances:function(){i.input={},i.input.captchatext=n.find("input[name='recaptcha_response_field']"),i.input.text=n.find("input[data-rule-required='true']"),i.input.select=n.find("select[data-rule-required='true']"),i.input.check=n.find("input[type='checkbox']"),i.input.radio=n.find("input[type='radio']"),i.input.all={},i.input.all=i.input.text,i.input.all=i.input.all.add(i.input.select),i.input.all=i.input.all.add(i.input.check),i.input.all=i.input.all.add(i.input.captchatext),i.button={},i.button.submit=n.find("button[type='submit']"),i.button.reset=n.find("button[type='reset']"),i.button.hint=n.find(".button-hint"),i.button.success=n.find(".button-success"),i.button.error=n.find(".button-error"),i.button.error1=n.find(".button-error1"),i.button.unsubscribe=n.find(".button-unsubscribe"),i.button.subscribe=n.find(".button-subscribe"),i.button.exception=n.find(".button-exception"),i.input.radio.length>0&&(r.radio=!1),window.setTimeout(function(){i.input.all.each(function(){var t=e(this).attr("name"),n=e(this).val();r[t]=n!==""?!0:!1})},1e3)},build:function(){f.instances(),a.bind()}};f.build()},a=function(){e("input[name='recaptcha_response_field']").on("focus",function(){e(".hascaptcha").find("button[type='submit']").prop("disabled",!1)})},f=function(t){function h(){var e=u.next(),n=t.attr("data-cal-enable"),r=t.attr("data-cal-disable");f.is(":checked")?(a.removeClass("disabled"),u.datepicker("enable"),e.attr("src",n)):(a.addClass("disabled"),u.datepicker("disable"),e.attr("src",r))}var n={};n.button={},n.button.submit=t.find("button[type='submit']");var r=this,i=new Date,s=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1),o=e("html").attr("lang"),u=e(".date-picker"),a=e(".date-range-group"),f=e(".radio-date-range");o&&e.datepicker.setDefaults(e.datepicker.regional[o]);var l=e(".date-from"),c=e(".date-to");l.datepicker({showOn:"button",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,buttonImage:t.attr("data-cal-enable"),buttonImageOnly:!0,buttonText:l.attr("title"),maxDate:i,onClose:function(e){e?c.datepicker("option","minDate",e):c.datepicker("option",{maxDate:i,minDate:null})},onSelect:function(e){},beforeShow:function(){setTimeout(function(){e(".ui-datepicker").addClass("uniform"),e(".ui-datepicker").find("select").uniform({selectAutoWidth:!0})},0)},onChangeMonthYear:function(){setTimeout(function(){e(".ui-datepicker").find("select").uniform({selectAutoWidth:!0})},0)}}).next("img.ui-datepicker-trigger").attr("tabIndex","0"),l.datepicker({}).on("focus",function(){e(this).datepicker("show");var t=e(this);e("#ui-datepicker-div").attr("tabIndex","0").focus(),e(".ui-datepicker-calendar .ui-state-default").on("keydown",function(n){if(n.which===13){var r=(parseInt(e(this).parent().data("year"))+"-"+parseInt(e(this).parent().data("month"))+"-"+parseInt(e(this).text())).toString();t.datepicker("setDate",r),t.datepicker("hide"),t.parent().next().find(":focusable").focus()}else n.which===9&&e(this).parent().next().hasClass("ui-state-disabled")&&(t.datepicker("hide"),t.parent().next().find(":focusable").focus())})}),c.datepicker({showOn:"button",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,buttonImage:t.attr("data-cal-enable"),buttonImageOnly:!0,buttonText:c.attr("title"),maxDate:i,onClose:function(e){e?l.datepicker("option","maxDate",e):l.datepicker("option",{maxDate:i,minDate:null})},onSelect:function(e){},beforeShow:function(){setTimeout(function(){e(".ui-datepicker").addClass("uniform"),e(".ui-datepicker").find("select").uniform({selectAutoWidth:!0})},0)},onChangeMonthYear:function(){setTimeout(function(){e(".ui-datepicker").find("select").uniform({selectAutoWidth:!0})},0)}}).next("img.ui-datepicker-trigger").attr("tabIndex","0"),c.datepicker({}).on("focus",function(){e(this).datepicker("show");var t=e(this);e("#ui-datepicker-div").attr("tabIndex","0").focus(),e(".ui-datepicker-calendar .ui-state-default").on("keydown",function(n){if(n.which===13){var r=(parseInt(e(this).parent().data("year"))+"-"+parseInt(e(this).parent().data("month"))+"-"+parseInt(e(this).text())).toString();t.datepicker("setDate",r),t.datepicker("hide"),t.closest(".date-range").next().find(":focusable").focus()}else n.which===9&&e(this).parent().next().hasClass("ui-state-disabled")&&(t.datepicker("hide"),e(".form-details.form-tax-receipt.div.checker input[name='exclude-medication']").css("border","1px solid red"),e(".form-details.form-tax-receipt.div.checker input[name='exclude-medication']").focus())})}),h(),e("body").on("change",f,function(e){n.button.submit.prop("disabled",!1),h()})},l=function(n){var r={},i={},s=e(".terms")[0].scrollHeight,o=251,u={update:function(){r.termsscrolled&&i.button.cancel.prop("disabled",!1),r.termsscrolled&&(n.find("div.disabled").removeClass("disabled"),n.find("input:disabled").prop("disabled",!1)),r.agree?i.button.submit.prop("disabled",!1):i.button.submit.prop("disabled",!0),r.donotagree?i.show.donotagree.show():i.show.donotagree.hide()}},a={input:{agree:function(){e(this).prop("checked")?(r.agree=!0,r.donotagree=!1,u.update()):(r.agree=!1,u.update())},donotagree:function(){if(e(this).prop("checked")){var t=e(".consent-wrap"),n=t.find(".check-consent"),i=t.find(".checker");r.agree=!1,r.donotagree=!0,u.update(),t.addClass("disabled"),i.addClass("disabled"),i.find(".checked").removeClass("checked"),n.prop("checked",!1),n.prop("disabled",!0)}},reasons:function(){r.reasons=!0,u.update()},consent:function(){r.consent=e(this).prop("checked")?!0:!1,u.update()},terms:function(){var t=parseInt(e(this).css("padding-top")),n=parseInt(e(this).css("padding-bottom"));e(this).scrollTop()>=e(this)[0].scrollHeight-e(this).height()-(t+n)&&(r.termsscrolled=!0,u.update())}},button:{submit:function(e){e.preventDefault(),t.showOverlayLoader(),window.setTimeout(function(){n.submit()},500)}},bind:function(){i.input.agree.on("change",a.input.agree),i.input.donotagree.on("change",a.input.donotagree),i.input.reasons.on("change",a.input.reasons),i.button.submit.on("click",a.button.submit)}},f={instances:function(){i.show={},i.show.donotagree=n.find(".show-donotagree"),i.button={},i.button.cancel=n.find(".show-donotagree button"),i.button.submit=n.find(".navbottom button"),i.input={},i.input.consent=n.find(".check-consent"),i.input.reasons=n.find(".show-donotagree input[type='radio']"),i.input.donotagree=n.find(".radio-donotagree"),i.input.agree=n.find(".radio-agree"),i.textarea={},i.textarea.terms=n.find(".terms"),r.consent=!1,r.reasons=!1,r.donotagree=!1,r.agree=!1},build:function(){f.instances(),a.bind()}};f.build()},c=function(){self.cookieManager=new i,s.on("create",function(){new u(e(".overlay").find("form"))}),e("form").each(function(){var t=e(this);t.hasClass("form-terms")?new l(t):t.hasClass("form-tax-receipt")?new f(t):new u(t)})};e(document).ready(function(){setTimeout(function(){e(".form-details.form-tax-receipt.section-tax-teceipt").find(".checkbox-item .checker span input").css("border","1px solid red")},1e3);if(e("#form-terms-close")){var n=e("#form-terms-close .column-inner.dividerright .criteria").innerHeight(),r=e("#form-terms-close .column-inner.dividerright").innerHeight(),i=e("#form-terms-close .column-inner.width80 .criteria").innerHeight(),s=e("#form-terms-close .column-inner.width80").innerHeight();if(r>s){var u=r-s;u=i+u,e("#form-terms-close .width80 .criteria").css("height",u+10)}else if(s>r){var u=s-r;u=n+u,e("#form-terms-close .dividerright .criteria").css("height",u+16)}}e(".overlay-wrap").css("display")==="block"&&e("body").css("overflow","hidden"),setTimeout(function(){e(".full-year").parent("span").addClass("checked"),e(".full-year").prop("checked","checked")},1e3),e("select.security-question").each(function(){var t=e(this),n=t.val();t.on("click",function(e){e.preventDefault()}),t.on("change",function(){var r=e(this),i=r.parents(".row").next().find("input.form-security");i.val(""),i.focus(),o=!0;var s=r.attr("data-previous-question");s||r.attr("data-previous-question",t.attr("data-new-value")||n)})}),e("form.phone-number").find("input[type='text']").each(function(){var t=e(this);t.on("click",function(e){e.preventDefault()}),t.on("keypress",function(){setTimeout(function(){if(t.val().length==t.attr("maxlength"))return t.next().focus(),!1},0)})}),e(".registration-success").on("click",function(n){n.preventDefault(),t.showOverlayLoader();var r=e(this);window.setTimeout(function(){r.parents("form").submit()},500)}),e(".email-confirm-link").on("click",function(n){n.preventDefault(),t.showOverlayLoader();var r=e(this);window.setTimeout(function(){window.location.href=r.attr("href")},500)});var a=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return e('.form-details.section-communication input[name="email"]').on("keyup blur",function(){var t=e(this).val(),n=e(this).parents(".form-details").find('button[type="submit"]');a.test(t)||t===""?n.attr("disabled",!1):n.attr("disabled",!0),(t==""||t==null)&&n.attr("disabled",!1)}),e('.form-details.section-communication input[name="email"]').attr({autocomplete:"off"}),e(".form-details input.agree").change(function(t){e(this).prop("checked")?e(".button-erefill.reconsent").attr("disabled",!1):e(".button-erefill.reconsent").attr("disabled",!0)}),new c})}),require(["require-config"],function(){require(["erefill/mediators/form-details"])}),define("erefill-form-details",function(){}),define("erefill-form-details",function(){});