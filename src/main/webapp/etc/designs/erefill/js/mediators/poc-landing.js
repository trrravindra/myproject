define(["jquery","stapes","./globals","modules/carousel","modules/tabbed-video-player","modules/overlay","modules/managers/state-manager","modules/managers/theme-manager","modules/managers/scroll-manager","modules/theme-menu","modules/autocomplete-search","scrollTo","modules/api-tools","json!config"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function k(){d.on("domready",I)}function L(){v=o({mediator:d,useUrl:!0,useCookie:!1,states:[{state:"theme"}]})}function A(){m=new u({path:p.themeManager.templatesDirectory}),m.on(m.events.COMPONENTS_LOAD_SUCCESS,U),m.on(m.events.COMPONENTS_LOAD_FAIL,z)}function O(){g=new a({dataAttributeName:"component-id"}),g.on(g.events.DOM_SCAN_COMPLETE,q),g.scanDOM()}function M(){var t=e(".theme-menu-wrapper"),n=e(".hero-carousel");y=new f({el:".theme-menu-wrapper",dataApiName:"pcplusApi.themeMenu",startAtRandom:!1}),y.on(y.events.THEME_SELECTED,W),y.on(y.events.MENU_ORDERED,X),E=n.offset().top-t.height()}function _(){var t=e(".explore-more a");t.on("click",function(t){t.preventDefault();var n=e(this).attr("href").toString();n==="#"?y.selectItem("peanut-free-choices"):window.location=n})}function D(){var t=e(window),n=e(".theme-menu-wrapper"),r=n.offset().top,i=e(".nav-contextual"),s=function(){var e=t.scrollTop();e>r?(n.addClass("sticky-nav"),i.addClass("sticky-nav")):(n.removeClass("sticky-nav"),i.removeClass("sticky-nav"))};s(),t.scroll(function(){s()})}function P(){S.empty(),S.each(function(t){var n=e(S[t]),r=n.parent();r.find(".placeholder").removeClass("hidden"),r.find(".carousel-controls-container").addClass("hidden")})}function H(t,i,s){s.empty().html(i);var o=s.parent(),u,a;o.find(".placeholder").addClass("hidden"),o.find(".carousel-controls-container").removeClass("hidden");switch(t){case T.HERO_CAROUSEL:u=s.find("[data-carousel-config]").data("carousel-config"),a=new r(u),B()||(setTimeout(function(){a.changeSlide("next")},1e3),n.cookieManager.setCookie("megaCarousel",!0)),a.on("afterSlideChange",function(t){var r=e(t).find(".title").html()||"Error getting slide name";setTimeout(function(){var e={category:"engagement",action:"hero banner impressions",label:r,value:"",event:"GA Event"};n.fireAnalytics(e)},100)});break;case T.OFFERS_SPOTLIGHT:x.find(".card").length>3?(u=s.find("[data-carousel-config]").data("carousel-config"),a=new r(u),x.removeClass("hidden")):x.addClass("hidden");break;case T.DI_CAROUSEL:u=s.find("[data-carousel-config]").data("carousel-config"),a=new r(u),j()||(setTimeout(function(){a.changeSlide("next")},1e3),n.cookieManager.setCookie("diCarousel",!0));break;case T.DI_PRODUCTS:u=s.find("[data-carousel-config]").data("carousel-config"),a=new r(u),F()||(setTimeout(function(){a.changeSlide("next")},1200),n.cookieManager.setCookie("diProducts",!0))}}function B(){return n.cookieManager.getCookieByName("megaCarousel")}function j(){return n.cookieManager.getCookieByName("diCarousel")}function F(){return n.cookieManager.getCookieByName("diProducts")}function I(){A(),M(),d.initVideoPlayer(),d.quickFinderMenu(),V(),$(),J(),D(),_(),G(),Y()}function q(e){Q(),S=e.not(".animated-container");var t=v.getCurrentState(),r=t.theme||null;g.on(g.events.ELEMENT_IN_RANGE,R),y.selectItem(r),typeof n.cookieManager.getCookieByName(N.HAS_VISITED_COOKIE_NAME)=="undefined"&&setTimeout(function(){require(["modules/ir-bts-carousel-wizard"],function(e){})},1e3)}function R(e){if(e.id==="footer-main")return;var t=e.id,n=e.element;m.getComponents(t)}function U(e){console.log("Component Load Success:",e);for(var t=0;t<e.length;t++){var n=e[t],r=g.getRegisteredElementById(n.id);if(!r)continue;H(n.id,n.html,r)}}function z(e){console.log("Component Load Fail: ",e)}function W(t){var r=e(".nav-contextual");v.update("theme",t),m.change(t),P(),g.resetFiredFlags(),r.hasClass("sticky-nav")&&K();var i=e("a[href=#"+t+"]").data("video-tab-id");i===-1?e(".video-player").hide():e(".video-player").show(),typeof b!="undefined"&&w&&b.gotoTabAtIndex(i),t==="pcplus"?e("body").addClass("pcplus"):e("body").removeClass("pcplus"),C&&(C=!1),n.fireAnalytics({"theme served":t})}function X(){var e=y.getRootElement();e.addClass("menu-ready"),O()}function V(){var t=e(".carousel-discover-even-more"),n=t.data("carousel-config"),i=new r(n)}function $(){s.on("create",function(e){var t=s.getElement(".btn");t.on("click",function(e){e.preventDefault(),s.close()})})}function J(){var e=new l({el:".search-bar input"})}function K(){e.scrollTo(E,{duration:1e3,offset:-80})}function Q(){n.cookieManager.getCookieByName("catfish_crawler")||require(["modules/catfish-crawler"],function(t){d.catfishCrawler=new t({pathToTemplate:p.catfishCrawler.pathToTemplate||undefined,templateData:{content:"",className:"pcplus-catfish-crawler"}},g);var r=!1;d.catfishCrawler.on(d.catfishCrawler.events.SHOW_IN_COMPLETE,function(){var t={category:"pc plus",action:"interruptive marketing:catfish",label:"impression",value:"",event:"GA Event"};n.fireAnalytics(t),e(".catfish-crawler a").on("click",function(){var t=e(this).find("span").text()||e(this).text()||"Error Getting text",i={category:"pc plus",action:"interruptive marketing:catfish",label:"click:"+t,value:"",event:"GA Event"};n.fireAnalytics(i),r=!0})}),d.catfishCrawler.on(d.catfishCrawler.events.SHOW_OUT_COMPLETE,function(){if(!r){var e={category:"pc plus",action:"interruptive marketing:catfish",label:"click:Close",value:"close from scroll up",event:"GA Event"};n.fireAnalytics(e)}})})}function G(){var t=e(".pcplus-signup-cta.summary"),r;t.length>0&&(r=n.cookieManager.getCookieByName(n.constants.cookieNames.USER_COOKIE))&&(t.find(".user-name").html(r.name),t.find(".points").html(r.pts),e("html").attr("lang")==="en_CA"&&t.find(".points-value").html("$"+r.pts_val),e("html").attr("lang")==="fr_CA"&&t.find(".points-value").html(r.pts_val+" $"),t.find(".offer-points").html(r.off_pts))}function Y(){var t=e(".container").data("dynamic-script"),n;if(t){n=t.split(" ");for(var r=0,i=n.length;r<i;r++)n[r].match(/\S/)&&require(["mediators/dynamic/"+n[r]])}}var d,v,m,g,y,b,w=!1,E=0,S,x,T={HERO_CAROUSEL:"hero-carousel",OFFERS_SPOTLIGHT:"offers-spotlight",BRAND_FEATURE:"brand-feature",DI_CAROUSEL:"deliciousness-included",DI_PRODUCTS:"di-products"},N={IMAGE_SUFFIX:e('html[lang="fr_CA"]').length>0?"-fr_CA":"",HAS_VISITED_COOKIE_NAME:"visitor_of_btsir"},C=!0,Z=t.subclass({constructor:function(){n.BrowserDetect.browser==="Safari"&&n.BrowserDetect.version===5&&n.BrowserDetect.OS==="Mac"&&e("html").addClass("safari-5"),n.BrowserDetect.OS!=="Mac"&&e("html").addClass("windows"),d=this,x=e(".offers-spotlight"),L(),k(),e(function(){d.emit("domready")})},quickFinderMenu:function(){var t=this,n=e(".quick-finder"),r=n.find("a").first(),i="show";e("html").on("click",function(){n.hasClass(i)&&n.removeClass(i)}),e(n).on("click",function(e){e.stopPropagation()}),r.on("click",function(e){e.preventDefault(),n.hasClass(i)?n.removeClass(i):n.addClass(i)})},initVideoPlayer:function(){b=new i({el:".ir-video-player .tab-content:visible a:eq(0)"}),b.on(b.events.READY,function(){w=!0,b.gotoTabAtIndex(e("a[href=#"+m.getCurrentTheme()+"]").data("video-tab-id"))})}});return new Z});