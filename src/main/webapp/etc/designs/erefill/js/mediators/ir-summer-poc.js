define(["jquery","stapes","./globals","modules/carousel","modules/youtube-player","scrollTo","modules/overlay","modules/ir-summer-contextual-nav-poc","modules/managers/state-manager","tpl!templates/global.ir-summer-chairman-message.html"],function(e,t,n,r,i,s,o,u,a,f){var l={ON_THE_GRILL:"on-the-grill",IN_THE_BACKYARD:"in-the-backyard",ON_THE_PATIO:"on-the-patio"},c={MEGA_CAROUSEL:"top",TABLE_TALK:"tt",JOIN_THE_MOVEMENT:"jtm",VIDEOS:"videos",DELICIOUSNESS_INCLUDED:"di",DISCOVER_EVEN_MORE:"dem"},h={sections:[c.MEGA_CAROUSEL,c.TABLE_TALK,c.JOIN_THE_MOVEMENT,c.VIDEOS,c.DELICIOUSNESS_INCLUDED,c.DISCOVER_EVEN_MORE],categories:[l.ON_THE_GRILL,l.IN_THE_BACKYARD,l.ON_THE_PATIO]},p={MEGA_CAROUSEL:"megaCarousel",DI_CAROUSEL:"DICarousel"},d=t.subclass({constructor:function(){var t=this;t.stateManager=a({mediator:t,useUrl:!0,useCookie:!0,pageCookie:"sir",states:[{state:"category",handler:t.handleCategoryState},{state:"top"},{state:"di",handler:t.handleDiState},{state:"color",handler:t.handleColorState}]}),t.initEvents(),t.currentCategory=l.ON_THE_GRILL,t.isChairmanCookieSet()?t.theChairmanHasSpoken=!0:(t.createCookie("chairman","spoken",200),t.theChairmanHasSpoken=!1);var n=t.stateManager.getCurrentState();n.category&&(t.hashCategory=n.category),n[c.MEGA_CAROUSEL]&&(t.hashSection=n[c.MEGA_CAROUSEL]),n[c.DELICIOUSNESS_INCLUDED]&&(t.hashUID=n[c.DELICIOUSNESS_INCLUDED]),e(".state-color").click(function(){var n=e(".color-input").val();return t.stateManager.update("color",n,["di","top"]),t.handleColorState(n),!1}),e(".state-remove").click(function(){return t.stateManager.remove(["di","top"]),!1}),e(".state-reset").click(function(){return t.stateManager.reset(),!1}),e(function(){t.emit("domready")})},initEvents:function(){var t=this;e(window).on("hashchange",function(e){t.onHashChange(e)}),t.on("domready",t.onDomReady),t.on("firstMegaCarouselReady",t.onFirstMegaCarouselReady),t.on("changeCategory",t.changeCategory),t.on("totalInit",t.onTotalInit)},onHashChange:function(e){},updateFromHashChange:function(){var e=this;e.hashSection&&(e.scrollToSection(e.hashSection),e.hashSection===c.DELICIOUSNESS_INCLUDED?e.changeCategory(e.hashCategory,!1,e.hashUID,!0):e.hashCategory?e.changeCategory(e.hashCategory,!1,e.hashUID,!1):e.hashUID&&e.megaCarousel.gotoSlideFromIndex(e.hashUID))},onDomReady:function(){var t=this;t.$topToolTip=e(".ir-summer-nav .tooltip"),t.$videosToolTip=e(".ir-video-player .tooltip"),t.handleQuizes(),t.initContextualNav(),t.initVideoPlayer(),t.hashCategory||t.changeCategory(t.currentCategory,!0),t.stateManager.update("category",t.currentCategory),t.initDiscoverMore(),t.stateManager.emit(t.stateManager.events.MEDIATOR_READY)},parseHash:function(){var e=this,t=location.hash.replace("#","").split("/"),n=t.length,r=0;e.resetStoredHashValues();for(r;r<n;r+=1){var i=t[r]||null;h.sections.indexOf(i)>-1?e.hashSection=i:h.categories.indexOf(i)>-1?(e.hashCategory=i,e.currentCategory=e.hashCategory):e.hashUID=i}},initDiscoverMore:function(){var t=this,n=e(".carousel-discover-even-more").data("carousel-config"),i=e(".discover-even-more-nav .dem-carousel-control-button");t.carouselDem=r(n),t.carouselDem.on("sliderReady",function(n){this.isSingleSlide&&i.hide(),e(".dem-carousel-control-button").on("click",function(n){n.preventDefault(),t.carouselDem.changeSlide(e(this).data("direction"))})})},showChairmanMessage:function(){var t=this,n=f.render(),r=e(t.megaCarousel.getSlideAtIndex(t.megaCarousel.getCurrentIndex())),i=e(".ir-summer-nav .tooltip");r.find(".card-ribbon").append(n),e(".insider-message.chairman").on("click",function(){t.hideChairmanMessage()}),t.chairmanMessageFlip(),t.megaCarouselTooltipShown||(setTimeout(function(){i.stop().fadeIn(),t.megaCarouselTooltipShown=!0},1e3),setTimeout(function(){i.stop().fadeOut()},5e3))},hideChairmanMessage:function(){var t=this;if(t.theChairmanHasSpoken)return;var n=e(".insider-message.chairman"),r=n.parents("li"),i=r.find(".insider-message.perfect-pairing"),s=e(".card-ribbon .delicious-discoveries");n.fadeOut(500,function(){n.remove()}),s.fadeOut(500).remove(),i.fadeIn(500,function(){t.createCookie("chairman","spoken",200),t.isChairmanCookieSet=!0,r.addClass("message-read")}),r.parents(".carousel-ir-summer").addClass("message-read"),e(".ir-summer-nav .tooltip").stop().fadeOut(),t.theChairmanHasSpoken=!0},chairmanMessageFlip:function(){var t=this,n=e(".insider-message.chairman"),r=n.find(".msg-block"),i=n.find(".message-flip img"),s=n.find(".message-flip img, .message-flip .msg-block");n.hover(function(){s.stop().animate({width:"177px",height:"165px"},500)},function(){i.stop().animate({width:"25px",height:"25px"},220),r.stop().animate({width:"25px",height:"25px"},200)})},createCookie:function(e,t,n){var r="";if(n){var i=new Date;i.setTime(i.getTime()+n*24*60*60*1e3),r="; expires="+i.toGMTString()}document.cookie=e+"="+t+r+"; path=/"},getCookies:function(e){var t=e+"=",n=document.cookie.split(";"),r=0,i=n.length;for(r;r<i;r+=1){var s=n[r];while(s.charAt(0)===" ")s=s.substring(1,s.length);if(s.indexOf(t)===0)return s.substring(t.length,s.length)}return null},isChairmanCookieSet:function(){return this.getCookies("chairman")==="spoken"},initVideoPlayer:function(){var t=this,n=e(".video-player .tab-content:visible a").eq(0),r=e(".ir-video-player .media-object-action"),s=e(".ir-video-player .tabs a"),o=e(".ir-video-player .tooltip");t.theChairmanHasSpoken&&o.hide(),n.length&&n.data("videoid")&&i.initPlayer("ir-player",n.data("videoid")),n.addClass("active"),r.click(function(t){t.preventDefault();var n=e(this);r.removeClass("active"),n.addClass("active"),o.stop().hide(),n.data("videoid")&&i.loadVideo(n.data("videoid"))}),s.click(function(t){var n=e(this),s=e("a",n.attr("data-tab-target")).eq(0);o.stop().hide(),!n.hasClass("active")&&s.data("videoid")&&(i.cueVideo(s.data("videoid")),r.removeClass("active"),s.addClass("active"))}),e(i).on("initialPlay",function(){o.stop().hide()})},showVideoTooltip:function(){var t=e(".ir-video-player"),n=this,r=e(window),i=r.scrollTop(),s=r.height()*.75,o=t.find(".tooltip"),u=e("#ir-player");i>s&&(setTimeout(function(){o.fadeOut()},5e3),n.videoPlayerHit=!0)},changeCategory:function(t,n,r,i){var s=this,o,u,a=e(".mega-carousel-direction-nav .carousel-control-button"),f=i?null:r,c=i?r:null;e(".carousel-ir-summer").hide(),s.currentCategory=t,t===l.ON_THE_GRILL?s.megaCarouselOtg?(e(".carousel-ir-summer.carousel-otg").show(),s.setCarousel(p.MEGA_CAROUSEL,s.megaCarouselOtg,f)):s.megaCarouselOtg=s.initMegaCarousel("carousel-otg",s.megaCarouselOtg,f):t===l.IN_THE_BACKYARD?s.megaCarouselItb?(e(".carousel-ir-summer.carousel-itb").show(),s.setCarousel(p.MEGA_CAROUSEL,s.megaCarouselItb,f)):s.megaCarouselItb=s.initMegaCarousel("carousel-itb",s.megaCarouselItb,f):t===l.ON_THE_PATIO&&(s.megaCarouselOtp?(e(".carousel-ir-summer.carousel-otp").show(),s.setCarousel(p.MEGA_CAROUSEL,s.megaCarouselOtp,f)):s.megaCarouselOtp=s.initMegaCarousel("carousel-otp",s.megaCarouselOtp,f)),s.megaCarousel&&s.megaCarousel.isSingleSlide?a.hide():a.show(),s.isFirstMegaCarouselReady&&(s.changeCategoryForCategoryDependent(),s.changeCategoryForDI(!1,c))},onFirstMegaCarouselReady:function(){var e=this;e.isFirstMegaCarouselReady=!0,setTimeout(function(){e.changeCategoryForCategoryDependent()},100),e.hashUID||setTimeout(function(){e.changeCategoryForDI(!0)},200)},initMegaCarousel:function(t,n,i){var s=this,o,u,a=e(".mega-carousel-direction-nav .carousel-control-button"),f;return o=e(".carousel-ir-summer."+t),u=o.data("carousel-config"),o.show(),f=i||Math.floor(Math.random()*o.find("li[data-uid]").length),u.startAt=f,n=new r(u),n.on("sliderReady",function(n){s.megaCarousel=this,s.setCarousel(p.MEGA_CAROUSEL,this),s.megaCarousel.on("slidePrevious",function(t){var n=e(".ir-summer-nav > ul > li").index(e(".ir-summer-nav > ul > li.active")),r=s.clean(e(".perfect-pairing .sub-title",t).text());s.fireClickAnalytics({category:"PCSIR:"+n,action:"engagement:carousel:arrow left",label:r,value:"",event:"GA Event"})}),s.megaCarousel.on("slideNext",function(t){var n=e(".ir-summer-nav > ul > li").index(e(".ir-summer-nav > ul > li.active")),r=s.clean(e(".perfect-pairing .sub-title",t).text());s.fireClickAnalytics({category:"PCSIR:"+n,action:"engagement:carousel:arrow right",label:r,value:"",event:"GA Event"})}),s.theChairmanHasSpoken||(s.showChairmanMessage(),e(".carousel-ir-summer."+t).addClass("message-read")),this.isSingleSlide?a.hide():a.show(),s.isFirstMegaCarouselReady||(a.on("click",function(t){t.preventDefault(),s.megaCarousel.changeSlide(e(this).data("direction")),s.theChairmanHasSpoken||s.hideChairmanMessage()}),s.emit("firstMegaCarouselReady"))}),n.on("afterSlideChange",function(e){s.stateManager.update(c.MEGA_CAROUSEL,this.getCurrentIndex())}),n},initDICarousel:function(t,n,i,s){var o=this,u,a,f=e(".deliciousness-included-direction-nav .carousel-control-button"),l;return u=e(".carousel-deliciousness-included."+t),u.show(),o.hashSection&&o.hashSection===c.DELICIOUSNESS_INCLUDED?l=o.hashUID||0:l=Math.floor(Math.random()*u.find("li[data-uid]").length),a=u.data("carousel-config"),a.startAt=u.find("li[data-uid="+l+"]").index(),a.startAt<0?a.startAt=0:o.isHashUIDUsed=!0,n=r(a),n.on("sliderReady",function(e){o.setCarousel(p.DI_CAROUSEL,this,s),this.isSingleSlide?f.hide():f.show(),i&&(o.addHandlersForDICarousels(),o.emit("totalInit"))}),n.on("afterSlideChange",function(e){o.stateManager.update(c.DELICIOUSNESS_INCLUDED,this.getCurrentIndex())}),n},changeCategoryForCategoryDependent:function(){var t=this;e(".category-dependent").removeClass("show"),e(".category-dependent[data-category="+t.currentCategory+"]").addClass("show")},changeCategoryForDI:function(t,n){var r=this,i=r.currentCategory,s,o,u=e(".deliciousness-included-direction-nav .carousel-control-button");e(".carousel-deliciousness-included").hide(),i===l.ON_THE_GRILL?r.DICarouselOtg?(e(".carousel-deliciousness-included.carousel-otg").show(),r.setCarousel(p.DI_CAROUSEL,r.DICarouselOtg,n)):r.DICarouselOtg=r.initDICarousel("carousel-otg",r.DICarouselOtg,t,n):i===l.IN_THE_BACKYARD?r.DICarouselItb?(e(".carousel-deliciousness-included.carousel-itb").show(),r.setCarousel(p.DI_CAROUSEL,r.DICarouselItb,n)):r.DICarouselItb=r.initDICarousel("carousel-itb",r.DICarouselItb,t,n):i===l.ON_THE_PATIO&&(r.DICarouselOtp?(e(".carousel-deliciousness-included.carousel-otp").show(),r.setCarousel(p.DI_CAROUSEL,r.DICarouselOtp,n)):r.DICarouselOtp=r.initDICarousel("carousel-otp",r.DICarouselOtp,t,n)),r.DICarousel&&r.DICarousel.isSingleSlide?u.hide():u.show()},addHandlersForDICarousels:function(){var t=this;e(".deliciousness-included-direction-nav .carousel-control-button").on("click",function(n){n.preventDefault(),t.DICarousel.changeSlide(e(this).data("direction"))})},onTotalInit:function(){var e=this;e.hashSection&&e.hashSection!==c.MEGA_CAROUSEL&&setTimeout(function(){e.scrollToSection(e.hashSection)},300),e.isTotallyInited=!0},scrollToSection:function(t){e.scrollTo("a[name="+t+"]",{duration:1e3,offset:-80})},handleQuizes:function(){var t=this;o.on("create",function(n){var r=o.getElement(),i=r.find(".quiz form");if(i.length){var s=i.find(".btn-submit"),u=i.find(":radio"),a=i.find(".invalid"),f=!1,l=[];u.length&&(r.find(".number-of-questions").html(i.find(".question").length),u.change(function(){var t={},n=0;u.each(function(){t[e(this).attr("name")]=!0}),e.each(t,function(){n++}),e(":radio:checked").length===n&&(f=!0)}).change()),s.on("click",function(n){n.preventDefault();if(!f)i.find(".invalid").stop().fadeOut("fast").fadeIn("fast");else{l=[],u.each(function(t){var n=e(this);if(!n.prop("checked"))return;n.hasClass("right")&&l.push(n.parents("tr"))}),r.find(".number-of-right-answers").html(l.length);var s=e(".ir-summer-nav li").index(e(".ir-summer-nav li.active"));t.fireClickAnalytics({category:"PCSIR:"+s+":Quiz",action:"complete",label:""+l.length,event:"GA Event"}),r.find(".questions-content, .btn-submit").fadeOut("fast",function(){r.find(".results-content, .answer, .extra-info").fadeIn("fast");var t=0,n=l.length;for(t;t<n;t+=1){var i=e(l[t]);i.find(".num span").hide(),i.find(".checkmark").show()}})}})}}),o.on("close",function(t){var n=o.getElement();if(!n.find(".overlay-quiz").length)return;var r=n.find(".quiz form"),i=r.find(".radio span"),s=r.find(".num span"),u=r.find(".num .checkmark"),a=r.find(".answer");r[0].reset(),n.find(".btn-submit, .extra-info, .questions-content, .results-content").removeAttr("style"),i.each(function(t){e(this).removeClass("checked")}),s.each(function(t){e(this).removeAttr("style")}),u.each(function(t){e(this).removeAttr("style")}),a.each(function(t){e(this).removeAttr("style")})})},setCarousel:function(e,t,n){var r=this;if(e===p.MEGA_CAROUSEL||e===p.DI_CAROUSEL)typeof t!="undefined"&&(r[e]=t),n&&r[e].gotoSlideFromIndex(Number(n))},fireClickAnalytics:function(e){if(typeof dataLayer!="undefined")try{dataLayer.push(e)}catch(t){}},clean:function(t){var n=e.trim(t.replace(/[^a-zA-Z0-9 _-]/gi,"").replace(/\s{2,}/g," ")).toLowerCase();return n},resetStoredHashValues:function(){var e=this;e.hashCategory=null,e.hashSection=null,e.hashUID=null},initContextualNav:function(){var e=this;e.contextualNav=new u,e.contextualNav.on("navLinkClicked",function(t){e.hideChairmanMessage(),e.changeCategory(t),e.stateManager.update("category",t,["top","di"])}),e.contextualNav.on("contextualNavScroll",function(t){(e.theChairmanHasSpoken||e.videoPlayerHit)&&e.contextualNav.off("contextualNavScroll"),e.showVideoTooltip()}),e.contextualNav.setActiveButton(e.hashCategory||e.currentCategory)},handleCategoryState:function(e){var t=this,n=t.stateManager.getCurrentState(),r=n[c.MEGA_CAROUSEL];t.changeCategory(e,!0,r)},handleDiState:function(e){var t=this;t.changeCategoryForDI(!0,e)},handleColorState:function(t){e("body").css("background-color","#"+t),e(".color-input").val(t)}});return new d});