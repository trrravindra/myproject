define(["jquery","stapes","./globals","json!config","modules/overlay","modules/shopping-list","tpl!templates/shoppinglist.shlist-item.html"],function(e,t,n,r,i,s,o){var u=t.subclass({constructor:function(){var t=this;t.initEvents(),e(function(){t.emit("domready")})},initEvents:function(){var e=this;e.on("domready",e.onDomReady)},onDomReady:function(){var e=this;e.initShoppingList()},initShoppingList:function(){var t,n={},u=e(".shopping-list-component:first"),a=u.find(".items");if(!u.length)return;a.on("click",".ctrl-remove",function(n){n.preventDefault();var r=e(this),i=r.parents("li:first").attr("data-item-id");t.removeItem({id:i})}),a.on("click",".ctrl-staple",function(n){n.preventDefault();var r=e(this),i=r.parents("li:first").attr("data-item-id"),s=!t.get(i).staple;t.updateItem({id:i,staple:s})}),i.on("create",function(){var n=i.getElement().find(".overlay-shoppinglist-add-item form");n.on("submit",function(n){n.preventDefault();var r=e(this);t.addItem({description:r.find('[name="description"]:first').val(),quantity:r.find('[name="quantity"]:first').val(),staple:!!r.find('[name="staple"]:first:checked').length}),this.reset(),i.close()})}),e(window.document).on("click",".ctrl-clear-list-confirm",function(e){e.preventDefault(),t.clearItems(),i.close()}),t=new s({membershipId:r.membershipId}),t.on({mutate:function(t,r){var i=t.newValue.id,s=n[i],u=e(o.render(t.newValue));s?s.replaceWith(u):u.appendTo(a),n[i]=u},remove:function(e){var t=n[e];t&&t.remove()}}),u.addClass("loading"),t.sync().done(function(){u.removeClass("loading")})}});return new u});