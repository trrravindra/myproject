define(["jquery"],function(e){var t=function(t,n){return n.length-t.length},n=function r(e){if(!(this instanceof r))return new r(e);this.data=e};return n.prototype={eachInText:function(e,t){var n=this,r=n.findInText(e);for(var i=0,s=r.length,o;(o=r[i])&&i<s;++i)t(o.entry,o.pos);return n},findInText:function(e){var t=this,n=[],r=/[\s.,\-!:;?'"]/,i=e.split(r),s,o=0,u,a;if(!e.length)return n;for(var f=0,l=i.length,c;f<l;++f){c=i[f],t.hasWord(c)&&n.push({entry:c,pos:o}),s=t.phrasesBeginningWith(c);if(s&&s.length){u=s[0].length,a=e.substr(o,u).toLowerCase();for(var h=0,p=s.length;h<p;++h)a.indexOf(s[h])!==-1&&n.push({entry:s[h],pos:o})}o+=c.length+1}return n},phrasesBeginningWith:function(e){return e.length?this.data.phrases[e]:[]},hasWord:function(e){var t=this.data.words,n=e.length;if(!n||!t[n])return!1;var r=t[n].length/n,i=0,s=r-1,o=Math.floor(r/2);while(s>=i){var u=t[n].substr(n*o,n);if(e===u)return!0;e<u?s=o-1:i=o+1,o=Math.floor((i+s)/2)}return!1}},n.fromList=function(e){var r=[],i={},s=" ",o,u,a,f;for(var l=0,c=e.length,h;l<c;++l)h=e[l],a=h.indexOf(s),a<0?(o=h.length,r[o]=(r[o]||"")+h):(u=h.substr(0,a),f=i[u]=i[u]||[],f.push(h));for(var p in i)i[p].sort(t);return new n({words:r,phrases:i})},n});