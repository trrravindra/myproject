define(["jquery","stapes"],function(e,t){function c(){return r.clean(a.data("current-theme-label"))}window.onBestOfBestOpen=function(e){r.fireClickAnalytics({pageview:"best:view all modal",event:"vir_pageview"})};var n={},r,i=0,s="",o=e(".theme-menu.collapsed"),u=e(".theme-menu.expanded"),a=e(".theme-active"),f={ERROR_GETTING_LABEL:"Error getting label",ERROR_GETTING_SECTION:"Error getting section"},l={HERO:"hero",JOIN_THE_CONVERSATION:"tasty tidbits",BRAND_FEATURE:"information to savour",VIDEOS:"view our videos",DELICIOUSNESS_INCLUDED:"deliciousness included",OFFERS_SPOTLIGHT:"pcplus offers",DISCOVER_EVEN_MORE:"discover even more"},h=t.subclass({constructor:function(t){r=this,r.config=e.extend({},n,t),i=u.find("li > a.active").parents("li").index(),s=c(),r.setupClickAnalytics()},setupClickAnalytics:function(){var t=r.config;e(".theme-menu > ul > li > a").on("click",function(t){var n=e(this),o=n.parents(".theme-menu-wrapper"),u=o.hasClass("sticky-nav");i=n.parents("li").index(),s=r.clean(n.text())||c(),setTimeout(function(){r.fireClickAnalytics({category:"content",action:"theme views",label:s,value:"",event:"GA Event"}),u&&r.fireClickAnalytics({category:"engagement",action:"sticky menu clicks",label:s,value:"",event:"GA Event"})},500)}),e(".quick-finder-btn .btn-plain").on("click",function(t){var n=e(this).parents(".quick-finder").hasClass("show");n&&r.fireClickAnalytics({category:"engagement",action:"quick finder opens",label:"",value:"",event:"GA Event"})}),e(".quick-finder-content .links > ul > li > a").on("click",function(t){var n=e(this),i;n.find("img").length>0?i=n.find("img").attr("alt")||f.ERROR_GETTING_LABEL:i=n.text()||f.ERROR_GETTING_LABEL,r.fireClickAnalytics({category:"engagement",action:"quick finder clicks",label:i,value:"",event:"GA Event"})}),e(".carousel-control-button").on("click",function(){var t=e(this),n=r.getSectionName(t),i=n+" "+t.data("direction")+" button clicks";r.fireClickAnalytics({category:"engagement",action:i,label:"",value:"",event:"GA Event"})}),e(window.document).on("click",".carousel-hero .recipe-callout > a",function(t){var n=e(this),i=n.find(".title").text()||f.ERROR_GETTING_LABEL;r.fireClickAnalytics({category:"engagement",action:"hero banner clicks",label:i,value:"",event:"GA Event"})}),e(window.document).on("click",".carousel-hero .related-content .media-object-action",function(t){var n=e(this),i=n.parents(".flex-active-slide"),s=n.find(".media-object-title").text()||f.ERROR_GETTING_LABEL;r.fireClickAnalytics({category:"engagement",action:"hero content clicks",label:s,value:"",event:"GA Event"})}),e(".facebook-chat a").on("click",function(t){var n=e(this);r.fireClickAnalytics({category:"engagement",action:"outgoing "+n.attr("href"),label:r.getSectionName(n),value:"",event:"GA Event"})}),e(window.document).on("click",".overlay-best-list ul li a",function(t){t.preventDefault();var n=e(this).attr("href"),i=r.clean(e(this).text())||f.ERROR_GETTING_LABEL;r.fireClickAnalytics({category:"engagement:bestoflistoverlay",action:s+":thebest:"+i,label:"tile",value:"",event:"GA Event"}),window.location.href=n}),e(".video-player .tabs li > a").on("click",function(t){if(t.isTrigger)return;var n=r.clean(e(this).text())||f.ERROR_GETTING_LABEL;r.fireClickAnalytics({category:"engagement",action:"video category clicks",label:n,value:"",event:"GA Event"})}),e(".video-player .tab-content .media-object-action").on("click",function(t){var n=r.clean(e(this).find(".media-object-title").text())||f.ERROR_GETTING_LABEL;r.fireClickAnalytics({category:"engagement",action:"video views",label:n,value:"",event:"GA Event"})}),e(window.document).on("click",".card a",function(t){var n=e(this),i=r.getSectionName(n),s=n.find(".header .title"),o,u="";if(s.length<=0){var a=n.parents(".card");s=a.find(".header .title").add(a.find(".media-object-title"))}o=r.clean(s.text());var f=e(t.target);if(f.is("a"))u=r.clean(f.text());else if(f.is("span")){var l=f.parents("a.btn-plain").add(f.parents("a.media-object-cta"));u=l.length>0?r.clean(l.text()):""}var c=i+":"+o;typeof u=="string"&&u.length&&(c=c+":"+u),r.fireClickAnalytics({category:"engagement",action:"tile clicks",label:c,value:"",event:"GA Event"})}),e(window.document).on("click",".pcplus-branding-slide .buttons a",function(){var t=e(this).hasClass("btn-red")?"learn more":"sign in";t="pcplus:"+t,r.fireClickAnalytics({category:"engagement",action:"hero banner clicks",label:t,value:"",event:"GA Event"})}),e(window.document).on("click",".offers-spotlight .page-header .link-right",function(){r.fireClickAnalytics({category:"engagement",action:"tile clicks",label:"pcplus offers:learn more and join",value:"",event:"GA Event"})}),e(".ir-grid .grid-view-nav .sort-trigger").on("click",function(t){var n=e(this).data("filter");r.fireClickAnalytics({category:"engagement:grid",action:"nav",label:n,value:"",event:"GA Event"})}),e(".ir-grid .sortable-grid .card a").on("click",function(t){var n=e(this),i=n.parents(".card"),s=i.data("filters"),o=i.find(".title").text()||f.ERROR_GETTING_LABEL;r.fireClickAnalytics({category:"engagement:grid",action:"engagement:searchgrid:perfect pairing",label:s+":"+o,value:"",event:"GA Event"})})},fireClickAnalytics:function(e){if(typeof dataLayer!="undefined")try{dataLayer.push(e)}catch(t){consoleLog(t)}},getCategoryFromUrl:function(t){var n=t,r=1,i,s=e("html").attr("lang");return i=n.slice(n.indexOf(s)).split("/"),i.length<2?"other":i[r]},clean:function(t){if(t){var n=e.trim(t.replace(/[^a-zA-Z0-9 _-]/gi,"").replace(/\s{2,}/g," ")).toLowerCase();return n}return null},getSectionName:function(e){var t=e.parents("section"),n=t.attr("class");switch(n){case"hero-carousel":return l.HERO;case"table-talk":return l.JOIN_THE_CONVERSATION;case"brand-feature":return l.BRAND_FEATURE;case"video-player ir-video-player":return l.VIDEOS;case"deliciousness-included":case"deliciousness-included-carousel":case"di-products-carousel":return l.DELICIOUSNESS_INCLUDED;case"offers-spotlight":return l.OFFERS_SPOTLIGHT;case"discover-even-more":case"discover-more-footer":return l.DISCOVER_EVEN_MORE;default:return f.ERROR_GETTING_SECTION}},consoleLog:function(e){typeof console!="undefined"&&console.log(e)}});return function(e){return new h(e)}});