define(["jquery","stapes","../mediators/globals","../vendor/json2"],function(e,t,n,r){function v(){i.on(i.events.COMPONENT_READY,function(){S(),w()}),a.on("mouseleave",y),l.on("mouseover",a,g),e(window.document).on("click",".my-account-button a",function(t){t.preventDefault();var r={category:"global",action:"outgoing:brand referral",label:"pcplus.ca:my account",value:"",event:"GA Event"};n.fireAnalytics(r),window.location=e(this).attr("href")})}function m(){o=e(".pcplus-dashboard.logged-in"),u=e(".pcplus-dashboard.logged-out"),a=e(".pc-profile"),f=parseInt(a.css("width"),10),l=a.find(".greeting"),c=a.find(".pc-dropdown"),h=0}function g(e){var t=a.hasClass("open");if(!t){var n=b(),r=n-parseInt(a.css("width"),10),i=!1;l.hasClass("long-name")&&(i=!0),a.addClass("open"),i&&a.css({width:""+n+"px",left:"-"+r+"px",position:"absolute"})}}function y(e){a.removeClass("open").removeAttr("style")}function b(){return h=h||l.textWidth()+36+28,h}function w(){var t=b(),n=t-parseInt(a.css("width"),10),r=!1;if(t>f){l.addClass("long-name");if(e("html").hasClass("lt-ie9")){var i=l.text();l.empty().html('<span class="ie-menu-fix">'+i+"</span>")}}}function E(){s=i.config.userData}function S(){var t;if(typeof s!="undefined"&&s.hasOwnProperty(d.USER_DATA_UID_KEY)){var n=s,r=n.name?n.name:"",i=n.off?n.off:0,a=n.pts?n.pts:0,f=n.pts_val?n.pts_val:0;e(".user-points",o).text(a),e("html").attr("lang")==="en_CA"&&e(".user-points-value",o).text("$"+f),e("html").attr("lang")==="fr_CA"&&e(".user-points-value",o).text(f+" $");if(e("html").attr("lang")==="fr_CA"){var l=e(".user-points",o).text(),c=l.split(","),h=" ";for(var p=0;p<c.length;p++)h=h+c[p]+" ";e(".user-points",o).text(h)}o.show(),u.remove(),i===0&&(e(".pcplus-show-offers-loaded").addClass("hide-section"),e(".pcplus-show-offers-notloaded").addClass("hide-section"),e(".pcplus-show-offers-nooffers").removeClass("hide-section"))}else u.show(),o.remove()}function x(){e(window.document).on("click",".fake-data-trigger",function(e){e.preventDefault();var t={mid:"alkdjaldkasldkas",name:"CandaceCandaceCandace",pts:"98,000",pts_val:"98",off:"10",off_stat:"not_loaded",off_pts:"5000",user_stat:"abc"};n.cookieManager.setCookie(n.constants.cookieNames.USER_COOKIE,t,null,null,null,!0),n.cookieManager.setCookie("pcplus_signin_email","candace@pcplus.ca"),location.reload(!0)})}var i,s,o,u,a,f,l,c,h,p={userData:{}},d={EVENT_NAMESPACE:"PCPlusDashboard",LOGGED_IN_CLASSNAME:"logged-in",LOGGED_OUT_CLASSNAME:"logged-out",USER_DATA_UID_KEY:"mid"};e.fn.textWidth=function(){var t=e(this).html(),n="<span>"+t+"</span>";e(this).html(n);var r=e(this).find("span:first").width();return e(this).html(t),r};var T=t.subclass({events:{COMPONENT_READY:d.EVENT_NAMESPACE+".componentReady",COMPONENT_RENDERED:d.EVENT_NAMESPACE+".componentRendered"},constructor:function(t){i=this,i.config=e.extend({},p,t),E(),m(),v(),x(),e(function(){i.emit(i.events.COMPONENT_READY)})},getUserData:function(){return s||null}});return function(e){return new T(e)}});