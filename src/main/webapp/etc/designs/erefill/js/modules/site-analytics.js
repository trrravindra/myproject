define(["jquery","stapes","json!config","modules/analytics/analytics-global"],function(e,t,n,r){var i={el:null},s={HOME:"homepage",SEARCH_RESULTS:"search",LISTING_PAGES:"contentlisting",STORE_RESULTS:"storefinderpage",STORE_DETAILS:"storedetail",FLYER_LANDING:"flyerpage",RECIPES_LANDING:"contentlanding",RECIPES_DETAILS:"recipedetails",PCBL_RECIPES_DETAILS:"recipebldetailspage",VIDEO_LANDING:"contentlanding",VIDEO_DETAILS:"videodetails",PCBL_VIDEO_DETAILS:"videobldetailspage",PRODUCT_LANDING:"contentlanding",PRODUCT_DETAILS_LOBLAWS:"productdetailpage",PRODUCT_DETAILS_PC:"productdetailspage",PCBL_PRODUCT_DETAILS:"productbldetailspage",ARTICLE_LANDING:"contentlanding",ARTICLE_DETAILS:"articledetailphotopage",PC_FAMILY:"pcfamilypage",COMMUNITY_PAGES:"aboutpage",CONTACT_US:"contactUs",SUB_BRAND_LANDING:"subbrandlandingpage",PCBL_LANDING:"pcbllandingpage",IR_SUMMER:"sirlanding",IR_SUMMER_GRID:"sirlandinggrid",EAT_FLEET_LANDING:"eatfleetlanding",EAT_FLEET_DETAILS:"eatfleeteventddetailspage",IR_BTS:"btsirlanding",IR_BTS_EAT_FLEET:"eatfleetlanding",EREFILL_CONTENT:"contenttemplate",HIR_LANDING:"hirlanding",PCPLUS_HOME:"pcplushome",PCPLUS_MY_OFFERS:"pcplusoffers",NUTSHELL_HOME:"home",NUTSHELL_CONTACT:"contact",NUTSHELL_NUTTYIDEA:"soapbox",ORGANIC_LANDING:"flexiblepage",ORGANIC_ARTICLE_DETAIL:"pcbabyarticledetailphotopage",BABYEVENTS:"babyeventspage"},o=t.subclass({constructor:function(t){var s=this;s.config=e.extend({},i,t),s.analyticsConfig=n.analytics,window.dataLayer=window.dataLayer||[];var o=new r(s.analyticsConfig);s.initEvents(),e(function(){s.emit("initComplete")})},initEvents:function(){var e=this;e.on("initComplete",e.onInitComplete)},onInitComplete:function(){var e=this;e.initPageSpecificAnalytics()},setupPageLoadAnalytics:function(){var e=this,t=[],n=e.analyticsConfig.data.province===""?"unknown":e.analyticsConfig.data.province,r=e.analyticsConfig.data.identifiedStore===""?"anonymous":e.analyticsConfig.data.identifiedStore;t.push({"visitor-status":r}),t.push({"preferred-province":n}),t.push({"page-category":e.analyticsConfig.data.pageCategory}),t.push({brand:e.analyticsConfig.data.brand}),t.push({pageview:e.analyticsConfig.data.pageName,event:"pageview"}),e.firePageLoadAnalytics(t)},initPageSpecificAnalytics:function(){var t=this,r=e("body").data("page-analytics")||{},i=r.pageTemplate;r.province=n.analytics.data.province,r.pageURL=n.analytics.data.pageURL,r.identifiedStore=n.analytics.data.identifiedStore;switch(i){case s.HOME:require(["modules/analytics/analytics-home-pages"],function(e){e(r)});break;case s.COMMUNITY_PAGES:case s.CONTACT_US:require(["modules/analytics/analytics-community"],function(e){e(r)});break;case s.PRODUCT_LANDING:case s.ARTICLE_LANDING:case s.VIDEO_LANDING:case s.RECIPES_LANDING:require(["modules/analytics/analytics-landing-pages"],function(e){e(r)});break;case s.PRODUCT_DETAILS_LOBLAWS:case s.PRODUCT_DETAILS_PC:case s.ARTICLE_DETAILS:case s.VIDEO_DETAILS:case s.RECIPES_DETAILS:case s.PCBL_PRODUCT_DETAILS:case s.PCBL_VIDEO_DETAILS:case s.PCBL_RECIPES_DETAILS:require(["modules/analytics/analytics-details-pages"],function(e){e(r)});break;case s.SEARCH_RESULTS:case s.LISTING_PAGES:require(["modules/analytics/analytics-search-results"],function(e){e(r)});break;case s.PC_FAMILY:case s.SUB_BRAND_LANDING:case s.PCBL_LANDING:require(["modules/analytics/analytics-pc-family"],function(e){e(r)});break;case s.STORE_DETAILS:require(["modules/analytics/analytics-store-details"],function(e){e(r)});break;case s.STORE_RESULTS:require(["modules/analytics/analytics-store-results"],function(e){e(r)});break;case s.FLYER_LANDING:require(["modules/analytics/analytics-flyer"],function(e){e(r)});break;case s.IR_SUMMER:case s.IR_SUMMER_GRID:require(["modules/analytics/analytics-ir-summer"],function(e){e(r)});break;case s.EAT_FLEET_LANDING:case s.EAT_FLEET_DETAILS:require(["modules/analytics/analytics-ir-bts-eat-fleet"],function(e){e(r)});break;case s.IR_BTS:require(["modules/analytics/analytics-ir-bts"],function(e){e(r)});break;case s.HIR_LANDING:require(["modules/analytics/analytics-hir"],function(e){e(r)});break;case s.IR_BTS_EAT_FLEET:require(["modules/analytics/analytics-ir-bts-eat-fleet"],function(e){e(r)});break;case s.EREFILL_CONTENT:require(["modules/analytics/erefill/analytics-erefill-content"],function(e){e(r)});break;case s.PCPLUS_HOME:require(["modules/analytics/pcplus/analytics-pcplus-home"],function(e){e(r)});break;case s.PCPLUS_MY_OFFERS:require(["modules/analytics/pcplus/analytics-pcplus-my-offers"],function(e){e(r)});break;case s.NUTSHELL_HOME:case s.NUTSHELL_CONTACT:case s.NUTSHELL_NUTTYIDEA:require(["modules/analytics/analytics-nutshell"],function(e){e(r)});break;case s.ORGANIC_LANDING:case s.ORGANIC_ARTICLE_DETAIL:require(["modules/analytics/analytics-organic"],function(e){e(r)});break;case s.BABYEVENTS:require(["modules/analytics/analytics-babyevents"],function(e){e(r)});break;default:console.log("Error with page template variable in site-analytics. The template name passed in does not exist.")}},firePageLoadAnalytics:function(e){var t=this,n=e.length,r=0;for(r;r<n;r+=1){if(typeof dataLayer=="undefined")throw"Something went wrong. dataLayer seems to be undefined. Check that you loaded GTM properly.";try{dataLayer.push(e[r])}catch(i){throw"Something went wrong when pushing to the dataLayer. Check that GTM is loaded, or if your data was setup properly. Error listed as: "+i}}},consoleLog:function(e){typeof console!="undefined"&&console.log(e)}});return function(e){return new o(e)}});