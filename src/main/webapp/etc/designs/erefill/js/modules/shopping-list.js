define(["jquery","stapes","modules/api-tools"],function(e,t,n){var r={membershipId:null},i=t.subclass({constructor:function(t){var n=this;n.config=e.extend({},r,t);if(!n.config.membershipId)return;n.initEvents()},initEvents:function(){var e=this;e.on("all",function(e,t){window.console&&window.console.log&&window.console.log(t.type,e,t)})},sync:function(){var t=this;return n.publicDfd(function(r){var i=n.prepare("pcApi.shoppinglist",{membershipId:t.config.membershipId}),s=e.ajax(i).done(function(n){n&&n.shoppingList&&e.each(n.shoppingList,function(e,n){t.set(n.id,n)}),r.resolve(),t.emit("sync",n)}).fail(function(e,i,s){r.reject(),t.emit("error",n.formatError(e,i,s))})},"sc-sync")},clearItems:function(){var t=this;return n.publicDfd(function(r){var i,s;i=n.prepare("delete","pcApi.shoppinglist",{membershipId:t.config.membershipId}),s=e.ajax(i).done(function(e){t.remove(function(){return!0}),r.resolve()}).fail(function(e,i,s){r.reject(),t.emit("error",n.formatError(e,i,s))})})},addItem:function(t){var r=this;return n.publicDfd(function(i){var s,o;s=n.prepare("post","pcApi.shoppinglistItem",{membershipId:r.config.membershipId,type:t.type||"plainText",description:t.description,quantity:t.quantity,staple:t.staple}),o=e.ajax(s).done(function(e){r.set(e.id,e),i.resolve()}).fail(function(e,t,s){i.reject(),r.emit("error",n.formatError(e,t,s))})},t)},removeItem:function(t){var r=this;return n.publicDfd(function(i){var s,o;if(!t.id)return i.reject();s=n.prepare("delete","pcApi.shoppinglistItem",{membershipId:r.config.membershipId,itemId:t.id}),o=e.ajax(s).done(function(e){r.remove(t.id),i.resolve()}).fail(function(e,t,s){i.reject(),r.emit("error",n.formatError(e,t,s))})},t)},updateItem:function(t){var r=this;return n.publicDfd(function(i){var s,o;if(!t.id)return i.reject();s=n.prepare("post","pcApi.shoppinglistItem",{membershipId:r.config.membershipId,id:t.id,staple:t.staple}),o=e.ajax(s).done(function(e){r.set(e.id,e),i.resolve()}).fail(function(e,t,s){i.reject(),r.emit("error",n.formatError(e,t,s))})},t)}});return function(e){return new i(e)}});